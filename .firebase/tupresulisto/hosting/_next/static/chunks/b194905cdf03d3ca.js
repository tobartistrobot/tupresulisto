(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67034,(e,t,r)=>{var n={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return(r+n)*3/4-n},t.toByteArray=function(e){var t,r,i=l(e),a=i[0],o=i[1],c=new s((a+o)*3/4-o),u=0,h=o>0?a-4:a;for(r=0;r<h;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,c[u++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c},t.fromByteArray=function(e){for(var t,n=e.length,s=n%3,i=[],a=0,o=n-s;a<o;a+=16383)i.push(function(e,t,n){for(var s,i=[],a=t;a<n;a+=3)s=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(r[s>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return i.join("")}(e,a,a+16383>o?o:a+16383));return 1===s?i.push(r[(t=e[n-1])>>2]+r[t<<4&63]+"=="):2===s&&i.push(r[(t=(e[n-2]<<8)+e[n-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),i.join("")};for(var r=[],n=[],s="u">typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=i.length;a<o;++a)r[a]=i[a],n[i.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},72:function(e,t,r){"use strict";var n=r(675),s=r(783),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var n=e,s=t;if(("string"!=typeof s||""===s)&&(s="utf8"),!o.isEncoding(s))throw TypeError("Unknown encoding: "+s);var i=0|f(n,s),l=a(i),c=l.write(n,s);return c!==i&&(l=l.slice(0,c)),l}if(ArrayBuffer.isView(e))return h(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(k(e,ArrayBuffer)||e&&k(e.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(k(e,SharedArrayBuffer)||e&&k(e.buffer,SharedArrayBuffer)))return function(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),n}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var u=e.valueOf&&e.valueOf();if(null!=u&&u!==e)return o.from(u,t,r);var p=function(e){if(o.isBuffer(e)){var t=0|d(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):h(e):"Buffer"===e.type&&Array.isArray(e.data)?h(e.data):void 0}(e);if(p)return p;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return c(e),a(e<0?0:0|d(e))}function h(e){for(var t=e.length<0?0:0|d(e.length),r=a(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),!o.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(c(e),e<=0)?a(e):void 0!==t?"string"==typeof r?a(e).fill(t,r):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return u(e)},o.allocUnsafeSlow=function(e){return u(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||k(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var s=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return T(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return S(e).length;default:if(s)return n?-1:T(e).length;t=(""+t).toLowerCase(),s=!0}}function p(e,t,r){var s,i,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var s="",i=t;i<r;++i)s+=A[e[i]];return s}(this,t,r);case"utf8":case"utf-8":return b(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var s=t;s<r;++s)n+=String.fromCharCode(127&e[s]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var s=t;s<r;++s)n+=String.fromCharCode(e[s]);return n}(this,t,r);case"base64":return s=this,i=t,a=r,0===i&&a===s.length?n.fromByteArray(s):n.fromByteArray(s.slice(i,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),s="",i=0;i<n.length;i+=2)s+=String.fromCharCode(n[i]+256*n[i+1]);return s}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function g(e,t,r,n,s){var i;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(i=r*=1)!=i&&(r=s?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(s)return -1;else r=e.length-1;else if(r<0)if(!s)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,s);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(s)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return y(e,[t],r,n,s)}throw TypeError("val must be string, number or Buffer")}function y(e,t,r,n,s){var i,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(s){var u=-1;for(i=r;i<o;i++)if(c(e,i)===c(t,-1===u?0:i-u)){if(-1===u&&(u=i),i-u+1===l)return u*a}else -1!==u&&(i-=i-u),u=-1}else for(r+l>o&&(r=o-l),i=r;i>=0;i--){for(var h=!0,d=0;d<l;d++)if(c(e,i+d)!==c(t,d)){h=!1;break}if(h)return i}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(k(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),k(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,s=0,i=Math.min(r,n);s<i;++s)if(e[s]!==t[s]){r=e[s],n=t[s];break}return r<n?-1:+(n<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=o.allocUnsafe(t),s=0;for(r=0;r<e.length;++r){var i=e[r];if(k(i,Uint8Array)&&(i=o.from(i)),!o.isBuffer(i))throw TypeError('"list" argument must be an Array of Buffers');i.copy(n,s),s+=i.length}return n},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?b(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},i&&(o.prototype[i]=o.prototype.inspect),o.prototype.compare=function(e,t,r,n,s){if(k(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===s&&(s=this.length),t<0||r>e.length||n<0||s>this.length)throw RangeError("out of range index");if(n>=s&&t>=r)return 0;if(n>=s)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,s>>>=0,this===e)return 0;for(var i=s-n,a=r-t,l=Math.min(i,a),c=this.slice(n,s),u=e.slice(t,r),h=0;h<l;++h)if(c[h]!==u[h]){i=c[h],a=u[h];break}return i<a?-1:+(a<i)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)};function b(e,t,r){r=Math.min(e.length,r);for(var n=[],s=t;s<r;){var i,a,o,l,c=e[s],u=null,h=c>239?4:c>223?3:c>191?2:1;if(s+h<=r)switch(h){case 1:c<128&&(u=c);break;case 2:(192&(i=e[s+1]))==128&&(l=(31&c)<<6|63&i)>127&&(u=l);break;case 3:i=e[s+1],a=e[s+2],(192&i)==128&&(192&a)==128&&(l=(15&c)<<12|(63&i)<<6|63&a)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:i=e[s+1],a=e[s+2],o=e[s+3],(192&i)==128&&(192&a)==128&&(192&o)==128&&(l=(15&c)<<18|(63&i)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(u=l)}null===u?(u=65533,h=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),s+=h}var d=n,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",m=0;m<f;)p+=String.fromCharCode.apply(String,d.slice(m,m+=4096));return p}function x(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function v(e,t,r,n,s,i){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<i)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function w(e,t,r,n,s,i){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function I(e,t,r,n,i){return t*=1,r>>>=0,i||w(e,t,r,4,34028234663852886e22,-34028234663852886e22),s.write(e,t,r,n,23,4),r+4}function _(e,t,r,n,i){return t*=1,r>>>=0,i||w(e,t,r,8,17976931348623157e292,-17976931348623157e292),s.write(e,t,r,n,52,8),r+8}o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var s,i,a,o,l,c,u,h,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var s=e.length-r;n?(n=Number(n))>s&&(n=s):n=s;var i=t.length;n>i/2&&(n=i/2);for(var a=0;a<n;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return s=t,i=r,C(T(e,this.length-s),this,s,i);case"ascii":return a=t,o=r,C(N(e),this,a,o);case"latin1":case"binary":return function(e,t,r,n){return C(N(t),e,r,n)}(this,e,t,r);case"base64":return l=t,c=r,C(S(e),this,l,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,h=r,C(function(e,t){for(var r,n,s=[],i=0;i<e.length&&!((t-=2)<0);++i)n=(r=e.charCodeAt(i))>>8,s.push(r%256),s.push(n);return s}(e,this.length-u),this,u,h);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,o.prototype),n},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||x(e,t,this.length);for(var n=this[e],s=1,i=0;++i<t&&(s*=256);)n+=this[e+i]*s;return n},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||x(e,t,this.length);for(var n=this[e+--t],s=1;t>0&&(s*=256);)n+=this[e+--t]*s;return n},o.prototype.readUInt8=function(e,t){return e>>>=0,t||x(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||x(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||x(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||x(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||x(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||x(e,t,this.length);for(var n=this[e],s=1,i=0;++i<t&&(s*=256);)n+=this[e+i]*s;return n>=(s*=128)&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||x(e,t,this.length);for(var n=t,s=1,i=this[e+--n];n>0&&(s*=256);)i+=this[e+--n]*s;return i>=(s*=128)&&(i-=Math.pow(2,8*t)),i},o.prototype.readInt8=function(e,t){return(e>>>=0,t||x(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||x(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||x(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||x(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||x(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||x(e,4,this.length),s.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||x(e,4,this.length),s.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||x(e,8,this.length),s.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||x(e,8,this.length),s.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var s=Math.pow(2,8*r)-1;v(this,e,t,r,s,0)}var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var s=Math.pow(2,8*r)-1;v(this,e,t,r,s,0)}var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var s=Math.pow(2,8*r-1);v(this,e,t,r,s-1,-s)}var i=0,a=1,o=0;for(this[t]=255&e;++i<r&&(a*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var s=Math.pow(2,8*r-1);v(this,e,t,r,s-1,-s)}var i=r-1,a=1,o=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/a|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return I(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return I(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return _(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return _(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var s=n-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,n);else if(this===e&&r<t&&t<n)for(var i=s-1;i>=0;--i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,n),t);return s},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var s,i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var a=o.isBuffer(e)?e:o.from(e,n),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<r-t;++s)this[s+t]=a[s%l]}return this};var E=/[^+/0-9A-Za-z-_]/g;function T(e,t){t=t||1/0;for(var r,n=e.length,s=null,i=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!s){if(r>56319||a+1===n){(t-=3)>-1&&i.push(239,191,189);continue}s=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),s=r;continue}r=(s-55296<<10|r-56320)+65536}else s&&(t-=3)>-1&&i.push(239,191,189);if(s=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return i}function N(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function S(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(E,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function C(e,t,r,n){for(var s=0;s<n&&!(s+r>=t.length)&&!(s>=e.length);++s)t[s+r]=e[s];return s}function k(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var A=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,s=0;s<16;++s)t[n+s]=e[r]+e[s];return t}()},783:function(e,t){t.read=function(e,t,r,n,s){var i,a,o=8*s-n-1,l=(1<<o)-1,c=l>>1,u=-7,h=r?s-1:0,d=r?-1:1,f=e[t+h];for(h+=d,i=f&(1<<-u)-1,f>>=-u,u+=o;u>0;i=256*i+e[t+h],h+=d,u-=8);for(a=i&(1<<-u)-1,i>>=-u,u+=n;u>0;a=256*a+e[t+h],h+=d,u-=8);if(0===i)i=1-c;else{if(i===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),i-=c}return(f?-1:1)*a*Math.pow(2,i-n)},t.write=function(e,t,r,n,s,i){var a,o,l,c=8*i-s-1,u=(1<<c)-1,h=u>>1,d=5960464477539062e-23*(23===s),f=n?0:i-1,p=n?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+h>=1?t+=d/l:t+=d*Math.pow(2,1-h),t*l>=2&&(a++,l/=2),a+h>=u?(o=0,a=u):a+h>=1?(o=(t*l-1)*Math.pow(2,s),a+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,s),a=0));s>=8;e[r+f]=255&o,f+=p,o/=256,s-=8);for(a=a<<s|o,c+=s;c>0;e[r+f]=255&a,f+=p,a/=256,c-=8);e[r+f-p]|=128*m}}},s={};function i(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={exports:{}},a=!0;try{n[e](r,r.exports,i),a=!1}finally{a&&delete s[e]}return r.exports}i.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=i(72)},74647,e=>{"use strict";let t,r,n,s,i,a,o;var l,c,u,h,d,f,p,m,g,y,b,x,v,w,I,_,E,T=e.i(43476),N=e.i(71645),S=e.i(47167);let C=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let s=e.charCodeAt(n);s<128?t[r++]=s:(s<2048?t[r++]=s>>6|192:((64512&s)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++n)),t[r++]=s>>18|240,t[r++]=s>>12&63|128):t[r++]=s>>12|224,t[r++]=s>>6&63|128),t[r++]=63&s|128)}return t},k=function(e){let t=[],r=0,n=0;for(;r<e.length;){let s=e[r++];if(s<128)t[n++]=String.fromCharCode(s);else if(s>191&&s<224){let i=e[r++];t[n++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){let i=((7&s)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(i>>10)),t[n++]=String.fromCharCode(56320+(1023&i))}else{let i=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&a)}}return t.join("")},A={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let s=e[t],i=t+1<e.length,a=i?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,c=s>>2,u=(3&s)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,i||(h=64)),n.push(r[c],r[u],r[h],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(C(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):k(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let s=r[e.charAt(t++)],i=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==s||null==i||null==a||null==o)throw new j;let l=s<<2|i>>4;if(n.push(l),64!==a){let e=i<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class j extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let D=function(e){let t=C(e);return A.encodeByteArray(t,!0)},R=function(e){return D(e).replace(/\./g,"")},P=function(e){try{return A.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function O(){return"u">typeof self?self:"u">typeof window?window:e.g}let M=()=>{try{return O().__FIREBASE_DEFAULTS__||(()=>{if(void 0===S.default||void 0===S.default.env)return;let e=S.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("u"<typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&P(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},L=e=>M()?.emulatorHosts?.[e],F=()=>M()?.config,V=e=>M()?.[`_${e}`];class U{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function B(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function q(e){return(await fetch(e,{credentials:"include"})).ok}let z={},$=!1;function G(e,t){if("u"<typeof window||"u"<typeof document||!B(window.location.host)||z[e]===t||z[e]||$)return;function r(e){return`__firebase__banner__${e}`}z[e]=t;let n="__firebase__banner",s=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(z))z[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){let e,t,i=(e=document.getElementById(n),t=!1,e||((e=document.createElement("div")).setAttribute("id",n),t=!0),{created:t,element:e}),a=r("text"),o=document.getElementById(a)||document.createElement("span"),l=r("learnmore"),c=document.getElementById(l)||document.createElement("a"),u=r("preprendIcon"),h=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(i.created){let e,t=i.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",c.setAttribute("id",l),c.innerText="Learn more",c.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",c.setAttribute("target","__blank"),c.style.paddingLeft="5px",c.style.textDecoration="underline";let r=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;$=!0,(e=document.getElementById(n))&&e.remove()},e);h.setAttribute("width","24"),h.setAttribute("id",u),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px",t.append(h,o,c,r),document.body.appendChild(t)}s?(o.innerText="Preview backend disconnected.",h.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(h.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",i):i()}function K(){return"u">typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function H(){let t=M()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}function W(){return"u">typeof WorkerGlobalScope&&"u">typeof self&&self instanceof WorkerGlobalScope}function Q(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function J(){return!H()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Y(){return!H()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function X(){try{return"object"==typeof indexedDB}catch(e){return!1}}function Z(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},s.onupgradeneeded=()=>{r=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}function ee(){return!("u"<typeof navigator)&&!!navigator.cookieEnabled}class et extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,et.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,er.prototype.create)}}class er{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,n;let s=t[0]||{},i=`${this.service}/${e}`,a=this.errors[e],o=a?(r=a,n=s,r.replace(en,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${i}).`;return new et(i,l,s)}}let en=/\{\$([^}]+)}/g;function es(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let s of r){if(!n.includes(s))return!1;let r=e[s],i=t[s];if(ei(r)&&ei(i)){if(!es(r,i))return!1}else if(r!==i)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function ei(e){return null!==e&&"object"==typeof e}function ea(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function eo(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function el(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}class ec{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:r}:e).next&&(n.next=eu),void 0===n.error&&(n.error=eu),void 0===n.complete&&(n.complete=eu);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"u">typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eu(){}function eh(e,t=1e3,r=2){let n=t*Math.pow(r,e),s=Math.round(.5*n*(Math.random()-.5)*2);return Math.min(144e5,n+s)}function ed(e){return e&&e._delegate?e._delegate:e}class ef{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ep="[DEFAULT]";class em{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new U;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ep})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=ep){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ep){return this.instances.has(e)}getOptions(e=ep){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let s=this.instances.get(r);return s&&e(s,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===ep?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=ep){return this.component?this.component.multipleInstances?e:ep:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eg{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new em(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let ey=[];(l=u||(u={}))[l.DEBUG=0]="DEBUG",l[l.VERBOSE=1]="VERBOSE",l[l.INFO=2]="INFO",l[l.WARN=3]="WARN",l[l.ERROR=4]="ERROR",l[l.SILENT=5]="SILENT";let eb={debug:u.DEBUG,verbose:u.VERBOSE,info:u.INFO,warn:u.WARN,error:u.ERROR,silent:u.SILENT},ex=u.INFO,ev={[u.DEBUG]:"log",[u.VERBOSE]:"log",[u.INFO]:"info",[u.WARN]:"warn",[u.ERROR]:"error"},ew=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),s=ev[t];if(s)console[s](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eI{constructor(e){this.name=e,this._logLevel=ex,this._logHandler=ew,this._userLogHandler=null,ey.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in u))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eb[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,u.DEBUG,...e),this._logHandler(this,u.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,u.VERBOSE,...e),this._logHandler(this,u.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,u.INFO,...e),this._logHandler(this,u.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,u.WARN,...e),this._logHandler(this,u.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,u.ERROR,...e),this._logHandler(this,u.ERROR,...e)}}let e_=new WeakMap,eE=new WeakMap,eT=new WeakMap,eN=new WeakMap,eS=new WeakMap,eC={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return eE.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eT.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return ek(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ek(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(ek(e.result)),n()},i=()=>{r(e.error),n()};e.addEventListener("success",s),e.addEventListener("error",i)})).then(t=>{t instanceof IDBCursor&&e_.set(t,e)}).catch(()=>{}),eS.set(t,e),t}if(eN.has(e))return eN.get(e);let n=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eA(this),t),ek(e_.get(this))}:function(...t){return ek(e.apply(eA(this),t))}:function(t,...r){let n=e.call(eA(this),t,...r);return eT.set(n,t.sort?t.sort():[t]),ek(n)};return e instanceof IDBTransaction&&function(e){if(eE.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),n()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)});eE.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,eC):e}(e);return n!==e&&(eN.set(e,n),eS.set(n,e)),n}let eA=e=>eS.get(e);function ej(e,t,{blocked:r,upgrade:n,blocking:s,terminated:i}={}){let a=indexedDB.open(e,t),o=ek(a);return n&&a.addEventListener("upgradeneeded",e=>{n(ek(a.result),e.oldVersion,e.newVersion,ek(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{i&&e.addEventListener("close",()=>i()),s&&e.addEventListener("versionchange",e=>s(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let eD=["get","getKey","getAll","getAllKeys","count"],eR=["put","add","delete","clear"],eP=new Map;function eO(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eP.get(t))return eP.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,s=eR.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(s||eD.includes(r)))return;let i=async function(e,...t){let i=this.transaction(e,s?"readwrite":"readonly"),a=i.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),s&&i.done]))[0]};return eP.set(t,i),i}eC={...o=eC,get:(e,t,r)=>eO(e,t)||o.get(e,t,r),has:(e,t)=>!!eO(e,t)||o.has(e,t)};class eM{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let eL="@firebase/app",eF="0.14.7",eV=new eI("@firebase/app"),eU="[DEFAULT]",eB={[eL]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},eq=new Map,ez=new Map,e$=new Map;function eG(e,t){try{e.container.addComponent(t)}catch(r){eV.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function eK(e,t){e.container.addOrOverwriteComponent(t)}function eH(e){let t=e.name;if(e$.has(t))return eV.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(e$.set(t,e),eq.values()))eG(r,e);for(let t of ez.values())eG(t,e);return!0}function eW(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function eQ(e,t,r=eU){eW(e,t).clearInstance(r)}function eJ(e){return void 0!==e.options}function eY(e){return!eJ(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function eX(e){return null!=e&&void 0!==e.settings}function eZ(){e$.clear()}let e0=new er("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class e1{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ef("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw e0.create("app-deleted",{appName:this._name})}}function e2(e,t){let r=P(e.split(".")[1]);null===r?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class e5 extends e1{constructor(e,t,r,n){const s=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,i={name:r,automaticDataCollectionEnabled:s};void 0!==e.apiKey?super(e,i,n):super(e.options,i,n),this._serverConfig={automaticDataCollectionEnabled:s,...t},this._serverConfig.authIdToken&&e2(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&e2(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"u">typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,te(eL,eF,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){e9(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw e0.create("server-app-deleted")}}let e6="12.8.0";function e4(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:eU,automaticDataCollectionEnabled:!0,...t},s=n.name;if("string"!=typeof s||!s)throw e0.create("bad-app-name",{appName:String(s)});if(r||(r=F()),!r)throw e0.create("no-options");let i=eq.get(s);if(i)if(es(r,i.options)&&es(n,i.config))return i;else throw e0.create("duplicate-app",{appName:s});let a=new eg(s);for(let e of e$.values())a.addComponent(e);let o=new e1(r,n,a);return eq.set(s,o),o}function e3(e,t={}){let r;if(("u">typeof window||W())&&!W())throw e0.create("invalid-server-app-environment");let n=t||{};if(e&&(eJ(e)?r=e.options:eY(e)?n=e:r=e),void 0===n.automaticDataCollectionEnabled&&(n.automaticDataCollectionEnabled=!0),r||(r=F()),!r)throw e0.create("no-options");let s={...n,...r};if(void 0!==s.releaseOnDeref&&delete s.releaseOnDeref,void 0!==n.releaseOnDeref&&"u"<typeof FinalizationRegistry)throw e0.create("finalization-registry-not-supported",{});let i=""+[...JSON.stringify(s)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),a=ez.get(i);if(a)return a.incRefCount(n.releaseOnDeref),a;let o=new eg(i);for(let e of e$.values())o.addComponent(e);let l=new e5(r,n,i,o);return ez.set(i,l),l}function e8(e=eU){let t=eq.get(e);if(!t&&e===eU&&F())return e4();if(!t)throw e0.create("no-app",{appName:e});return t}function e7(){return Array.from(eq.values())}async function e9(e){let t=!1,r=e.name;eq.has(r)?(t=!0,eq.delete(r)):ez.has(r)&&0>=e.decRefCount()&&(ez.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function te(e,t,r){let n=eB[e]??e;r&&(n+=`-${r}`);let s=n.match(/\s|\//),i=t.match(/\s|\//);if(s||i){let e=[`Unable to register library "${n}" with version "${t}":`];s&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&i&&e.push("and"),i&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),eV.warn(e.join(" "));return}eH(new ef(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}function tt(e,t){if(null!==e&&"function"!=typeof e)throw e0.create("invalid-log-argument");for(let r of ey){let n=null;t&&t.level&&(n=eb[t.level]),null===e?r.userLogHandler=null:r.userLogHandler=(t,r,...s)=>{let i=s.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");r>=(n??t.logLevel)&&e({level:u[r].toLowerCase(),message:i,args:s,type:t.name})}}}function tr(e){ey.forEach(t=>{t.setLogLevel(e)})}let tn="firebase-heartbeat-store",ts=null;function ti(){return ts||(ts=ej("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tn)}catch(e){console.warn(e)}}}).catch(e=>{throw e0.create("idb-open",{originalErrorMessage:e.message})})),ts}async function ta(e){try{let t=(await ti()).transaction(tn),r=await t.objectStore(tn).get(tl(e));return await t.done,r}catch(e){if(e instanceof et)eV.warn(e.message);else{let t=e0.create("idb-get",{originalErrorMessage:e?.message});eV.warn(t.message)}}}async function to(e,t){try{let r=(await ti()).transaction(tn,"readwrite"),n=r.objectStore(tn);await n.put(t,tl(e)),await r.done}catch(e){if(e instanceof et)eV.warn(e.message);else{let t=e0.create("idb-set",{originalErrorMessage:e?.message});eV.warn(t.message)}}}function tl(e){return`${e.name}!${e.options.appId}`}class tc{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new th(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tu();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){eV.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tu(),{heartbeatsToSend:t,unsentEntries:r}=function(e,t=1024){let r=[],n=e.slice();for(let s of e){let e=r.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),td(r)>t){e.dates.pop();break}}else if(r.push({agent:s.agent,dates:[s.date]}),td(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),n=R(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return eV.warn(e),""}}}function tu(){return new Date().toISOString().substring(0,10)}class th{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!X()&&Z().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await ta(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return to(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return to(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function td(e){return R(JSON.stringify({version:2,heartbeats:e})).length}eH(new ef("platform-logger",e=>new eM(e),"PRIVATE")),eH(new ef("heartbeat",e=>new tc(e),"PRIVATE")),te(eL,eF,""),te(eL,eF,"esm2020"),te("fire-js",""),e.s(["SDK_VERSION",()=>e6,"_DEFAULT_ENTRY_NAME",()=>eU,"_addComponent",()=>eG,"_addOrOverwriteComponent",()=>eK,"_apps",()=>eq,"_clearComponents",()=>eZ,"_components",()=>e$,"_getProvider",()=>eW,"_isFirebaseApp",()=>eJ,"_isFirebaseServerApp",()=>eX,"_isFirebaseServerAppSettings",()=>eY,"_registerComponent",()=>eH,"_removeServiceInstance",()=>eQ,"_serverApps",()=>ez,"deleteApp",()=>e9,"getApp",()=>e8,"getApps",()=>e7,"initializeApp",()=>e4,"initializeServerApp",()=>e3,"onLog",()=>tt,"registerVersion",()=>te,"setLogLevel",()=>tr],92953),te("firebase","12.8.0","app"),e.i(92953);var tf=e.i(67034),tp="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,tm={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function r(){}function n(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var s=0;s<16;++s)n[s]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(s=0;s<16;++s)n[s]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],s=e.g[2];let i=e.g[3],a;a=t+(i^r&(s^i))+n[0]+0xd76aa478|0,a=i+(s^(t=r+(a<<7|a>>>25))&(r^s))+n[1]+0xe8c7b756|0,a=s+(r^(i=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(s=i+(a<<17|a>>>15))&(i^t))+n[3]+0xc1bdceee|0,a=t+(i^(r=s+(a<<22|a>>>10))&(s^i))+n[4]+0xf57c0faf|0,a=i+(s^(t=r+(a<<7|a>>>25))&(r^s))+n[5]+0x4787c62a|0,a=s+(r^(i=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(s=i+(a<<17|a>>>15))&(i^t))+n[7]+0xfd469501|0,a=t+(i^(r=s+(a<<22|a>>>10))&(s^i))+n[8]+0x698098d8|0,a=i+(s^(t=r+(a<<7|a>>>25))&(r^s))+n[9]+0x8b44f7af|0,a=s+(r^(i=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(s=i+(a<<17|a>>>15))&(i^t))+n[11]+0x895cd7be|0,a=t+(i^(r=s+(a<<22|a>>>10))&(s^i))+n[12]+0x6b901122|0,a=i+(s^(t=r+(a<<7|a>>>25))&(r^s))+n[13]+0xfd987193|0,a=s+(r^(i=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(s=i+(a<<17|a>>>15))&(i^t))+n[15]+0x49b40821|0,r=s+(a<<22|a>>>10),a=t+(s^i&(r^s))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=i+(r^s&(t^r))+n[6]+0xc040b340|0,i=t+(a<<9|a>>>23),a=s+(t^r&(i^t))+n[11]+0x265e5a51|0,s=i+(a<<14|a>>>18),a=r+(i^t&(s^i))+n[0]+0xe9b6c7aa|0,r=s+(a<<20|a>>>12),a=t+(s^i&(r^s))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=i+(r^s&(t^r))+n[10]+0x2441453|0,i=t+(a<<9|a>>>23),a=s+(t^r&(i^t))+n[15]+0xd8a1e681|0,s=i+(a<<14|a>>>18),a=r+(i^t&(s^i))+n[4]+0xe7d3fbc8|0,r=s+(a<<20|a>>>12),a=t+(s^i&(r^s))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=i+(r^s&(t^r))+n[14]+0xc33707d6|0,i=t+(a<<9|a>>>23),a=s+(t^r&(i^t))+n[3]+0xf4d50d87|0,s=i+(a<<14|a>>>18),a=r+(i^t&(s^i))+n[8]+0x455a14ed|0,r=s+(a<<20|a>>>12),a=t+(s^i&(r^s))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=i+(r^s&(t^r))+n[2]+0xfcefa3f8|0,i=t+(a<<9|a>>>23),a=s+(t^r&(i^t))+n[7]+0x676f02d9|0,s=i+(a<<14|a>>>18),a=r+(i^t&(s^i))+n[12]+0x8d2a4c8a|0,a=t+((r=s+(a<<20|a>>>12))^s^i)+n[5]+0xfffa3942|0,a=i+((t=r+(a<<4|a>>>28))^r^s)+n[8]+0x8771f681|0,a=s+((i=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((s=i+(a<<16|a>>>16))^i^t)+n[14]+0xfde5380c|0,a=t+((r=s+(a<<23|a>>>9))^s^i)+n[1]+0xa4beea44|0,a=i+((t=r+(a<<4|a>>>28))^r^s)+n[4]+0x4bdecfa9|0,a=s+((i=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((s=i+(a<<16|a>>>16))^i^t)+n[10]+0xbebfbc70|0,a=t+((r=s+(a<<23|a>>>9))^s^i)+n[13]+0x289b7ec6|0,a=i+((t=r+(a<<4|a>>>28))^r^s)+n[0]+0xeaa127fa|0,a=s+((i=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((s=i+(a<<16|a>>>16))^i^t)+n[6]+0x4881d05|0,a=t+((r=s+(a<<23|a>>>9))^s^i)+n[9]+0xd9d4d039|0,a=i+((t=r+(a<<4|a>>>28))^r^s)+n[12]+0xe6db99e5|0,a=s+((i=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((s=i+(a<<16|a>>>16))^i^t)+n[2]+0xc4ac5665|0,r=s+(a<<23|a>>>9),a=t+(s^(r|~i))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=i+(r^(t|~s))+n[7]+0x432aff97|0,i=t+(a<<10|a>>>22),a=s+(t^(i|~r))+n[14]+0xab9423a7|0,s=i+(a<<15|a>>>17),a=r+(i^(s|~t))+n[5]+0xfc93a039|0,r=s+(a<<21|a>>>11),a=t+(s^(r|~i))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=i+(r^(t|~s))+n[3]+0x8f0ccc92|0,i=t+(a<<10|a>>>22),a=s+(t^(i|~r))+n[10]+0xffeff47d|0,s=i+(a<<15|a>>>17),a=r+(i^(s|~t))+n[1]+0x85845dd1|0,r=s+(a<<21|a>>>11),a=t+(s^(r|~i))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=i+(r^(t|~s))+n[15]+0xfe2ce6e0|0,i=t+(a<<10|a>>>22),a=s+(t^(i|~r))+n[6]+0xa3014314|0,s=i+(a<<15|a>>>17),a=r+(i^(s|~t))+n[13]+0x4e0811a1|0,r=s+(a<<21|a>>>11),a=t+(s^(r|~i))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=i+(r^(t|~s))+n[11]+0xbd3af235|0,i=t+(a<<10|a>>>22),a=s+(t^(i|~r))+n[2]+0x2ad7d2bb|0,s=i+(a<<15|a>>>17),a=r+(i^(s|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(s+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+s|0,e.g[3]=e.g[3]+i|0}function s(e,t){this.h=t;let r=[],n=!0;for(let s=e.length-1;s>=0;s--){let i=0|e[s];n&&i==t||(r[s]=i,n=!1)}this.g=r}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[r].apply(e,s)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let r=t-this.blockSize,s=this.C,i=this.h,a=0;for(;a<t;){if(0==i)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(s[i++]=e.charCodeAt(a++),i==this.blockSize){n(this,s),i=0;break}}else for(;a<t;)if(s[i++]=e[a++],i==this.blockSize){n(this,s),i=0;break}}this.h=i,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var i,a={};function o(e){var t;return -128<=e&&e<128?(t=function(e){return new s([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(a,e)?a[e]:a[e]=t(e)):new s([0|e],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return c;if(e<0)return g(l(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new s(t,0)}var c=o(0),u=o(1),f=o(0x1000000);function p(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function g(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new s(r,~e.h).add(u)}function y(e,t){return e.add(g(t))}function b(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function x(e,t){this.g=e,this.h=t}function v(e,t){if(p(t))throw Error("division by zero");if(p(e))return new x(c,c);if(m(e))return t=v(g(e),t),new x(g(t.g),g(t.h));if(m(t))return t=v(e,g(t)),new x(g(t.g),t.h);if(e.g.length>30){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var r=u,n=t;0>=n.l(e);)r=w(r),n=w(n);var s=I(r,1),i=I(n,1);for(n=I(n,2),r=I(r,2);!p(n);){var a=i.add(n);0>=a.l(e)&&(s=s.add(r),i=a),n=I(n,1),r=I(r,1)}return t=y(e,s.j(t)),new x(s,t)}for(s=c;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(i=l(r)).j(t);m(a)||a.l(e)>0;)r-=n,a=(i=l(r)).j(t);p(i)&&(i=u),s=s.add(i),e=y(e,a)}return new x(s,e)}function w(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new s(r,e.h)}function I(e,t){let r=t>>5;t%=32;let n=e.g.length-r,i=[];for(let s=0;s<n;s++)i[s]=t>0?e.i(s+r)>>>t|e.i(s+r+1)<<32-t:e.i(s+r);return new s(i,e.h)}(i=s.prototype).m=function(){if(m(this))return-g(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},i.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(m(this))return"-"+g(this).toString(e);let t=l(Math.pow(e,6));var r=this;let n="";for(;;){let s=v(r,t).g,i=(((r=y(r,s.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(p(r=s))return i+n;for(;i.length<6;)i="0"+i;n=i+n}},i.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},i.l=function(e){return m(e=y(this,e))?-1:+!p(e)},i.abs=function(){return m(this)?g(this):this},i.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],n=0;for(let s=0;s<=t;s++){let t=n+(65535&this.i(s))+(65535&e.i(s)),i=(t>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);n=i>>>16,t&=65535,i&=65535,r[s]=i<<16|t}return new s(r,-0x80000000&r[r.length-1]?-1:0)},i.j=function(e){if(p(this)||p(e))return c;if(m(this))return m(e)?g(this).j(g(e)):g(g(this).j(e));if(m(e))return g(this.j(g(e)));if(0>this.l(f)&&0>e.l(f))return l(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){let s=this.i(n)>>>16,i=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);r[2*n+2*t]+=i*o,b(r,2*n+2*t),r[2*n+2*t+1]+=s*o,b(r,2*n+2*t+1),r[2*n+2*t+1]+=i*a,b(r,2*n+2*t+1),r[2*n+2*t+2]+=s*a,b(r,2*n+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new s(r,0)},i.B=function(e){return v(this,e).h},i.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new s(r,this.h&e.h)},i.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new s(r,this.h|e.h)},i.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new s(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,d=tm.Md5=e,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.B,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=l,s.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return g(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let n=l(Math.pow(r,8)),s=c;for(let e=0;e<t.length;e+=8){var i=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+i),r);i<8?(i=l(Math.pow(r,i)),s=s.j(i).add(l(a))):s=(s=s.j(n)).add(l(a))}return s},h=tm.Integer=s}).apply(void 0!==tp?tp:"u">typeof self?self:"u">typeof window?window:{});var tg="u">typeof globalThis?globalThis:"u">typeof window?window:e.g,ty={};(function(){var e,t,r=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof tg&&tg];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function s(e,t){if(t)e:{var s=n;e=e.split(".");for(var i=0;i<e.length-1;i++){var a=e[i];if(!(a in s))break e;s=s[a]}(t=t(i=s[e=e[e.length-1]]))!=i&&null!=t&&r(s,e,{configurable:!0,writable:!0,value:t})}}s("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var i=i||{},a=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function l(e,t,r){return e.call.apply(e.bind,arguments)}function c(e,t,r){return(c=l).apply(null,arguments)}function u(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function h(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,n){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[r].apply(e,s)}}var d="u">typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function w(e){let t=e.length;if(t>0){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function I(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];var r=typeof n;if("array"==(r="object"!=r?r:n?Array.isArray(n)?"array":r:"null")||"object"==r&&"number"==typeof n.length){r=e.length||0;let t=n.length||0;e.length=r+t;for(let s=0;s<t;s++)e[r+s]=n[s]}else e.push(n)}}var _=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new E,e=>e.reset());class E{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let T,N=!1,S=new class{constructor(){this.h=this.g=null}add(e,t){let r=_.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},C=()=>{let e=Promise.resolve(void 0);T=()=>{e.then(k)}};function k(){let e;for(var t;e=null,S.g&&(e=S.g,S.g=S.g.next,S.g||(S.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}_.j(t),_.h<100&&(_.h++,t.next=_.g,_.g=t)}N=!1}function A(){this.u=this.u,this.C=this.C}function j(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}A.prototype.u=!1,A.prototype.dispose=function(){this.u||(this.u=!0,this.N())},A.prototype[Symbol.dispose]=function(){this.dispose()},A.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},j.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function R(e){return/^[\s\xa0]*$/.test(e)}function P(e,t){j.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}h(P,j),P.prototype.init=function(e,t){let r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&P.Z.h.call(this)},P.prototype.h=function(){P.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var O="closure_listenable_"+(1e6*Math.random()|0),M=0;function L(e,t,r,n,s){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=s,this.key=++M,this.da=this.fa=!1}function F(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function V(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function U(e){let t={};for(let r in e)t[r]=e[r];return t}let B="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function q(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<B.length;t++)r=B[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function z(e){this.src=e,this.g={},this.h=0}function $(e,t){let r=t.type;if(r in e.g){var n,s=e.g[r],i=Array.prototype.indexOf.call(s,t,void 0);(n=i>=0)&&Array.prototype.splice.call(s,i,1),n&&(F(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function G(e,t,r,n){for(let s=0;s<e.length;++s){let i=e[s];if(!i.da&&i.listener==t&&!!r==i.capture&&i.ha==n)return s}return -1}z.prototype.add=function(e,t,r,n,s){let i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);let a=G(e,t,n,s);return a>-1?(t=e[a],r||(t.fa=!1)):((t=new L(t,this.src,i,!!n,s)).fa=r,e.push(t)),t};var K="closure_lm_"+(1e6*Math.random()|0),H={};function W(e,t,r,n,s,i){if(!t)throw Error("Invalid event type");let a=o(s)?!!s.capture:!!s,l=X(e);if(l||(e[K]=l=new z(e)),(r=l.add(t,r,n,a,i)).proxy)return r;if(n=function e(t){return Y.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)D||(s=a),void 0===s&&(s=!1),e.addEventListener(t.toString(),n,s);else if(e.attachEvent)e.attachEvent(J(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function Q(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[O])$(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(J(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=X(t))?($(r,e),0==r.h&&(r.src=null,t[K]=null)):F(e)}}}function J(e){return e in H?H[e]:H[e]="on"+e}function Y(e,t){if(e.da)e=!0;else{t=new P(t,this);let r=e.listener,n=e.ha||e.src;e.fa&&Q(e),e=r.call(n,t)}return e}function X(e){return(e=e[K])instanceof z?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){A.call(this),this.i=new z(this),this.M=this,this.G=null}function er(e,t){let r,n;var s,i=e.G;if(i)for(s=[];i;i=i.G)s.push(i);if(e=e.M,i=t.type||t,"string"==typeof t)t=new j(t,e);else if(t instanceof j)t.target=t.target||e;else{var a=t;q(t=new j(i,e),a)}if(a=!0,s)for(n=s.length-1;n>=0;n--)a=en(r=t.g=s[n],i,!0,t)&&a;if(a=en(r=t.g=e,i,!0,t)&&a,a=en(r,i,!1,t)&&a,s)for(n=0;n<s.length;n++)a=en(r=t.g=s[n],i,!1,t)&&a}function en(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let s=!0;for(let i=0;i<t.length;++i){let a=t[i];if(a&&!a.da&&a.capture==r){let t=a.listener,r=a.ha||a.src;a.fa&&$(e.i,a),s=!1!==t.call(r,n)&&s}}return s&&!n.defaultPrevented}h(et,A),et.prototype[O]=!0,et.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,s,i){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,s,i);else(s=o(s)?!!s.capture:!!s,n=ee(n),t&&t[O])?(t=t.i,(a=String(r).toString())in t.g&&(n=G(r=t.g[a],n,s,i))>-1&&(F(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[a],t.h--))):t&&(t=X(t))&&(r=t.g[r.toString()],t=-1,r&&(t=G(r,n,s,i)),(n=t>-1?r[t]:null)&&Q(n))}(this,e,t,r,n)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let r=e.g[t];for(let e=0;e<r.length;e++)F(r[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},et.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class es extends A{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=c(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:a.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ei(e){A.call(this),this.h=e,this.g={}}h(ei,A);var ea=[];function eo(e){V(e.g,function(e,t){this.g.hasOwnProperty(t)&&Q(e)},e),e.g={}}ei.prototype.N=function(){ei.Z.N.call(this),eo(this)},ei.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=a.JSON.stringify,ec=a.JSON.parse,eu=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function eh(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){j.call(this,"d")}function em(){j.call(this,"c")}h(ep,j),h(em,j);var eg={},ey=null;function eb(){return ey=ey||new et}function ex(e){j.call(this,eg.Ia,e)}function ev(e){let t=eb();er(t,new ex(t))}function ew(e,t){j.call(this,eg.STAT_EVENT,e),this.stat=t}function eI(e){let t=eb();er(t,new ew(t,e))}function e_(e,t){j.call(this,eg.Ja,e),this.size=t}function eE(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eT(){this.g=!0}function eN(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let i=JSON.parse(t);if(i){for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var r=i[e];if(!(r.length<2)){var n=r[1];if(Array.isArray(n)&&!(n.length<1)){var s=n[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(let e=1;e<n.length;e++)n[e]=""}}}}return el(i)}catch(e){return t}}(e,r)+(n?" "+n:"")})}eg.Ia="serverreachability",h(ex,j),eg.STAT_EVENT="statevent",h(ew,j),eg.Ja="timingevent",h(e_,j),eT.prototype.ua=function(){this.g=!1},eT.prototype.info=function(){};var eS={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eC={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function ek(){}function eA(e){return encodeURIComponent(String(e))}function ej(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new ei(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eD}function eD(){this.i=null,this.g="",this.h=!1}h(ek,eh),ek.prototype.g=function(){return new XMLHttpRequest},e=new ek;var eR={},eP={};function eO(e,t,r){e.M=1,e.A=e4(e0(t)),e.u=r,e.R=!0,eM(e,null)}function eM(e,t){e.F=Date.now(),eF(e),e.B=e0(e.A);var r,n,s,i,a,l,u=e.B,h=e.S;Array.isArray(h)||(h=[String(h)]),tc(u.i,"t",h),e.C=0,u=e.j.L,e.h=new eD,e.g=tY(e.j,u?t:null,!e.u),e.P>0&&(e.O=new es(c(e.Y,e,e.g),e.P)),t=e.V,u=e.g,h=e.ba;var d="readystatechange";Array.isArray(d)||(d&&(ea[0]=d.toString()),d=ea);for(let e=0;e<d.length;e++){let r=function e(t,r,n,s,i){if(s&&s.once)return function e(t,r,n,s,i){if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,s,i);return null}return n=ee(n),t&&t[O]?t.K(r,n,o(s)?!!s.capture:!!s,i):W(t,r,n,!0,s,i)}(t,r,n,s,i);if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,s,i);return null}return n=ee(n),t&&t[O]?t.J(r,n,o(s)?!!s.capture:!!s,i):W(t,r,n,!1,s,i)}(u,d[e],h||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?U(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ev(),r=e.i,n=e.v,s=e.B,i=e.l,a=e.S,l=e.u,r.info(function(){if(r.g)if(l){var e="",t=l.split("&");for(let r=0;r<t.length;r++){var o=t[r].split("=");if(o.length>1){let t=o[0];o=o[1];let r=t.split("_");e=r.length>=2&&"type"==r[1]?e+(t+"=")+o+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+i+") [attempt "+a+"]: "+n+"\n"+s+"\n"+e})}function eL(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eF(e){e.T=Date.now()+e.H,eV(e,e.H)}function eV(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eE(c(e.aa,e),t)}function eU(e){e.D&&(a.clearTimeout(e.D),e.D=null)}function eB(e){0==e.j.I||e.K||tK(e.j,e)}function eq(e){eU(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ez(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||eW(r.h,e))){if(!e.L&&eW(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var s=n;if(0==s[0]){e:if(!r.v){if(r.g)if(r.g.F+3e3<e.F)tG(r),tO(r);else break e;tq(r),eI(18)}}else r.xa=s[1],0<r.xa-r.K&&s[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=eE(c(r.Va,r),6e3));1>=eH(r.h)&&r.ta&&(r.ta=void 0)}else tW(r,11)}else if((e.L||r.g==e)&&tG(r),!R(t))for(s=r.Ba.g.parse(t),t=0;t<s.length;t++){let o=s[t],l=o[0];if(!(l<=r.K))if(r.K=l,o=o[1],2==r.I)if("c"==o[0]){r.M=o[1],r.ba=o[2];let t=o[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));let s=o[4];null!=s&&(r.za=s,r.j.info("SVER="+r.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(r.O=n=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let c=e.g;if(c){let e=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=n.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(eQ(i,i.h),i.h=null))}if(n.G){let e=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,e6(n.J,n.G,e))}}if(r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),(n=r).na=tJ(n,n.L?n.ba:null,n.W),e.L){eJ(n.h,e);var a=n.O;a&&(e.H=a),e.D&&(eU(e),eF(e)),n.g=e}else tB(n);r.i.length>0&&tL(r)}else"stop"!=o[0]&&"close"!=o[0]||tW(r,7);else 3==r.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tW(r,7):tP(r):"noop"!=o[0]&&r.l&&r.l.qa(o),r.A=0)}}ev(4)}catch(e){}}ej.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tA(e)?t.j():this.Y(e)},ej.prototype.Y=function(e){try{if(e==this.g)e:{let f=tA(this.g),p=this.g.ya(),m=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tj(this.g)))){this.K||4!=f||7==p||(8==p||m<=0?ev(3):ev(2)),eU(this);var t=this.g.ca();this.X=t;var r=function(e){if(!eL(e))return e.g.la();let t=tj(e.g);if(""===t)return"";let r="",n=t.length,s=4==tA(e.g);if(!e.h.i){if("u"<typeof TextDecoder)return eq(e),eB(e),"";e.h.i=new a.TextDecoder}for(let i=0;i<n;i++)e.h.h=!0,r+=e.h.i.decode(t[i],{stream:!(s&&i==n-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,n=this.i,s=this.v,i=this.B,o=this.l,l=this.S,n.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+l+"]: "+s+"\n"+i+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var n,s,i,o,l,c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!R(c)){var h=c;break t}}h=null}if(e=h)eN(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ez(this,e);else{this.o=!1,this.m=3,eI(12),eq(this),eB(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;)if((t=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eP:isNaN(r=Number(t.substring(r,n)))?eR:(n+=1)+r>t.length?eP:(t=t.slice(n,n+r),e.C=n+r,t)}(this,r))==eP){4==f&&(this.m=4,eI(14),e=!1),eN(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eR){this.m=4,eI(15),eN(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}else eN(this.i,this.l,t,null),ez(this,t);if(eL(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=r.length||this.h.h||(this.m=1,eI(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),tz(d),d.P=!0,eI(11))}}else eN(this.i,this.l,r,"[Invalid Chunked Response]"),eq(this),eB(this)}else eN(this.i,this.l,r,null),ez(this,r);4==f&&eq(this),this.o&&!this.K&&(4==f?tK(this.j,this):(this.o=!1,eF(this)))}else(function(e){let t={};e=(e.g&&tA(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(R(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let s=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let i=t[s]||[];t[s]=i,i.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,eI(12)):(this.m=0,eI(13)),eq(this),eB(this)}}}catch(e){}finally{}},ej.prototype.cancel=function(){this.K=!0,eq(this)},ej.prototype.aa=function(){var e,t;this.D=null;let r=Date.now();r-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(ev(),eI(17)),eq(this),this.m=2,eB(this)):eV(this,this.T-r)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eG(e){this.l=e||10,e=a.PerformanceNavigationTiming?(e=a.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eK(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eH(e){return e.h?1:e.g?e.g.size:0}function eW(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eQ(e,t){e.g?e.g.add(t):e.h=t}function eJ(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eY(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.G);return t}return w(e.i)}eG.prototype.cancel=function(){if(this.i=eY(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eX=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e5(this,tu(e.i)),this.m=e.m):e&&(t=String(e).match(eX))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e3(t[2]||""),this.g=e3(t[3]||"",!0),e2(this,t[4]),this.h=e3(t[5]||"",!0),e5(this,t[6]||"",!0),this.m=e3(t[7]||"")):(this.l=!1,this.i=new ts(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,r){e.j=r?e3(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e5(e,t,r){var n,s;t instanceof ts?(e.i=t,n=e.i,(s=e.l)&&!n.j&&(ti(n),n.i=null,n.g.forEach(function(e,t){let r=t.toLowerCase();t!=r&&(ta(this,t),tc(this,r,e))},n)),n.j=s):(r||(t=e8(t,tr)),e.i=new ts(t,e.l))}function e6(e,t,r){e.i.set(t,r)}function e4(e){return e6(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e3(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e9,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e9,!0),"@"),e.push(eA(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(e8(r,"/"==r.charAt(0)?tt:te,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",e8(r,tn)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),r=!!e.j;r?e1(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)e2(t,e.u);else if(r=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var s=t.h.lastIndexOf("/");-1!=s&&(n=t.h.slice(0,s+1)+n)}if(".."==(s=n)||"."==s)n="";else if(-1!=s.indexOf("./")||-1!=s.indexOf("/.")){n=0==s.lastIndexOf("/",0),s=s.split("/");let e=[];for(let t=0;t<s.length;){let r=s[t++];"."==r?n&&t==s.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==s.length&&e.push("")):(e.push(r),n=!0)}n=e.join("/")}else n=s}return r?t.h=n:r=""!==e.i.toString(),r?e5(t,tu(e.i)):r=!!e.m,r&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tr=/[#\?@]/g,tn=/#/g;function ts(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ti(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){let n=e[r].indexOf("="),s,i=null;n>=0?(s=e[r].substring(0,n),i=e[r].substring(n+1)):s=e[r],t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function ta(e,t){ti(e),t=th(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function to(e,t){return ti(e),t=th(e,t),e.g.has(t)}function tl(e,t){ti(e);let r=[];if("string"==typeof t)to(e,t)&&(r=r.concat(e.g.get(th(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function tc(e,t,r){ta(e,t),r.length>0&&(e.i=null,e.g.set(th(e,t),w(r)),e.h+=r.length)}function tu(e){let t=new ts;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function th(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,r,n,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),n(r)}catch(e){}}function tf(){this.g=new eu}function tp(e){this.i=e.Sb||null,this.h=e.ab||!1}function tm(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tb(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function tx(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tv(e)}function tv(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tw(e){let t="";return V(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function tI(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=tw(r),"string"==typeof e?null!=r&&eA(r):e6(e,t,r))}function t_(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ts.prototype).add=function(e,t){ti(this),this.i=null,e=th(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},t.forEach=function(e,t){ti(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},t.set=function(e,t){return ti(this),this.i=null,to(this,e=th(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var r=t[n];let s=eA(r);r=tl(this,r);for(let t=0;t<r.length;t++){let n=s;""!==r[t]&&(n+="="+eA(r[t])),e.push(n)}}return this.i=e.join("&")},h(tp,eh),tp.prototype.g=function(){return new tm(this.i,this.h)},h(tm,et),(t=tm.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tv(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||a).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,tx(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tv(this)),this.g&&(this.readyState=3,tv(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tb(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tx(this):tv(this),3==this.readyState&&tb(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,tx(this))},t.Na=function(e){this.g&&(this.response=e,tx(this))},t.ga=function(){this.g&&tx(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(tm.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),h(t_,et);var tE=/^https?$/i,tT=["POST","PUT"];function tN(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tS(e),tk(e)}function tS(e){e.A||(e.A=!0,er(e,"complete"),er(e,"error"))}function tC(e){if(e.h&&void 0!==i){if(e.v&&4==tA(e))setTimeout(e.Ca.bind(e),0);else if(er(e,"readystatechange"),4==tA(e)){e.h=!1;try{let i=e.ca();switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===i){let t=String(e.D).match(eX)[1]||null;!t&&a.self&&a.self.location&&(t=a.self.location.protocol.slice(0,-1)),r=!tE.test(t?t.toLowerCase():"")}t=r}if(t)er(e,"complete"),er(e,"success");else{e.o=6;try{var s=tA(e)>2?e.g.statusText:""}catch(e){s=""}e.l=s+" ["+e.ca()+"]",tS(e)}}finally{tk(e)}}}}function tk(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let r=e.g;e.g=null,t||er(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function tA(e){return e.g?e.g.readyState:0}function tj(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tD(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tR(e){this.za=0,this.i=[],this.j=new eT,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tD("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tD("baseRetryDelayMs",5e3,e),this.Za=tD("retryDelaySeedMs",1e4,e),this.Ta=tD("forwardChannelMaxRetries",2,e),this.va=tD("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eG(e&&e.concurrentRequestLimit),this.Ba=new tf,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tP(e){if(tM(e),3==e.I){var t=e.V++,r=e0(e.J);if(e6(r,"SID",e.M),e6(r,"RID",t),e6(r,"TYPE","terminate"),tV(e,r),(t=new ej(e,e.j,t)).M=2,t.A=e4(e0(r)),r=!1,a.navigator&&a.navigator.sendBeacon)try{r=a.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&a.Image&&((new Image).src=t.A,r=!0),r||(t.g=tY(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eF(t)}tQ(e)}function tO(e){e.g&&(tz(e),e.g.cancel(),e.g=null)}function tM(e){tO(e),e.v&&(a.clearTimeout(e.v),e.v=null),tG(e),e.h.cancel(),e.m&&("number"==typeof e.m&&a.clearTimeout(e.m),e.m=null)}function tL(e){if(!eK(e.h)&&!e.m){e.m=!0;var t=e.Ea;T||C(),N||(T(),N=!0),S.add(t,e),e.D=0}}function tF(e,t){var r;r=t?t.l:e.V++;let n=e0(e.J);e6(n,"SID",e.M),e6(n,"RID",r),e6(n,"AID",e.K),tV(e,n),e.u&&e.o&&tI(n,e.u,e.o),r=new ej(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tU(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eQ(e.h,r),eO(r,n,t)}function tV(e,t){e.H&&V(e.H,function(e,r){e6(t,r,e)}),e.l&&V({},function(e,r){e6(t,r,e)})}function tU(e,t,r){r=Math.min(e.i.length,r);let n=e.l?c(e.l.Ka,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?r>0?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let c=0;c<r;c++){var i=s[c].g;let r=s[c].map;if((i-=t)<0)t=Math.max(0,s[c].g-100),l=!1;else try{i="req"+i+"_";try{var a=r instanceof Map?r:Object.entries(r);for(let[t,r]of a){let n=r;o(r)&&(n=el(r)),e.push(i+t+"="+encodeURIComponent(n))}}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}catch(e){n&&n(r)}}if(l){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,r),a}function tB(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;T||C(),N||(T(),N=!0),S.add(t,e),e.A=0}}function tq(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eE(c(e.Da,e),tH(e,e.A)),e.A++,!0)}function tz(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function t$(e){e.g=new ej(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e6(t,"RID","rpc"),e6(t,"SID",e.M),e6(t,"AID",e.K),e6(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e6(t,"TO",e.ia),e6(t,"TYPE","xmlhttp"),tV(e,t),e.u&&e.o&&tI(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=e4(e0(t)),r.u=null,r.R=!0,eM(r,e)}function tG(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tK(e,t){var r,n=null;if(e.g==t){tG(e),tz(e),e.g=null;var s=2}else{if(!eW(e.h,t))return;n=t.G,eJ(e.h,t),s=1}if(0!=e.I){if(t.o)if(1==s){n=t.u?t.u.length:0,t=Date.now()-t.F;var i=e.D;er(s=eb(),new e_(s,n)),tL(e)}else tB(e);else if(3==(i=t.m)||0==i&&t.X>0||!(1==s&&(r=t,!(eH(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=r.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eE(c(e.Ea,e,r),tH(e,e.D)),e.D++,!0)))||2==s&&tq(e)))switch(n&&n.length>0&&((t=e.h).i=t.i.concat(n)),i){case 1:tW(e,5);break;case 4:tW(e,10);break;case 3:tW(e,6);break;default:tW(e,2)}}}function tH(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function tW(e,t){if(e.j.info("Error code "+t),2==t){let t,i,o;var r,n=c(e.bb,e),s=e.Ua;let l=!s;s=new eZ(s||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e1(s,"https"),e4(s),l?function(e,t){let r=new eT;if(a.Image){let n=new Image;n.onload=u(td,r,"TestLoadImage: loaded",!0,t,n),n.onerror=u(td,r,"TestLoadImage: error",!1,t,n),n.onabort=u(td,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=u(td,r,"TestLoadImage: timeout",!1,t,n),a.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(s.toString(),n):(r=s.toString(),t=new eT,i=new AbortController,o=setTimeout(()=>{i.abort(),td(t,"TestPingServer: timeout",!1,n)},1e4),fetch(r,{signal:i.signal}).then(e=>{clearTimeout(o),e.ok?td(t,"TestPingServer: ok",!0,n):td(t,"TestPingServer: server error",!1,n)}).catch(()=>{clearTimeout(o),td(t,"TestPingServer: error",!1,n)}))}else eI(2);e.I=0,e.l&&e.l.pa(t),tQ(e),tM(e)}function tQ(e){if(e.I=0,e.ja=[],e.l){let t=eY(e.h);(0!=t.length||0!=e.i.length)&&(I(e.ja,t),I(e.ja,e.i),e.h.i.length=0,w(e.i),e.i.length=0),e.l.oa()}}function tJ(e,t,r){var n=r instanceof eZ?e0(r):new eZ(r);if(""!=n.g)t&&(n.g=t+"."+n.g),e2(n,n.u);else{var s=a.location;n=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;let e=new eZ(null);n&&e1(e,n),t&&(e.g=t),s&&e2(e,s),r&&(e.h=r),n=e}return r=e.G,t=e.wa,r&&t&&e6(n,r,t),e6(n,"VER",e.ka),tV(e,n),n}function tY(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new t_(e.Aa&&!e.ma?new tp({ab:r}):e.ma)).Fa(e.L),t}function tX(){}function tZ(){}function t0(e,t){et.call(this),this.g=new tR(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!R(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!R(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t5(this)}function t1(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t2(){em.call(this),this.status=1}function t5(e){this.g=e}(t=t_.prototype).Fa=function(e){this.H=e},t.ea=function(t,r,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=d(c(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(e){tN(this,e);return}if(t=n||"",n=new Map(this.headers),s)if(Object.getPrototypeOf(s)===Object.prototype)for(var i in s)n.set(i,s[i]);else if("function"==typeof s.keys&&"function"==typeof s.get)for(let e of s.keys())n.set(e,s.get(e));else throw Error("Unknown input type for opt_headers: "+String(s));for(let[e,o]of(s=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=a.FormData&&t instanceof a.FormData,!(Array.prototype.indexOf.call(tT,r,void 0)>=0)||s||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(e,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tN(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,er(this,"complete"),er(this,"abort"),tk(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tk(this,!0)),t_.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tC(this):this.Xa())},t.Xa=function(){tC(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tA(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ec(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tR.prototype).ka=8,t.I=1,t.connect=function(e,t,r,n){eI(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=tJ(this,null,this.W),tL(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let s=new ej(this,this.j,e),i=this.o;if(this.U&&(i?q(i=U(i),this.U):i=this.U),null!==this.u||this.R||(s.J=i,i=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if((t+=n)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tU(this,s,t),e6(r=e0(this.J),"RID",e),e6(r,"CVER",22),this.G&&e6(r,"X-HTTP-Session-Id",this.G),tV(this,r),i&&(this.R?t="headers="+eA(tw(i))+"&"+t:this.u&&tI(r,this.u,i)),eQ(this.h,s),this.Ra&&e6(r,"TYPE","init"),this.S?(e6(r,"$req",t),e6(r,"SID","null"),s.U=!0,eO(s,r,null)):eO(s,r,t),this.I=2}}else 3==this.I&&(e?tF(this,e):0==this.i.length||eK(this.h)||tF(this))},t.Da=function(){if(this.v=null,t$(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eE(c(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eI(10),tO(this),t$(this))},t.Va=function(){null!=this.C&&(this.C=null,tO(this),tq(this),eI(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eI(2)):(this.j.info("Failed to ping google.com"),eI(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tX.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tZ.prototype.g=function(e,t){return new t0(e,t)},h(t0,et),t0.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},t0.prototype.close=function(){tP(this.g)},t0.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=el(e),e=r);t.i.push(new e$(t.Ya++,e)),3==t.I&&tL(t)},t0.prototype.N=function(){this.g.l=null,delete this.j,tP(this.g),delete this.g,t0.Z.N.call(this)},h(t1,ep),h(t2,em),h(t5,tX),t5.prototype.ra=function(){er(this.g,"a")},t5.prototype.qa=function(e){er(this.g,new t1(e))},t5.prototype.pa=function(e){er(this.g,new t2)},t5.prototype.oa=function(){er(this.g,"b")},tZ.prototype.createWebChannel=tZ.prototype.g,t0.prototype.send=t0.prototype.o,t0.prototype.open=t0.prototype.m,t0.prototype.close=t0.prototype.close,v=ty.createWebChannelTransport=function(){return new tZ},x=ty.getStatEventTarget=function(){return eb()},b=ty.Event=eg,y=ty.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eS.NO_ERROR=0,eS.TIMEOUT=8,eS.HTTP_ERROR=6,g=ty.ErrorCode=eS,eC.COMPLETE="complete",m=ty.EventType=eC,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,p=ty.WebChannel=ed,ty.FetchXmlHttpFactory=tp,t_.prototype.listenOnce=t_.prototype.K,t_.prototype.getLastError=t_.prototype.Ha,t_.prototype.getLastErrorCode=t_.prototype.ya,t_.prototype.getStatus=t_.prototype.ca,t_.prototype.getResponseJson=t_.prototype.La,t_.prototype.getResponseText=t_.prototype.la,t_.prototype.send=t_.prototype.ea,t_.prototype.setWithCredentials=t_.prototype.Fa,f=ty.XhrIo=t_}).apply(void 0!==tg?tg:"u">typeof self?self:"u">typeof window?window:{});class tb{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tb.UNAUTHENTICATED=new tb(null),tb.GOOGLE_CREDENTIALS=new tb("google-credentials-uid"),tb.FIRST_PARTY=new tb("first-party-uid"),tb.MOCK_USER=new tb("mock-user");let tx="12.8.0",tv=new eI("@firebase/firestore");function tw(){return tv.logLevel}function tI(e,...t){if(tv.logLevel<=u.DEBUG){let r=t.map(tT);tv.debug(`Firestore (${tx}): ${e}`,...r)}}function t_(e,...t){if(tv.logLevel<=u.ERROR){let r=t.map(tT);tv.error(`Firestore (${tx}): ${e}`,...r)}}function tE(e,...t){if(tv.logLevel<=u.WARN){let r=t.map(tT);tv.warn(`Firestore (${tx}): ${e}`,...r)}}function tT(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function tN(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,tS(e,n,r)}function tS(e,t,r){let n=`FIRESTORE (${tx}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw t_(n),Error(n)}function tC(e,t,r,n){let s="Unexpected state";"string"==typeof r?s=r:n=r,e||tS(t,s,n)}let tk={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class tA extends et{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class tj{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class tD{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class tR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tb.UNAUTHENTICATED))}shutdown(){}}class tP{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class tO{constructor(e){this.t=e,this.currentUser=tb.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){tC(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),s=new tj;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new tj,e.enqueueRetryable(()=>n(this.currentUser))};let i=()=>{let t=s;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{tI("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(tI("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new tj)}},0),i()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(tI("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(tC("string"==typeof t.accessToken,31837,{l:t}),new tD(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return tC(null===e||"string"==typeof e,2055,{h:e}),new tb(e)}}class tM{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=tb.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);let e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class tL{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new tM(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(tb.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class tF{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class tV{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,eX(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){tC(void 0===this.o,3512);let r=e=>{null!=e.error&&tI("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,tI("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{tI("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):tI("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new tF(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(tC("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new tF(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class tU{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="u">typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(0);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function tB(e,t){return e<t?-1:+(e>t)}function tq(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),s=t.charAt(n);if(r!==s)return tz(r)===tz(s)?tB(r,s):tz(r)?1:-1}return tB(e.length,t.length)}function tz(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function t$(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}let tG="__name__";class tK{constructor(e,t,r){void 0===t?t=0:t>e.length&&tN(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&tN(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===tK.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof tK?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=tK.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return tB(e.length,t.length)}static compareSegments(e,t){let r=tK.isNumericId(e),n=tK.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?tK.extractNumericId(e).compare(tK.extractNumericId(t)):tq(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return h.fromString(e.substring(4,e.length-2))}}class tH extends tK{construct(e,t,r){return new tH(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new tA(tk.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new tH(t)}static emptyPath(){return new tH([])}}let tW=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class tQ extends tK{construct(e,t,r){return new tQ(e,t,r)}static isValidIdentifier(e){return tW.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),tQ.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===tG}static keyField(){return new tQ([tG])}static fromServerFormat(e){let t=[],r="",n=0,s=()=>{if(0===r.length)throw new tA(tk.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},i=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new tA(tk.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new tA(tk.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?i=!i:"."!==t||i?r+=t:s(),n++}if(s(),i)throw new tA(tk.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new tQ(t)}static emptyPath(){return new tQ([])}}class tJ{constructor(e){this.path=e}static fromPath(e){return new tJ(tH.fromString(e))}static fromName(e){return new tJ(tH.fromString(e).popFirst(5))}static empty(){return new tJ(tH.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===tH.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return tH.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new tJ(new tH(e.slice()))}}function tY(e){if(!tJ.isDocumentKey(e))throw new tA(tk.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function tX(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function tZ(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":tN(12329,{type:typeof e})}function t0(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new tA(tk.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=tZ(e);throw new tA(tk.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function t1(e,t){if(t<=0)throw new tA(tk.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}function t2(e,t){let r={typeString:e};return t&&(r.value=t),r}function t5(e,t){let r;if(!tX(e))throw new tA(tk.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let s=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(s&&typeof a!==s){r=`JSON field '${n}' must be a ${s}.`;break}if(void 0!==i&&a!==i.value){r=`Expected '${n}' field to equal '${i.value}'`;break}}if(r)throw new tA(tk.INVALID_ARGUMENT,r);return!0}class t6{static now(){return t6.fromMillis(Date.now())}static fromDate(e){return t6.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new t6(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new tA(tk.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new tA(tk.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?tB(this.nanoseconds,e.nanoseconds):tB(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:t6._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(t5(e,t6._jsonSchema))return new t6(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}t6._jsonSchemaVersion="firestore/timestamp/1.0",t6._jsonSchema={type:t2("string",t6._jsonSchemaVersion),seconds:t2("number"),nanoseconds:t2("number")};class t4{static fromTimestamp(e){return new t4(e)}static min(){return new t4(new t6(0,0))}static max(){return new t4(new t6(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class t3{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function t8(e){return e.fields.find(e=>2===e.kind)}function t7(e){return e.fields.filter(e=>2!==e.kind)}function t9(e,t){let r=tB(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=function(e,t){let r=tQ.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:tB(e.kind,t.kind)}(e.fields[n],t.fields[n])))return r;return tB(e.fields.length,t.fields.length)}t3.UNKNOWN_ID=-1;class re{constructor(e,t){this.fieldPath=e,this.kind=t}}class rt{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new rt(0,rs.min())}}function rr(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new rs(t4.fromTimestamp(1e9===n?new t6(r+1,0):new t6(r,n)),tJ.empty(),t)}function rn(e){return new rs(e.readTime,e.key,-1)}class rs{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new rs(t4.min(),tJ.empty(),-1)}static max(){return new rs(t4.max(),tJ.empty(),-1)}}function ri(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=tJ.comparator(e.documentKey,t.documentKey))?r:tB(e.largestBatchId,t.largestBatchId)}let ra="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ro{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function rl(e){if(e.code!==tk.FAILED_PRECONDITION||e.message!==ra)throw e;tI("LocalStore","Unexpectedly lost primary lease")}class rc{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&tN(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new rc((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof rc?t:rc.resolve(t)}catch(e){return rc.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):rc.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):rc.reject(t)}static resolve(e){return new rc((t,r)=>{t(e)})}static reject(e){return new rc((t,r)=>{r(e)})}static waitFor(e){return new rc((t,r)=>{let n=0,s=0,i=!1;e.forEach(e=>{++n,e.next(()=>{++s,i&&s===n&&t()},e=>r(e))}),i=!0,s===n&&t()})}static or(e){let t=rc.resolve(!1);for(let r of e)t=t.next(e=>e?rc.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new rc((r,n)=>{let s=e.length,i=Array(s),a=0;for(let o=0;o<s;o++){let l=o;t(e[l]).next(e=>{i[l]=e,++a===s&&r(i)},e=>n(e))}})}static doWhile(e,t){return new rc((r,n)=>{let s=()=>{!0===e()?t().next(()=>{s()},n):r()};s()})}}let ru="SimpleDb";class rh{static open(e,t,r,n){try{return new rh(t,e.transaction(n,r))}catch(e){throw new rm(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new tj,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new rm(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let r=rv(t.target.error);this.S.reject(new rm(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(tI(ru,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new ry(this.transaction.objectStore(e))}}class rd{static delete(e){return tI(ru,"Removing database:",e),rb(O().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!X())return!1;if(rd.F())return!0;let e=K(),t=rd.M(e),r=rf(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static F(){return void 0!==S.default&&"YES"===S.default.__PRIVATE_env?.__PRIVATE_USE_MOCK_PERSISTENCE}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,12.2===rd.M(K())&&t_("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(tI(ru,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new rm(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new tA(tk.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new tA(tk.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new rm(e,n))},n.onupgradeneeded=e=>{tI(ru,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,n.transaction,e.oldVersion,this.version).next(()=>{tI(ru,"Database upgrade to version "+this.version+" complete")})}})),this.K&&(this.db.onversionchange=e=>this.K(e)),this.db}q(e){this.K=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let s="readonly"===t,i=0;for(;;){++i;try{this.db=await this.L(e);let t=rh.open(this.db,e,s?"readonly":"readwrite",r),i=n(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),rc.reject(e))).toPromise();return i.catch(()=>{}),await t.D,i}catch(t){let e="FirebaseError"!==t.name&&i<3;if(tI(ru,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function rf(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class rp{constructor(e){this.U=e,this.$=!1,this.W=null}get isDone(){return this.$}get G(){return this.W}set cursor(e){this.U=e}done(){this.$=!0}j(e){this.W=e}delete(){return rb(this.U.delete())}}class rm extends tA{constructor(e,t){super(tk.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function rg(e){return"IndexedDbTransactionError"===e.name}class ry{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(tI(ru,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(tI(ru,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),rb(r)}add(e){return tI(ru,"ADD",this.store.name,e,e),rb(this.store.add(e))}get(e){return rb(this.store.get(e)).next(t=>(void 0===t&&(t=null),tI(ru,"GET",this.store.name,e,t),t))}delete(e){return tI(ru,"DELETE",this.store.name,e),rb(this.store.delete(e))}count(){return tI(ru,"COUNT",this.store.name),rb(this.store.count())}H(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new rc((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.J(e,(e,r)=>{t.push(r)}).next(()=>t)}}Z(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new rc((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}X(e,t){tI(ru,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Y=!1;let n=this.cursor(r);return this.J(n,(e,t,r)=>r.delete())}ee(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.J(n,t)}te(e){let t=this.cursor({});return new rc((r,n)=>{t.onerror=e=>{n(rv(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}J(e,t){let r=[];return new rc((n,s)=>{e.onerror=e=>{s(e.target.error)},e.onsuccess=e=>{let s=e.target.result;if(!s)return void n();let i=new rp(s),a=t(s.primaryKey,s.value,i);if(a instanceof rc){let e=a.catch(e=>(i.done(),rc.reject(e)));r.push(e)}i.isDone?n():null===i.G?s.continue():s.continue(i.G)}}).next(()=>rc.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function rb(e){return new rc((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(rv(e.target.error))}})}let rx=!1;function rv(e){let t=rd.M(K());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new tA("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return rx||(rx=!0,setTimeout(()=>{throw e},0)),e}}return e}let rw="IndexBackfiller";class rI{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){tI(rw,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();tI(rw,`Documents written: ${e}`)}catch(e){rg(e)?tI(rw,"Ignoring IndexedDB error during index backfill: ",e):await rl(e)}await this.re(6e4)})}}class r_{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let r=new Set,n=t,s=!0;return rc.doWhile(()=>!0===s&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return tI(rw,`Processing collection: ${t}`),this.oe(e,t,n).next(e=>{n-=e,r.add(t)});s=!1})).next(()=>t-n)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let s=r.changes;return this.localStore.indexManager.updateIndexEntries(e,s).next(()=>this._e(n,r)).next(r=>(tI(rw,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>s.size)}))}_e(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=rn(t);ri(n,r)>0&&(r=n)}),new rs(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class rE{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}function rT(e){return null==e}function rN(e){return 0===e&&1/e==-1/0}function rS(e){return"number"==typeof e&&Number.isInteger(e)&&!rN(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function rC(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}rE.ce=-1;function rk(e){let t=e.length;if(tC(t>=2,64408,{path:e}),2===t)return tC("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),tH.emptyPath();let r=t-2,n=[],s="";for(let i=0;i<t;){let t=e.indexOf("\x01",i);switch((t<0||t>r)&&tN(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(i,t);0===s.length?a=o:(s+=o,a=s,s=""),n.push(a);break;case"\x10":s+=e.substring(i,t),s+="\0";break;case"\x11":s+=e.substring(i,t+1);break;default:tN(61167,{path:e})}i=t+2}return new tH(n)}let rA="remoteDocuments",rj="owner",rD="owner",rR="mutationQueues",rP="mutations",rO="batchId",rM="userMutationsIndex",rL=["userId","batchId"],rF={},rV="documentMutations",rU="remoteDocumentsV14",rB=["prefixPath","collectionGroup","readTime","documentId"],rq="documentKeyIndex",rz=["prefixPath","collectionGroup","documentId"],r$="collectionGroupIndex",rG=["collectionGroup","readTime","prefixPath","documentId"],rK="remoteDocumentGlobal",rH="remoteDocumentGlobalKey",rW="targets",rQ="queryTargetsIndex",rJ=["canonicalId","targetId"],rY="targetDocuments",rX=["targetId","path"],rZ="documentTargetsIndex",r0=["path","targetId"],r1="targetGlobalKey",r2="targetGlobal",r5="collectionParents",r6=["collectionId","parent"],r4="clientMetadata",r3="bundles",r8="namedQueries",r7="indexConfiguration",r9="collectionGroupIndex",ne="indexState",nt=["indexId","uid"],nr="sequenceNumberIndex",nn=["uid","sequenceNumber"],ns="indexEntries",ni=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],na="documentKeyIndex",no=["indexId","uid","orderedDocumentKey"],nl="documentOverlays",nc=["userId","collectionPath","documentId"],nu="collectionPathOverlayIndex",nh=["userId","collectionPath","largestBatchId"],nd="collectionGroupOverlayIndex",nf=["userId","collectionGroup","largestBatchId"],np="globals",nm=[rR,rP,rV,rA,rW,rj,r2,rY,r4,rK,r5,r3,r8],ng=[...nm,nl],ny=[rR,rP,rV,rU,rW,rj,r2,rY,r4,rK,r5,r3,r8,nl],nb=[...ny,r7,ne,ns],nx=[...nb,np];class nv extends ro{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function nw(e,t){return rd.O(e.le,t)}function nI(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function n_(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function nE(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class nT{constructor(e,t){this.comparator=e,this.root=t||nS.EMPTY}insert(e,t){return new nT(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nS.BLACK,null,null))}remove(e){return new nT(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nS.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nN(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nN(this.root,e,this.comparator,!1)}getReverseIterator(){return new nN(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nN(this.root,e,this.comparator,!0)}}class nN{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&n&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nS{constructor(e,t,r,n,s){this.key=e,this.value=t,this.color=null!=r?r:nS.RED,this.left=null!=n?n:nS.EMPTY,this.right=null!=s?s:nS.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,s){return new nS(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,s=r(e,n.key);return(n=s<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===s?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return nS.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return nS.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,nS.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,nS.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw tN(43730,{key:this.key,value:this.value});if(this.right.isRed())throw tN(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw tN(27949);return e+ +!this.isRed()}}nS.EMPTY=null,nS.RED=!0,nS.BLACK=!1,nS.EMPTY=new class{constructor(){this.size=0}get key(){throw tN(57766)}get value(){throw tN(16141)}get color(){throw tN(16727)}get left(){throw tN(29726)}get right(){throw tN(36894)}copy(e,t,r,n,s){return this}insert(e,t,r){return new nS(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class nC{constructor(e){this.comparator=e,this.data=new nT(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new nk(this.data.getIterator())}getIteratorFrom(e){return new nk(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof nC)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new nC(this.comparator);return t.data=e,t}}class nk{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function nA(e){return e.hasNext()?e.getNext():void 0}class nj{constructor(e){this.fields=e,e.sort(tQ.comparator)}static empty(){return new nj([])}unionWith(e){let t=new nC(tQ.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new nj(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return t$(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class nD extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class nR{constructor(e){this.binaryString=e}static fromBase64String(e){return new nR(function(e){try{return atob(e)}catch(e){throw"u">typeof DOMException&&e instanceof DOMException?new nD("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new nR(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return tB(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}nR.EMPTY_BYTE_STRING=new nR("");let nP=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nO(e){if(tC(!!e,39018),"string"==typeof e){let t=0,r=nP.exec(e);if(tC(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:nM(e.seconds),nanos:nM(e.nanos)}}function nM(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function nL(e){return"string"==typeof e?nR.fromBase64String(e):nR.fromUint8Array(e)}let nF="server_timestamp",nV="__type__",nU="__previous_value__",nB="__local_write_time__";function nq(e){return(e?.mapValue?.fields||{})[nV]?.stringValue===nF}function nz(e){let t=e.mapValue.fields[nU];return nq(t)?nz(t):t}function n$(e){let t=nO(e.mapValue.fields[nB].timestampValue);return new t6(t.seconds,t.nanos)}class nG{constructor(e,t,r,n,s,i,a,o,l,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=c,this.apiKey=u}}let nK="(default)";class nH{constructor(e,t){this.projectId=e,this.database=t||nK}static empty(){return new nH("","")}get isDefaultDatabase(){return this.database===nK}isEqual(e){return e instanceof nH&&e.projectId===this.projectId&&e.database===this.database}}let nW="__type__",nQ="__max__",nJ={mapValue:{fields:{__type__:{stringValue:nQ}}}},nY="__vector__",nX="value",nZ={nullValue:"NULL_VALUE"};function n0(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?nq(e)?4:si(e)?0x1fffffffffffff:sn(e)?10:11:tN(28295,{value:e})}function n1(e,t){if(e===t)return!0;let r=n0(e);if(r!==n0(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return n$(e).isEqual(n$(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=nO(e.timestampValue),s=nO(t.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos;case 5:return e.stringValue===t.stringValue;case 6:return nL(e.bytesValue).isEqual(nL(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return nM(e.geoPointValue.latitude)===nM(t.geoPointValue.latitude)&&nM(e.geoPointValue.longitude)===nM(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return nM(e.integerValue)===nM(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=nM(e.doubleValue),n=nM(t.doubleValue);return r===n?rN(r)===rN(n):isNaN(r)&&isNaN(n)}return!1;case 9:return t$(e.arrayValue.values||[],t.arrayValue.values||[],n1);case 10:case 11:let i=e.mapValue.fields||{},a=t.mapValue.fields||{};if(nI(i)!==nI(a))return!1;for(let e in i)if(i.hasOwnProperty(e)&&(void 0===a[e]||!n1(i[e],a[e])))return!1;return!0;default:return tN(52216,{left:e})}}function n2(e,t){return void 0!==(e.values||[]).find(e=>n1(e,t))}function n5(e,t){var r,n,s,i,a,o;if(e===t)return 0;let l=n0(e),c=n0(t);if(l!==c)return tB(l,c);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return tB(e.booleanValue,t.booleanValue);case 2:let u,h;return u=nM(e.integerValue||e.doubleValue),u<(h=nM(t.integerValue||t.doubleValue))?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1;case 3:return n6(e.timestampValue,t.timestampValue);case 4:return n6(n$(e),n$(t));case 5:return tq(e.stringValue,t.stringValue);case 6:let d,f;return r=e.bytesValue,n=t.bytesValue,d=nL(r),f=nL(n),d.compareTo(f);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=tB(r[e],n[e]);if(0!==t)return t}return tB(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:let p;return s=e.geoPointValue,i=t.geoPointValue,0!==(p=tB(nM(s.latitude),nM(i.latitude)))?p:tB(nM(s.longitude),nM(i.longitude));case 9:return n4(e.arrayValue,t.arrayValue);case 10:let m,g,y,b,x;return a=e.mapValue,o=t.mapValue,m=a.fields||{},g=o.fields||{},y=m[nX]?.arrayValue,b=g[nX]?.arrayValue,0!==(x=tB(y?.values?.length||0,b?.values?.length||0))?x:n4(y,b);case 11:return function(e,t){if(e===nJ.mapValue&&t===nJ.mapValue)return 0;if(e===nJ.mapValue)return 1;if(t===nJ.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),s=t.fields||{},i=Object.keys(s);n.sort(),i.sort();for(let e=0;e<n.length&&e<i.length;++e){let t=tq(n[e],i[e]);if(0!==t)return t;let a=n5(r[n[e]],s[i[e]]);if(0!==a)return a}return tB(n.length,i.length)}(e.mapValue,t.mapValue);default:throw tN(23264,{he:l})}}function n6(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return tB(e,t);let r=nO(e),n=nO(t),s=tB(r.seconds,n.seconds);return 0!==s?s:tB(r.nanos,n.nanos)}function n4(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=n5(r[e],n[e]);if(t)return t}return tB(r.length,n.length)}function n3(e){var t,r;let n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(n=nO(e.timestampValue),`time(${n.seconds},${n.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?nL(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,tJ.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=n3(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let s of t)n?n=!1:r+=",",r+=`${s}:${n3(e.fields[s])}`;return r+"}"}(e.mapValue):tN(61005,{value:e})}function n8(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function n7(e){return!!e&&"integerValue"in e}function n9(e){return!!e&&"arrayValue"in e}function se(e){return!!e&&"nullValue"in e}function st(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function sr(e){return!!e&&"mapValue"in e}function sn(e){return(e?.mapValue?.fields||{})[nW]?.stringValue===nY}function ss(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return n_(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=ss(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=ss(e.arrayValue.values[r]);return t}return{...e}}function si(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===nQ}let sa={mapValue:{fields:{[nW]:{stringValue:nY},[nX]:{arrayValue:{}}}}};function so(e,t){let r=n5(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function sl(e,t){let r=n5(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class sc{constructor(e){this.value=e}static empty(){return new sc({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!sr(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ss(t)}setAll(e){let t=tQ.emptyPath(),r={},n=[];e.forEach((e,s)=>{if(!t.isImmediateParentOf(s)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=s.popLast()}e?r[s.lastSegment()]=ss(e):n.push(s.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,n)}delete(e){let t=this.field(e.popLast());sr(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return n1(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];sr(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(n_(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new sc(ss(this.value))}}class su{constructor(e,t,r,n,s,i,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=s,this.data=i,this.documentState=a}static newInvalidDocument(e){return new su(e,0,t4.min(),t4.min(),t4.min(),sc.empty(),0)}static newFoundDocument(e,t,r,n){return new su(e,1,t,t4.min(),r,n,0)}static newNoDocument(e,t){return new su(e,2,t,t4.min(),t4.min(),sc.empty(),0)}static newUnknownDocument(e,t){return new su(e,3,t,t4.min(),t4.min(),sc.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(t4.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=sc.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=sc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=t4.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof su&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new su(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class sh{constructor(e,t){this.position=e,this.inclusive=t}}function sd(e,t,r){let n=0;for(let s=0;s<e.position.length;s++){let i=t[s],a=e.position[s];if(n=i.field.isKeyField()?tJ.comparator(tJ.fromName(a.referenceValue),r.key):n5(a,r.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function sf(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!n1(e.position[r],t.position[r]))return!1;return!0}class sp{constructor(e,t="asc"){this.field=e,this.dir=t}}class sm{}class sg extends sm{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new s_(e,t,r):"array-contains"===t?new sS(e,r):"in"===t?new sC(e,r):"not-in"===t?new sk(e,r):"array-contains-any"===t?new sA(e,r):new sg(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new sE(e,r):new sT(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(n5(t,this.value)):null!==t&&n0(this.value)===n0(t)&&this.matchesComparison(n5(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return tN(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class sy extends sm{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new sy(e,t)}matches(e){return sb(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function sb(e){return"and"===e.op}function sx(e){return"or"===e.op}function sv(e){return sw(e)&&sb(e)}function sw(e){for(let t of e.filters)if(t instanceof sy)return!1;return!0}function sI(e,t){let r=e.filters.concat(t);return sy.create(r,e.op)}class s_ extends sg{constructor(e,t,r){super(e,t,r),this.key=tJ.fromName(r.referenceValue)}matches(e){let t=tJ.comparator(e.key,this.key);return this.matchesComparison(t)}}class sE extends sg{constructor(e,t){super(e,"in",t),this.keys=sN("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class sT extends sg{constructor(e,t){super(e,"not-in",t),this.keys=sN("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function sN(e,t){return(t.arrayValue?.values||[]).map(e=>tJ.fromName(e.referenceValue))}class sS extends sg{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return n9(t)&&n2(t.arrayValue,this.value)}}class sC extends sg{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&n2(this.value.arrayValue,t)}}class sk extends sg{constructor(e,t){super(e,"not-in",t)}matches(e){if(n2(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!n2(this.value.arrayValue,t)}}class sA extends sg{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!n9(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>n2(this.value.arrayValue,e))}}class sj{constructor(e,t=null,r=[],n=[],s=null,i=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=s,this.startAt=i,this.endAt=a,this.Te=null}}function sD(e,t=null,r=[],n=[],s=null,i=null,a=null){return new sj(e,t,r,n,s,i,a)}function sR(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof sg)return t.field.canonicalString()+t.op.toString()+n3(t.value);if(sv(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),rT(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>n3(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>n3(e)).join(",")),e.Te=t}return e.Te}function sP(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<e.orderBy.length;s++){var r,n;if(r=e.orderBy[s],n=t.orderBy[s],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof sg?r instanceof sg&&t.op===r.op&&t.field.isEqual(r.field)&&n1(t.value,r.value):t instanceof sy?r instanceof sy&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,s)=>t&&e(n,r.filters[s]),!0):void tN(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!sf(e.startAt,t.startAt)&&sf(e.endAt,t.endAt)}function sO(e){return tJ.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function sM(e,t){return e.filters.filter(e=>e instanceof sg&&e.field.isEqual(t))}function sL(e,t,r){let n=nZ,s=!0;for(let r of sM(e,t)){let e=nZ,t=!0;switch(r.op){case"<":case"<=":var i;e="nullValue"in(i=r.value)?nZ:"booleanValue"in i?{booleanValue:!1}:"integerValue"in i||"doubleValue"in i?{doubleValue:NaN}:"timestampValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in i?{stringValue:""}:"bytesValue"in i?{bytesValue:""}:"referenceValue"in i?n8(nH.empty(),tJ.empty()):"geoPointValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in i?{arrayValue:{}}:"mapValue"in i?sn(i)?sa:{mapValue:{}}:tN(35942,{value:i});break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=nZ}0>so({value:n,inclusive:s},{value:e,inclusive:t})&&(n=e,s=t)}if(null!==r){for(let i=0;i<e.orderBy.length;++i)if(e.orderBy[i].field.isEqual(t)){let e=r.position[i];0>so({value:n,inclusive:s},{value:e,inclusive:r.inclusive})&&(n=e,s=r.inclusive);break}}return{value:n,inclusive:s}}function sF(e,t,r){let n=nJ,s=!0;for(let r of sM(e,t)){let e=nJ,t=!0;switch(r.op){case">=":case">":var i;e="nullValue"in(i=r.value)?{booleanValue:!1}:"booleanValue"in i?{doubleValue:NaN}:"integerValue"in i||"doubleValue"in i?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in i?{stringValue:""}:"stringValue"in i?{bytesValue:""}:"bytesValue"in i?n8(nH.empty(),tJ.empty()):"referenceValue"in i?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in i?{arrayValue:{}}:"arrayValue"in i?sa:"mapValue"in i?sn(i)?{mapValue:{}}:nJ:tN(61959,{value:i}),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=nJ}sl({value:n,inclusive:s},{value:e,inclusive:t})>0&&(n=e,s=t)}if(null!==r){for(let i=0;i<e.orderBy.length;++i)if(e.orderBy[i].field.isEqual(t)){let e=r.position[i];sl({value:n,inclusive:s},{value:e,inclusive:r.inclusive})>0&&(n=e,s=r.inclusive);break}}return{value:n,inclusive:s}}class sV{constructor(e,t=null,r=[],n=[],s=null,i="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=s,this.limitType=i,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function sU(e){return new sV(e)}function sB(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function sq(e){return null!==e.collectionGroup}function sz(e){if(null===e.Ie){let t;e.Ie=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new nC(tQ.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new sp(t,n))}),r.has(tQ.keyField().canonicalString())||e.Ie.push(new sp(tQ.keyField(),n))}return e.Ie}function s$(e){return e.Ee||(e.Ee=sG(e,sz(e))),e.Ee}function sG(e,t){if("F"===e.limitType)return sD(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new sp(e.field,t)});let r=e.endAt?new sh(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new sh(e.startAt.position,e.startAt.inclusive):null;return sD(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function sK(e,t){let r=e.filters.concat([t]);return new sV(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function sH(e,t,r){return new sV(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function sW(e,t){return sP(s$(e),s$(t))&&e.limitType===t.limitType}function sQ(e){return`${sR(s$(e))}|lt:${e.limitType}`}function sJ(e){var t;let r;return`Query(target=${r=(t=s$(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof sg?`${t.field.canonicalString()} ${t.op} ${n3(t.value)}`:t instanceof sy?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),rT(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>n3(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>n3(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function sY(e,t){var r,n,s,i;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):tJ.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let r of sz(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(r=e,n=t,(!r.startAt||(s=r.startAt,o=sd(s,sz(r),n),s.inclusive?!!(o<=0):!!(o<0)))&&(!r.endAt||(i=r.endAt,l=sd(i,sz(r),n),i.inclusive?!!(l>=0):!!(l>0))))}function sX(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function sZ(e){return(t,r)=>{let n=!1;for(let s of sz(e)){let e=function(e,t,r){var n;let s,i,a=e.field.isKeyField()?tJ.comparator(t.key,r.key):(n=e.field,s=t.data.field(n),i=r.data.field(n),null!==s&&null!==i?n5(s,i):tN(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return tN(19790,{direction:e.dir})}}(s,t,r);if(0!==e)return e;n=n||s.field.isKeyField()}return 0}}class s0{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){n_(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return nE(this.inner)}size(){return this.innerSize}}let s1=new nT(tJ.comparator),s2=new nT(tJ.comparator);function s5(...e){let t=s2;for(let r of e)t=t.insert(r.key,r);return t}function s6(e){let t=s2;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function s4(){return new s0(e=>e.toString(),(e,t)=>e.isEqual(t))}let s3=new nT(tJ.comparator),s8=new nC(tJ.comparator);function s7(...e){let t=s8;for(let r of e)t=t.add(r);return t}let s9=new nC(tB);function ie(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rN(t)?"-0":t}}function it(e){return{integerValue:""+e}}class ir{constructor(){this._=void 0}}function is(e,t){return e instanceof iu?n7(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class ii extends ir{}class ia extends ir{constructor(e){super(),this.elements=e}}function io(e,t){let r=id(t);for(let t of e.elements)r.some(e=>n1(e,t))||r.push(t);return{arrayValue:{values:r}}}class il extends ir{constructor(e){super(),this.elements=e}}function ic(e,t){let r=id(t);for(let t of e.elements)r=r.filter(e=>!n1(e,t));return{arrayValue:{values:r}}}class iu extends ir{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function ih(e){return nM(e.integerValue||e.doubleValue)}function id(e){return n9(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ip{constructor(e,t){this.field=e,this.transform=t}}class im{constructor(e,t){this.version=e,this.transformResults=t}}class ig{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ig}static exists(e){return new ig(void 0,e)}static updateTime(e){return new ig(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function iy(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ib{}function ix(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new iS(e.key,ig.none()):new iI(e.key,e.data,ig.none());{let r=e.data,n=sc.empty(),s=new nC(tQ.comparator);for(let e of t.fields)if(!s.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),s=s.add(e)}return new i_(e.key,n,new nj(s.toArray()),ig.none())}}function iv(e,t,r,n){return e instanceof iI?function(e,t,r,n){if(!iy(e.precondition,t))return r;let s=e.value.clone(),i=iN(e.fieldTransforms,n,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,r,n):e instanceof i_?function(e,t,r,n){if(!iy(e.precondition,t))return r;let s=iN(e.fieldTransforms,n,t),i=t.data;return(i.setAll(iE(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):iy(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function iw(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&t$(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof ia&&n instanceof ia||r instanceof il&&n instanceof il?t$(r.elements,n.elements,n1):r instanceof iu&&n instanceof iu?n1(r.Ae,n.Ae):r instanceof ii&&n instanceof ii)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class iI extends ib{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class i_ extends ib{constructor(e,t,r,n,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function iE(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function iT(e,t,r){let n=new Map;tC(e.length===r.length,32656,{Ve:r.length,de:e.length});for(let i=0;i<r.length;i++){var s;let a=e[i],o=a.transform,l=t.data.field(a.field);n.set(a.field,(s=r[i],o instanceof ia?io(o,l):o instanceof il?ic(o,l):s))}return n}function iN(e,t,r){let n=new Map;for(let s of e){let e=s.transform,i=r.data.field(s.field);n.set(s.field,function(e,t,r){var n;let s,i,a;return e instanceof ii?(n=t,s={fields:{[nV]:{stringValue:nF},[nB]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}},n&&nq(n)&&(n=nz(n)),n&&(s.fields[nU]=n),{mapValue:s}):e instanceof ia?io(e,t):e instanceof il?ic(e,t):(a=ih(i=is(e,t))+ih(e.Ae),n7(i)&&n7(e.Ae)?it(a):ie(e.serializer,a))}(e,i,t))}return n}class iS extends ib{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class iC extends ib{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ik{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){let n,s;e instanceof iI?(n=e.value.clone(),s=iT(e.fieldTransforms,t,r.transformResults),n.setAll(s),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()):e instanceof i_?function(e,t,r){if(!iy(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=iT(e.fieldTransforms,t,r.transformResults),s=t.data;s.setAll(iE(e)),s.setAll(n),t.convertToFoundDocument(r.version,s).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=iv(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=iv(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=s4();return this.mutations.forEach(n=>{let s=e.get(n.key),i=s.overlayedDocument,a=this.applyToLocalView(i,s.mutatedFields),o=ix(i,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),i.isValidDocument()||i.convertToNoDocument(t4.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),s7())}isEqual(e){return this.batchId===e.batchId&&t$(this.mutations,e.mutations,(e,t)=>iw(e,t))&&t$(this.baseMutations,e.baseMutations,(e,t)=>iw(e,t))}}class iA{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){tC(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=s3,s=e.mutations;for(let e=0;e<s.length;e++)n=n.insert(s[e].key,r[e].version);return new iA(e,t,r,n)}}class ij{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class iD{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class iR{constructor(e,t){this.count=e,this.unchangedNames=t}}function iP(e){switch(e){case tk.OK:return tN(64938);case tk.CANCELLED:case tk.UNKNOWN:case tk.DEADLINE_EXCEEDED:case tk.RESOURCE_EXHAUSTED:case tk.INTERNAL:case tk.UNAVAILABLE:case tk.UNAUTHENTICATED:return!1;case tk.INVALID_ARGUMENT:case tk.NOT_FOUND:case tk.ALREADY_EXISTS:case tk.PERMISSION_DENIED:case tk.FAILED_PRECONDITION:case tk.ABORTED:case tk.OUT_OF_RANGE:case tk.UNIMPLEMENTED:case tk.DATA_LOSS:return!0;default:return tN(15467,{code:e})}}function iO(e){if(void 0===e)return t_("GRPC error has no .code"),tk.UNKNOWN;switch(e){case w.OK:return tk.OK;case w.CANCELLED:return tk.CANCELLED;case w.UNKNOWN:return tk.UNKNOWN;case w.DEADLINE_EXCEEDED:return tk.DEADLINE_EXCEEDED;case w.RESOURCE_EXHAUSTED:return tk.RESOURCE_EXHAUSTED;case w.INTERNAL:return tk.INTERNAL;case w.UNAVAILABLE:return tk.UNAVAILABLE;case w.UNAUTHENTICATED:return tk.UNAUTHENTICATED;case w.INVALID_ARGUMENT:return tk.INVALID_ARGUMENT;case w.NOT_FOUND:return tk.NOT_FOUND;case w.ALREADY_EXISTS:return tk.ALREADY_EXISTS;case w.PERMISSION_DENIED:return tk.PERMISSION_DENIED;case w.FAILED_PRECONDITION:return tk.FAILED_PRECONDITION;case w.ABORTED:return tk.ABORTED;case w.OUT_OF_RANGE:return tk.OUT_OF_RANGE;case w.UNIMPLEMENTED:return tk.UNIMPLEMENTED;case w.DATA_LOSS:return tk.DATA_LOSS;default:return tN(39323,{code:e})}}(I=w||(w={}))[I.OK=0]="OK",I[I.CANCELLED=1]="CANCELLED",I[I.UNKNOWN=2]="UNKNOWN",I[I.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",I[I.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",I[I.NOT_FOUND=5]="NOT_FOUND",I[I.ALREADY_EXISTS=6]="ALREADY_EXISTS",I[I.PERMISSION_DENIED=7]="PERMISSION_DENIED",I[I.UNAUTHENTICATED=16]="UNAUTHENTICATED",I[I.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",I[I.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",I[I.ABORTED=10]="ABORTED",I[I.OUT_OF_RANGE=11]="OUT_OF_RANGE",I[I.UNIMPLEMENTED=12]="UNIMPLEMENTED",I[I.INTERNAL=13]="INTERNAL",I[I.UNAVAILABLE=14]="UNAVAILABLE",I[I.DATA_LOSS=15]="DATA_LOSS";let iM=null;function iL(){return new TextEncoder}let iF=new h([0xffffffff,0xffffffff],0);function iV(e){let t=iL().encode(e),r=new d;return r.update(t),new Uint8Array(r.digest())}function iU(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new h([r,n],0),new h([s,i],0)]}class iB{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new iq(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new iq(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new iq(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=h.fromNumber(this.ge)}ye(e,t,r){let n=e.add(t.multiply(h.fromNumber(r)));return 1===n.compare(iF)&&(n=new h([n.getBits(0),n.getBits(1)],0)),n.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,r]=iU(iV(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);if(!this.we(n))return!1}return!0}static create(e,t,r){let n=new iB(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.ge)return;let[t,r]=iU(iV(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);this.be(n)}}be(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class iq extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class iz{constructor(e,t,r,n,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,i$.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new iz(t4.min(),n,new nT(tB),s1,s7())}}class i${constructor(e,t,r,n,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new i$(r,t,s7(),s7(),s7())}}class iG{constructor(e,t,r,n){this.Se=e,this.removedTargetIds=t,this.key=r,this.De=n}}class iK{constructor(e,t){this.targetId=e,this.Ce=t}}class iH{constructor(e,t,r=nR.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class iW{constructor(){this.ve=0,this.Fe=iY(),this.Me=nR.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=s7(),t=s7(),r=s7();return this.Fe.forEach((n,s)=>{switch(s){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:tN(38017,{changeType:s})}}),new i$(this.Me,this.xe,e,t,r)}Ke(){this.Oe=!1,this.Fe=iY()}qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,tC(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class iQ{constructor(e){this.Ge=e,this.ze=new Map,this.je=s1,this.He=iJ(),this.Je=iJ(),this.Ze=new nT(tB)}Xe(e){for(let t of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.We(),r.Ne||r.Ke(),r.Le(e.resumeToken);break;case 2:r.We(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.Qe(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:tN(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){let t=e.targetId,r=e.Ce.count,n=this.ot(t);if(n){let a=n.target;if(sO(a))if(0===r){let e=new tJ(a.path);this.et(t,e,su.newNoDocument(e,t4.min()))}else tC(1===r,20013,{expectedCount:r});else{let n=this._t(t);if(n!==r){var s,i;let r,a,o=this.ut(e),l=o?this.ct(o,e,n):1;0!==l&&(this.it(t),this.Ze=this.Ze.insert(t,2===l?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),iM?.lt((s=e.Ce,i=this.Ge.ht(),r={localCacheCount:n,existenceFilterCount:s.count,databaseId:i.database,projectId:i.projectId},(a=s.unchangedNames)&&(r.bloomFilter={applied:0===l,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>o?.mightContain(e)??!1}),r))}}}}ut(e){let t,r,n=e.Ce.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:s="",padding:i=0},hashCount:a=0}=n;try{t=nL(s).toUint8Array()}catch(e){if(e instanceof nD)return tE("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new iB(t,i,a)}catch(e){return tE(e instanceof iq?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.ge?null:r}ct(e,t,r){return 2*(t.Ce.count!==r-this.Pt(e,t.targetId))}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let s=this.Ge.ht(),i=`projects/${s.projectId}/databases/${s.database}/documents/${r.path.canonicalString()}`;e.mightContain(i)||(this.et(t,r,null),n++)}),n}Tt(e){let t=new Map;this.ze.forEach((r,n)=>{let s=this.ot(n);if(s){if(r.current&&sO(s.target)){let t=new tJ(s.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,su.newNoDocument(t,e))}r.Be&&(t.set(n,r.ke()),r.Ke())}});let r=s7();this.Je.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));let n=new iz(e,t,this.Ze,this.je,r);return this.je=s1,this.He=iJ(),this.Je=iJ(),this.Ze=new nT(tB),n}Ye(e,t){if(!this.rt(e))return;let r=2*!!this.Et(e,t.key);this.nt(e).qe(t.key,r),this.je=this.je.insert(t.key,t),this.He=this.He.insert(t.key,this.It(t.key).add(e)),this.Je=this.Je.insert(t.key,this.Rt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let n=this.nt(e);this.Et(e,t)?n.qe(t,1):n.Ue(t),this.Je=this.Je.insert(t,this.Rt(t).delete(e)),this.Je=this.Je.insert(t,this.Rt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let t=this.ze.get(e);return t||(t=new iW,this.ze.set(e,t)),t}Rt(e){let t=this.Je.get(e);return t||(t=new nC(tB),this.Je=this.Je.insert(e,t)),t}It(e){let t=this.He.get(e);return t||(t=new nC(tB),this.He=this.He.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||tI("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new iW),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function iJ(){return new nT(tJ.comparator)}function iY(){return new nT(tJ.comparator)}let iX={asc:"ASCENDING",desc:"DESCENDING"},iZ={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},i0={and:"AND",or:"OR"};class i1{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function i2(e,t){return e.useProto3Json||rT(t)?t:{value:t}}function i5(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function i6(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function i4(e){let t;return tC(!!e,49232),t4.fromTimestamp(new t6((t=nO(e)).seconds,t.nanos))}function i3(e,t){return i8(e,t).canonicalString()}function i8(e,t){let r=new tH(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function i7(e){let t=tH.fromString(e);return tC(ap(t),10190,{key:t.toString()}),t}function i9(e,t){return i3(e.databaseId,t.path)}function ae(e,t){let r=i7(t);if(r.get(1)!==e.databaseId.projectId)throw new tA(tk.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new tA(tk.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new tJ(as(r))}function at(e,t){return i3(e.databaseId,t)}function ar(e){let t=i7(e);return 4===t.length?tH.emptyPath():as(t)}function an(e){return new tH(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function as(e){return tC(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function ai(e,t,r){return{name:i9(e,t),fields:r.value.mapValue.fields}}function aa(e,t,r){let n=ae(e,t.name),s=i4(t.updateTime),i=t.createTime?i4(t.createTime):t4.min(),a=new sc({mapValue:{fields:t.fields}}),o=su.newFoundDocument(n,s,i,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function ao(e,t){var r,n;let s;if(t instanceof iI)s={update:ai(e,t.key,t.value)};else if(t instanceof iS)s={delete:i9(e,t.key)};else if(t instanceof i_){let r;s={update:ai(e,t.key,t.data),updateMask:(n=t.fieldMask,r=[],n.fields.forEach(e=>r.push(e.canonicalString())),{fieldPaths:r})}}else{if(!(t instanceof iC))return tN(16599,{dt:t.type});s={verify:i9(e,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof ii)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof ia)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof il)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof iu)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw tN(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(s.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:i5(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:tN(27497)),s}function al(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?ig.updateTime(i4(r.updateTime)):void 0!==r.exists?ig.exists(r.exists):ig.none():ig.none(),s=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?(tC("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new ii):"appendMissingElements"in t?r=new ia(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new il(t.removeAllFromArray.values||[]):"increment"in t?r=new iu(e,t.increment):tN(16584,{proto:t}),new ip(tQ.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=ae(e,t.update.name),i=new sc({mapValue:{fields:t.update.fields}});return t.updateMask?new i_(r,i,new nj((t.updateMask.fieldPaths||[]).map(e=>tQ.fromServerFormat(e))),n,s):new iI(r,i,n,s)}return t.delete?new iS(ae(e,t.delete),n):t.verify?new iC(ae(e,t.verify),n):tN(1463,{proto:t})}function ac(e,t){return{documents:[at(e,t.path)]}}function au(e,t){var r,n;let s,i={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(s=a,i.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=a.popLast(),i.structuredQuery.from=[{collectionId:a.lastSegment()}]),i.parent=at(e,s);let o=function(e){if(0!==e.length)return function e(t){var r;let n;return t instanceof sg?function(e){if("=="===e.op){if(st(e.value))return{unaryFilter:{field:ad(e.field),op:"IS_NAN"}};if(se(e.value))return{unaryFilter:{field:ad(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(st(e.value))return{unaryFilter:{field:ad(e.field),op:"IS_NOT_NAN"}};if(se(e.value))return{unaryFilter:{field:ad(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ad(e.field),op:iZ[e.op],value:e.value}}}(t):t instanceof sy?1===(n=(r=t).getFilters().map(t=>e(t))).length?n[0]:{compositeFilter:{op:i0[r.op],filters:n}}:tN(54877,{filter:t})}(sy.create(e,"and"))}(t.filters);o&&(i.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:ad(e.field),direction:iX[e.dir]}))}(t.orderBy);l&&(i.structuredQuery.orderBy=l);let c=i2(e,t.limit);return null!==c&&(i.structuredQuery.limit=c),t.startAt&&(i.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(i.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{ft:i,parent:s}}function ah(e){var t,r,n;let s,i,a,o,l=ar(e.parent),c=e.structuredQuery,u=c.from?c.from.length:0,h=null;if(u>0){tC(1===u,65062);let e=c.from[0];e.allDescendants?h=e.collectionId:l=l.child(e.collectionId)}let d=[];c.where&&(d=(s=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=af(e.unaryFilter.field);return sg.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=af(e.unaryFilter.field);return sg.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=af(e.unaryFilter.field);return sg.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let s=af(e.unaryFilter.field);return sg.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return tN(61313);default:return tN(60726)}}(t):void 0!==t.fieldFilter?sg.create(af(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return tN(58110);default:return tN(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?sy.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return tN(1026)}}(t.compositeFilter.op)):tN(30097,{filter:t})}(c.where))instanceof sy&&sv(s)?s.getFilters():[s]);let f=[];c.orderBy&&(f=c.orderBy.map(e=>new sp(af(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let p=null;c.limit&&(p=rT(i="object"==typeof(t=c.limit)?t.value:t)?null:i);let m=null;c.startAt&&(a=!!(r=c.startAt).before,m=new sh(r.values||[],a));let g=null;return c.endAt&&(o=!(n=c.endAt).before,g=new sh(n.values||[],o)),new sV(l,h,f,d,p,"F",m,g)}function ad(e){return{fieldPath:e.canonicalString()}}function af(e){return tQ.fromServerFormat(e.fieldPath)}function ap(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function am(e){return!!e&&"function"==typeof e._toProto&&"ProtoValue"===e._protoValueType}class ag{constructor(e,t,r,n,s=t4.min(),i=t4.min(),a=nR.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new ag(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ag(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ag(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ag(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ay{constructor(e){this.yt=e}}function ab(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:ax(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var s;n.document={name:i9(s=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:i5(s,t.version.toTimestamp()),createTime:i5(s,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:av(t.version)};else{if(!t.isUnknownDocument())return tN(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:av(t.version)}}return n}function ax(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function av(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function aw(e){let t=new t6(e.seconds,e.nanoseconds);return t4.fromTimestamp(t)}function aI(e,t){let r=(t.baseMutations||[]).map(t=>al(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>al(e.yt,t)),s=t6.fromMillis(t.localWriteTimeMs);return new ik(t.batchId,s,r,n)}function a_(e){var t;let r,n=aw(e.readTime),s=void 0!==e.lastLimboFreeSnapshotVersion?aw(e.lastLimboFreeSnapshotVersion):t4.min();return new ag(void 0!==e.query.documents?(tC(1===(r=(t=e.query).documents.length),1966,{count:r}),s$(sU(ar(t.documents[0])))):s$(ah(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,s,nR.fromBase64String(e.resumeToken))}function aE(e,t){let r,n=av(t.snapshotVersion),s=av(t.lastLimboFreeSnapshotVersion);r=sO(t.target)?ac(e.yt,t.target):au(e.yt,t.target).ft;let i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:sR(t.target),readTime:n,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:s,query:r}}function aT(e){let t=ah({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?sH(t,t.limit,"L"):t}function aN(e,t){return new ij(t.largestBatchId,al(e.yt,t.overlayMutation))}function aS(e,t){let r=t.path.lastSegment();return[e,rC(t.path.popLast()),r]}function aC(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:av(n.readTime),documentKey:rC(n.documentKey.path),largestBatchId:n.largestBatchId}}class ak{getBundleMetadata(e,t){return nw(e,r3).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:aw(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return nw(e,r3).put({bundleId:t.id,createTime:av(i4(t.createTime)),version:t.version})}getNamedQuery(e,t){return nw(e,r8).get(t).next(e=>{if(e)return{name:e.name,query:aT(e.bundledQuery),readTime:aw(e.readTime)}})}saveNamedQuery(e,t){return nw(e,r8).put({name:t.name,readTime:av(i4(t.readTime)),bundledQuery:t.bundledQuery})}}class aA{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new aA(e,t.uid||"")}getOverlay(e,t){return nw(e,nl).get(aS(this.userId,t)).next(e=>e?aN(this.serializer,e):null)}getOverlays(e,t){let r=s4();return rc.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,s)=>{let i=new ij(t,s);n.push(this.bt(e,i))}),rc.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(rC(e.getCollectionPath())));let s=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);s.push(nw(e,nl).X(nu,n))}),rc.waitFor(s)}getOverlaysForCollection(e,t,r){let n=s4(),s=rC(t),i=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,1/0],!0);return nw(e,nl).H(nu,i).next(e=>{for(let t of e){let e=aN(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let s,i=s4(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,1/0],!0);return nw(e,nl).ee({index:nd,range:a},(e,t,r)=>{let a=aN(this.serializer,t);i.size()<n||a.largestBatchId===s?(i.set(a.getKey(),a),s=a.largestBatchId):r.done()}).next(()=>i)}bt(e,t){return nw(e,nl).put(function(e,t,r){let[n,s,i]=aS(t,r.mutation.key);return{userId:t,collectionPath:s,documentId:i,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:ao(e.yt,r.mutation)}}(this.serializer,this.userId,t))}}class aj{St(e){return nw(e,np)}getSessionToken(e){return this.St(e).get("sessionToken").next(e=>{let t=e?.value;return t?nR.fromUint8Array(t):nR.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}}class aD{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(nM(e.integerValue));else if("doubleValue"in e){let r=nM(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),rN(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=nO(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(nL(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?si(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):sn(e)?this.kt(e.mapValue,t):(this.Kt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Nt(t)):tN(19022,{Ut:e})}Ot(e,t){this.Ft(t,25),this.$t(e,t)}$t(e,t){t.xt(e)}Kt(e,t){let r=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(r)))this.Ot(e,t),this.Ct(r[e],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let n=r[nX].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(nM(n)),this.Ot(nX,t),this.Ct(r[nX],t)}qt(e,t){let r=e.values||[];for(let e of(this.Ft(t,50),r))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),tJ.fromName(e).path.forEach(e=>{this.Ft(t,60),this.$t(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function aR(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}aD.Wt=new aD;class aP{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Qt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ht(r.value),r=t.next();this.Jt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ht(e);else if(e<2048)this.Ht(960|e>>>6),this.Ht(128|63&e);else if(t<"\uD800"||"\uDBFF"<t)this.Ht(480|e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e);else{let e=t.codePointAt(0);this.Ht(240|e>>>18),this.Ht(128|63&e>>>12),this.Ht(128|63&e>>>6),this.Ht(128|63&e)}}this.Jt()}Yt(e){let t=this.en(e),r=aR(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),r=aR(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t,r=((t=new DataView(new ArrayBuffer(8))).setFloat64(0,e,!1),new Uint8Array(t.buffer)),n=!!(128&r[0]);r[0]^=n?255:128;for(let e=1;e<r.length;++e)r[e]^=255*!!n;return r}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Ht(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Jt(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class aO{constructor(e){this.cn=e}Bt(e){this.cn.Qt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.Yt(e)}vt(){this.cn.rn()}}class aM{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Xt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class aL{constructor(){this.cn=new aP,this.ascending=new aO(this.cn),this.descending=new aM(this.cn)}seed(e){this.cn.seed(e)}ln(e){return 0===e?this.ascending:this.descending}un(){return this.cn.un()}reset(){this.cn.reset()}}class aF{constructor(e,t,r,n){this.hn=e,this.Pn=t,this.Tn=r,this.In=n}En(){let e=this.In.length,t=0===e||255===this.In[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.In,0),t!==e?r.set([0],this.In.length):++r[r.length-1],new aF(this.hn,this.Pn,this.Tn,r)}Rn(e,t,r){return{indexId:this.hn,uid:e,arrayValue:aB(this.Tn),directionalValue:aB(this.In),orderedDocumentKey:aB(t),documentKey:r.path.toArray()}}An(e,t,r){let n=this.Rn(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function aV(e,t){let r=e.hn-t.hn;return 0!==r||0!==(r=aU(e.Tn,t.Tn))||0!==(r=aU(e.In,t.In))?r:tJ.comparator(e.Pn,t.Pn)}function aU(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function aB(e){return Y()?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):e}function aq(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)}class az{constructor(e){for(const t of(this.Vn=new nC((e,t)=>tQ.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.mn=[],e.filters))t.isInequality()?this.Vn=this.Vn.add(t):this.mn.push(t)}get fn(){return this.Vn.size>1}gn(e){if(tC(e.collectionGroup===this.collectionId,49279),this.fn)return!1;let t=t8(e);if(void 0!==t&&!this.pn(t))return!1;let r=t7(e),n=new Set,s=0,i=0;for(;s<r.length&&this.pn(r[s]);++s)n=n.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Vn.size>0){let e=this.Vn.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[s];if(!this.yn(e,t)||!this.wn(this.dn[i++],t))return!1}++s}for(;s<r.length;++s){let e=r[s];if(i>=this.dn.length||!this.wn(this.dn[i++],e))return!1}return!0}bn(){if(this.fn)return null;let e=new nC(tQ.comparator),t=[];for(let r of this.mn)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new re(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new re(r.field,0))}for(let r of this.dn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new re(r.field,+("asc"!==r.dir))));return new t3(t3.UNKNOWN_ID,this.collectionId,t,rt.empty())}pn(e){for(let t of this.mn)if(this.yn(t,e))return!0;return!1}yn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}wn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function a$(e){return e instanceof sg}function aG(e){return e instanceof sy&&sv(e)}function aK(e){return a$(e)||aG(e)||function(e){if(e instanceof sy&&sx(e)){for(let t of e.getFilters())if(!a$(t)&&!aG(t))return!1;return!0}return!1}(e)}function aH(e,t){return tC(e instanceof sg||e instanceof sy,38388),tC(t instanceof sg||t instanceof sy,25473),aQ(e instanceof sg?t instanceof sg?sy.create([e,t],"and"):aW(e,t):t instanceof sg?aW(t,e):function(e,t){if(tC(e.filters.length>0&&t.filters.length>0,48005),sb(e)&&sb(t))return sI(e,t.getFilters());let r=sx(e)?e:t,n=sx(e)?t:e,s=r.filters.map(e=>aH(e,n));return sy.create(s,"or")}(e,t))}function aW(e,t){if(sb(t))return sI(t,e.getFilters());{let r=t.filters.map(t=>aH(e,t));return sy.create(r,"or")}}function aQ(e){if(tC(e instanceof sg||e instanceof sy,11850),e instanceof sg)return e;let t=e.getFilters();if(1===t.length)return aQ(t[0]);if(sw(e))return e;let r=t.map(e=>aQ(e)),n=[];return r.forEach(t=>{t instanceof sg?n.push(t):t instanceof sy&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:sy.create(n,e.op)}class aJ{constructor(){this.Sn=new aY}addToCollectionParentIndex(e,t){return this.Sn.add(t),rc.resolve()}getCollectionParents(e,t){return rc.resolve(this.Sn.getEntries(t))}addFieldIndex(e,t){return rc.resolve()}deleteFieldIndex(e,t){return rc.resolve()}deleteAllFieldIndexes(e){return rc.resolve()}createTargetIndexes(e,t){return rc.resolve()}getDocumentsMatchingTarget(e,t){return rc.resolve(null)}getIndexType(e,t){return rc.resolve(0)}getFieldIndexes(e,t){return rc.resolve([])}getNextCollectionGroupToUpdate(e){return rc.resolve(null)}getMinOffset(e,t){return rc.resolve(rs.min())}getMinOffsetFromCollectionGroup(e,t){return rc.resolve(rs.min())}updateCollectionGroup(e,t,r){return rc.resolve()}updateIndexEntries(e,t){return rc.resolve()}}class aY{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new nC(tH.comparator),s=!n.has(r);return this.index[t]=n.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new nC(tH.comparator)).toArray()}}let aX="IndexedDbIndexManager",aZ=new Uint8Array(0);class a0{constructor(e,t){this.databaseId=t,this.Dn=new aY,this.Cn=new s0(e=>sR(e),(e,t)=>sP(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Dn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.Dn.add(t)});let s={collectionId:r,parent:rC(n)};return nw(e,r5).put(s)}return rc.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return nw(e,r5).H(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(rk(n.parent))}return r})}addFieldIndex(e,t){let r=nw(e,r7),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let s=r.add(n);if(t.indexState){let r=nw(e,ne);return s.next(e=>{r.put(aC(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=nw(e,r7),n=nw(e,ne),s=nw(e,ns);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=nw(e,r7),r=nw(e,ns),n=nw(e,ne);return t.X().next(()=>r.X()).next(()=>n.X())}createTargetIndexes(e,t){return rc.forEach(this.vn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new az(t).bn();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=nw(e,ns),n=!0,s=new Map;return rc.forEach(this.vn(t),t=>this.Fn(e,t).next(e=>{n&&(n=!!e),s.set(t,e)})).next(()=>{if(n){let e=s7(),n=[];return rc.forEach(s,(s,i)=>{tI(aX,`Using index id=${s.indexId}|cg=${s.collectionGroup}|f=${s.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${sR(t)}`);let a=function(e,t){let r=t8(t);if(void 0===r)return null;for(let t of sM(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(i,s),o=function(e,t){let r=new Map;for(let n of t7(t))for(let t of sM(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(i,s),l=function(e,t){let r=[],n=!0;for(let s of t7(t)){let t=0===s.kind?sL(e,s.fieldPath,e.startAt):sF(e,s.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new sh(r,n)}(i,s),c=function(e,t){let r=[],n=!0;for(let s of t7(t)){let t=0===s.kind?sF(e,s.fieldPath,e.endAt):sL(e,s.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new sh(r,n)}(i,s),u=this.Mn(s,i,l),h=this.Mn(s,i,c),d=this.xn(s,i,o),f=this.On(s.indexId,a,u,l.inclusive,h,c.inclusive,d);return rc.forEach(f,s=>r.Z(s,t.limit).next(t=>{t.forEach(t=>{let r=tJ.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return rc.resolve(null)})}vn(e){let t=this.Cn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(tC(t instanceof sg||t instanceof sy,34018),t instanceof sg)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=sy.create(r,t.op);return aK(n=aQ(n))?n:(tC(n instanceof sy,64498),tC(sb(n),40251),tC(n.filters.length>1,57927),n.filters.reduce((e,t)=>aH(e,t)))}(function e(t){if(tC(t instanceof sg||t instanceof sy,20012),t instanceof sg){if(t instanceof sC){let e=t.value.arrayValue?.values?.map(e=>sg.create(t.field,"==",e))||[];return sy.create(e,"or")}return t}let r=t.filters.map(t=>e(t));return sy.create(r,t.op)}(e));return tC(aK(t),7391),a$(t)||aG(t)?[t]:t.getFilters()})(sy.create(e.filters,"and")).map(t=>sD(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t)),t}On(e,t,r,n,s,i,a){let o=(null!=t?t.length:1)*Math.max(r.length,s.length),l=o/(null!=t?t.length:1),c=[];for(let u=0;u<o;++u){let o=t?this.Nn(t[u/l]):aZ,h=this.Bn(e,o,r[u%l],n),d=this.Ln(e,o,s[u%l],i),f=a.map(t=>this.Bn(e,o,t,!0));c.push(...this.createRange(h,d,f))}return c}Bn(e,t,r,n){let s=new aF(e,tJ.empty(),t,r);return n?s:s.En()}Ln(e,t,r,n){let s=new aF(e,tJ.empty(),t,r);return n?s.En():s}Fn(e,t){let r=new az(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.gn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.vn(t);return rc.forEach(n,t=>this.Fn(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new nC(tQ.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}kn(e,t){let r=new aL;for(let n of t7(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let s=r.ln(n.kind);aD.Wt.Dt(e,s)}return r.un()}Nn(e){let t=new aL;return aD.Wt.Dt(e,t.ln(0)),t.un()}Kn(e,t){let r,n=new aL;return aD.Wt.Dt(n8(this.databaseId,t),n.ln(0===(r=t7(e)).length?0:r[r.length-1].kind)),n.un()}xn(e,t,r){if(null===r)return[];let n=[];n.push(new aL);let s=0;for(let i of t7(e)){let e=r[s++];for(let r of n)if(this.qn(t,i.fieldPath)&&n9(e))n=this.Un(n,i,e);else{let t=r.ln(i.kind);aD.Wt.Dt(e,t)}}return this.$n(n)}Mn(e,t,r){return this.xn(e,t,r.position)}$n(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Un(e,t,r){let n=[...e],s=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new aL;n.seed(r.un()),aD.Wt.Dt(e,n.ln(t.kind)),s.push(n)}return s}qn(e,t){return!!e.filters.find(e=>e instanceof sg&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=nw(e,r7),n=nw(e,ne);return(t?r.H(r9,IDBKeyRange.bound(t,t)):r.H()).next(e=>{let t=[];return rc.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{let n,s;t.push((n=r?new rt(r.sequenceNumber,new rs(aw(r.readTime),new tJ(rk(r.documentKey)),r.largestBatchId)):rt.empty(),s=e.fields.map(([e,t])=>new re(tQ.fromServerFormat(e),t)),new t3(e.indexId,e.collectionGroup,s,n)))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:tB(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=nw(e,r7),s=nw(e,ne);return this.Wn(e).next(e=>n.H(r9,IDBKeyRange.bound(t,t)).next(t=>rc.forEach(t,t=>s.put(aC(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return rc.forEach(t,(t,n)=>{let s=r.get(t.collectionGroup);return(s?rc.resolve(s):this.getFieldIndexes(e,t.collectionGroup)).next(s=>(r.set(t.collectionGroup,s),rc.forEach(s,r=>this.Qn(e,t,r).next(t=>{let s=this.Gn(n,r);return t.isEqual(s)?rc.resolve():this.zn(e,n,r,t,s)}))))})}jn(e,t,r,n){return nw(e,ns).put(n.Rn(this.uid,this.Kn(r,t.key),t.key))}Hn(e,t,r,n){return nw(e,ns).delete(n.An(this.uid,this.Kn(r,t.key),t.key))}Qn(e,t,r){let n=nw(e,ns),s=new nC(aV);return n.ee({index:na,range:IDBKeyRange.only([r.indexId,this.uid,aB(this.Kn(r,t))])},(e,n)=>{s=s.add(new aF(r.indexId,t,aq(n.arrayValue),aq(n.directionalValue)))}).next(()=>s)}Gn(e,t){let r=new nC(aV),n=this.kn(t,e);if(null==n)return r;let s=t8(t);if(null!=s){let i=e.data.field(s.fieldPath);if(n9(i))for(let s of i.arrayValue.values||[])r=r.add(new aF(t.indexId,e.key,this.Nn(s),n))}else r=r.add(new aF(t.indexId,e.key,aZ,n));return r}zn(e,t,r,n,s){tI(aX,"Updating index entries for document '%s'",t.key);let i=[];return function(e,t,r,n,s){let i=e.getIterator(),a=t.getIterator(),o=nA(i),l=nA(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=nA(a)):t?(s(o),o=nA(i)):(o=nA(i),l=nA(a))}}(n,s,aV,n=>{i.push(this.jn(e,t,r,n))},n=>{i.push(this.Hn(e,t,r,n))}),rc.waitFor(i)}Wn(e){let t=1;return nw(e,ne).ee({index:nr,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>aV(e,t)).filter((e,t,r)=>!t||0!==aV(e,r[t-1]));let n=[];for(let s of(n.push(e),r)){let r=aV(s,e),i=aV(s,t);if(0===r)n[0]=e.En();else if(r>0&&i<0)n.push(s),n.push(s.En());else if(i>0)break}n.push(t);let s=[];for(let e=0;e<n.length;e+=2){if(this.Jn(n[e],n[e+1]))return[];let t=n[e].An(this.uid,aZ,tJ.empty()),r=n[e+1].An(this.uid,aZ,tJ.empty());s.push(IDBKeyRange.bound(t,r))}return s}Jn(e,t){return aV(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(a1)}getMinOffset(e,t){return rc.mapArray(this.vn(t),t=>this.Fn(e,t).next(e=>e||tN(44426))).next(a1)}}function a1(e){tC(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let s=e[n].indexState.offset;0>ri(s,t)&&(t=s),r<s.largestBatchId&&(r=s.largestBatchId)}return new rs(t.readTime,t.documentKey,r)}let a2={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class a5{static withCacheSize(e){return new a5(e,a5.DEFAULT_COLLECTION_PERCENTILE,a5.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function a6(e,t,r){let n=e.store(rP),s=e.store(rV),i=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.ee({range:a},(e,t,r)=>(o++,r.delete()));i.push(l.next(()=>{tC(1===o,47070,{batchId:r.batchId})}));let c=[];for(let e of r.mutations){var u,h;let n=(u=e.key.path,h=r.batchId,[t,rC(u),h]);i.push(s.delete(n)),c.push(e.key)}return rc.waitFor(i).next(()=>c)}function a4(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw tN(14731);t=e.noDocument}return JSON.stringify(t).length}a5.DEFAULT_COLLECTION_PERCENTILE=10,a5.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,a5.DEFAULT=new a5(0x2800000,a5.DEFAULT_COLLECTION_PERCENTILE,a5.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),a5.DISABLED=new a5(-1,0,0);class a3{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Zn={}}static wt(e,t,r,n){return tC(""!==e.uid,64387),new a3(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,-1/0],[this.userId,1/0]);return a7(e).ee({index:rM,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let s=nw(e,rV),i=a7(e);return i.add({}).next(a=>{var o,l,c,u;let h,d;tC("number"==typeof a,49019);let f=new ik(a,t,r,n),p=(o=this.serializer,l=this.userId,h=f.baseMutations.map(e=>ao(o.yt,e)),d=f.mutations.map(e=>ao(o.yt,e)),{userId:l,batchId:f.batchId,localWriteTimeMs:f.localWriteTime.toMillis(),baseMutations:h,mutations:d}),m=[],g=new nC((e,t)=>tB(e.canonicalString(),t.canonicalString()));for(let e of n){let t=(c=this.userId,u=e.key.path,[c,rC(u),a]);g=g.add(e.key.path.popLast()),m.push(i.put(p)),m.push(s.put(t,rF))}return g.forEach(t=>{m.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Zn[a]=f.keys()}),rc.waitFor(m).next(()=>f)})}lookupMutationBatch(e,t){return a7(e).get(t).next(e=>e?(tC(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),aI(this.serializer,e)):null)}Xn(e,t){return this.Zn[t]?rc.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.Zn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),s=null;return a7(e).ee({index:rM,range:n},(e,t,n)=>{t.userId===this.userId&&(tC(t.batchId>=r,47524,{Yn:r}),s=aI(this.serializer,t)),n.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,1/0]),r=-1;return a7(e).ee({index:rM,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,1/0]);return a7(e).H(rM,t).next(e=>e.map(e=>aI(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,rC(t.path)],n=IDBKeyRange.lowerBound(r),s=[];return nw(e,rV).ee({range:n},(r,n,i)=>{let[a,o,l]=r,c=rk(o);if(a===this.userId&&t.path.isEqual(c))return a7(e).get(l).next(e=>{if(!e)throw tN(61480,{er:r,batchId:l});tC(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),s.push(aI(this.serializer,e))});i.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new nC(tB),n=[];return t.forEach(t=>{let s=[this.userId,rC(t.path)],i=IDBKeyRange.lowerBound(s),a=nw(e,rV).ee({range:i},(e,n,s)=>{let[i,a,o]=e,l=rk(a);i===this.userId&&t.path.isEqual(l)?r=r.add(o):s.done()});n.push(a)}),rc.waitFor(n).next(()=>this.tr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,s=[this.userId,rC(r)],i=IDBKeyRange.lowerBound(s),a=new nC(tB);return nw(e,rV).ee({range:i},(e,t,s)=>{let[i,o,l]=e,c=rk(o);i===this.userId&&r.isPrefixOf(c)?c.length===n&&(a=a.add(l)):s.done()}).next(()=>this.tr(e,a))}tr(e,t){let r=[],n=[];return t.forEach(t=>{n.push(a7(e).get(t).next(e=>{if(null===e)throw tN(35274,{batchId:t});tC(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(aI(this.serializer,e))}))}),rc.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return a6(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.nr(t.batchId)}),rc.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}nr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return rc.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return nw(e,rV).ee({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=rk(e[1]);n.push(t)}else r.done()}).next(()=>{tC(0===n.length,56720,{rr:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return a8(e,this.userId,t)}ir(e){return nw(e,rR).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function a8(e,t,r){let n=[t,rC(r.path)],s=n[1],i=IDBKeyRange.lowerBound(n),a=!1;return nw(e,rV).ee({range:i,Y:!0},(e,r,n)=>{let[i,o,l]=e;i===t&&o===s&&(a=!0),n.done()}).next(()=>a)}function a7(e){return nw(e,rP)}class a9{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new a9(0)}static ar(){return new a9(-1)}}class oe{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.ur(e).next(t=>{let r=new a9(t.highestTargetId);return t.highestTargetId=r.next(),this.cr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.ur(e).next(e=>t4.fromTimestamp(new t6(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.ur(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.ur(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.cr(e,n)))}addTargetData(e,t){return this.lr(e,t).next(()=>this.ur(e).next(r=>(r.targetCount+=1,this.hr(t,r),this.cr(e,r))))}updateTargetData(e,t){return this.lr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>nw(e,rW).delete(t.targetId)).next(()=>this.ur(e)).next(t=>(tC(t.targetCount>0,8065),t.targetCount-=1,this.cr(e,t)))}removeTargets(e,t,r){let n=0,s=[];return nw(e,rW).ee((i,a)=>{let o=a_(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,s.push(this.removeTargetData(e,o)))}).next(()=>rc.waitFor(s)).next(()=>n)}forEachTarget(e,t){return nw(e,rW).ee((e,r)=>{t(a_(r))})}ur(e){return nw(e,r2).get(r1).next(e=>(tC(null!==e,2888),e))}cr(e,t){return nw(e,r2).put(r1,t)}lr(e,t){return nw(e,rW).put(aE(this.serializer,t))}hr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.ur(e).next(e=>e.targetCount)}getTargetData(e,t){let r=sR(t),n=IDBKeyRange.bound([r,-1/0],[r,1/0]),s=null;return nw(e,rW).ee({range:n,index:rQ},(e,r,n)=>{let i=a_(r);sP(t,i.target)&&(s=i,n.done())}).next(()=>s)}addMatchingKeys(e,t,r){let n=[],s=ot(e);return t.forEach(t=>{let i=rC(t.path);n.push(s.put({targetId:r,path:i})),n.push(this.referenceDelegate.addReference(e,r,t))}),rc.waitFor(n)}removeMatchingKeys(e,t,r){let n=ot(e);return rc.forEach(t,t=>{let s=rC(t.path);return rc.waitFor([n.delete([r,s]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=ot(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=ot(e),s=s7();return n.ee({range:r,Y:!0},(e,t,r)=>{let n=new tJ(rk(e[1]));s=s.add(n)}).next(()=>s)}containsKey(e,t){let r=rC(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),s=0;return ot(e).ee({index:rZ,Y:!0,range:n},([e,t],r,n)=>{0!==e&&(s++,n.done())}).next(()=>s>0)}At(e,t){return nw(e,rW).get(t).next(e=>e?a_(e):null)}}function ot(e){return nw(e,rY)}let or="LruGarbageCollector";function on([e,t],[r,n]){let s=tB(e,r);return 0===s?tB(t,n):s}class os{constructor(e){this.Pr=e,this.buffer=new nC(on),this.Tr=0}Ir(){return++this.Tr}Er(e){let t=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>on(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class oi{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Ar(e){tI(or,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){rg(e)?tI(or,"Ignoring IndexedDB error during garbage collection: ",e):await rl(e)}await this.Ar(3e5)})}}class oa{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return rc.resolve(rE.ce);let r=new os(t);return this.Vr.forEachTarget(e,e=>r.Er(e.sequenceNumber)).next(()=>this.Vr.mr(e,e=>r.Er(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(tI("LruGarbageCollector","Garbage collection skipped; disabled"),rc.resolve(a2)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(tI("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),a2):this.gr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,t){let r,n,s,i,a,o,l,c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(tI("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,i=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(s=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),tw()<=u.DEBUG&&tI("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${i-c}ms
	Determined least recently used ${n} in `+(a-i)+"ms\n"+`	Removed ${s} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-c}ms`),rc.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:s,documentsRemoved:e})))}}class oo{constructor(e,t){this.db=e,this.garbageCollector=new oa(this,t)}dr(e){let t=this.pr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}mr(e,t){return this.yr(e,(e,r)=>t(r))}addReference(e,t,r){return ol(e,r)}removeReference(e,t,r){return ol(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ol(e,t)}wr(e,t){let r;return r=!1,nw(e,rR).te(n=>a8(e,n,t).next(e=>(e&&(r=!0),rc.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],s=0;return this.yr(e,(i,a)=>{if(a<=t){let t=this.wr(e,i).next(t=>{if(!t)return s++,r.getEntry(e,i).next(()=>(r.removeEntry(i,t4.min()),ot(e).delete([0,rC(i.path)])))});n.push(t)}}).next(()=>rc.waitFor(n)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ol(e,t)}yr(e,t){let r=ot(e),n,s=rE.ce;return r.ee({index:rZ},([e,r],{path:i,sequenceNumber:a})=>{0===e?(s!==rE.ce&&t(new tJ(rk(n)),s),s=a,n=i):s=rE.ce}).next(()=>{s!==rE.ce&&t(new tJ(rk(n)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ol(e,t){var r;return ot(e).put((r=e.currentSequenceNumber,{targetId:0,path:rC(t.path),sequenceNumber:r}))}class oc{constructor(){this.changes=new s0(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,su.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?rc.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ou{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return nw(e,rU).put(r)}removeEntry(e,t,r){let n;return nw(e,rU).delete([(n=t.path.toArray()).slice(0,n.length-2),n[n.length-2],ax(r),n[n.length-1]])}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=su.newInvalidDocument(t);return nw(e,rU).ee({index:rq,range:IDBKeyRange.only(od(t))},(e,n)=>{r=this.Sr(t,n)}).next(()=>r)}Dr(e,t){let r={size:0,document:su.newInvalidDocument(t)};return nw(e,rU).ee({index:rq,range:IDBKeyRange.only(od(t))},(e,n)=>{r={document:this.Sr(t,n),size:a4(n)}}).next(()=>r)}getEntries(e,t){let r=s1;return this.Cr(e,t,(e,t)=>{let n=this.Sr(e,t);r=r.insert(e,n)}).next(()=>r)}vr(e,t){let r=s1,n=new nT(tJ.comparator);return this.Cr(e,t,(e,t)=>{let s=this.Sr(e,t);r=r.insert(e,s),n=n.insert(e,a4(t))}).next(()=>({documents:r,Fr:n}))}Cr(e,t,r){if(t.isEmpty())return rc.resolve();let n=new nC(op);t.forEach(e=>n=n.add(e));let s=IDBKeyRange.bound(od(n.first()),od(n.last())),i=n.getIterator(),a=i.getNext();return nw(e,rU).ee({index:rq,range:s},(e,t,n)=>{let s=tJ.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>op(a,s);)r(a,null),a=i.getNext();a&&a.isEqual(s)&&(r(a,t),a=i.hasNext()?i.getNext():null),a?n.j(od(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,s){let i=t.path,a=[i.popLast().toArray(),i.lastSegment(),ax(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return nw(e,rU).H(IDBKeyRange.bound(a,o,!0)).next(e=>{s?.incrementDocumentReadCount(e.length);let r=s1;for(let s of e){let e=this.Sr(tJ.fromSegments(s.prefixPath.concat(s.collectionGroup,s.documentId)),s);e.isFoundDocument()&&(sY(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let s=s1,i=of(t,r),a=of(t,rs.max());return nw(e,rU).ee({index:r$,range:IDBKeyRange.bound(i,a,!0)},(e,t,r)=>{let i=this.Sr(tJ.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(s=s.insert(i.key,i)).size===n&&r.done()}).next(()=>s)}newChangeBuffer(e){return new oh(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return nw(e,rK).get(rH).next(e=>(tC(!!e,20021),e))}br(e,t){return nw(e,rK).put(rH,t)}Sr(e,t){if(t){let e=function(e,t){var r;let n,s;if(t.document)n=aa(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=tJ.fromSegments(t.noDocument.path),r=aw(t.noDocument.readTime);n=su.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return tN(56709);{let e=tJ.fromSegments(t.unknownDocument.path),r=aw(t.unknownDocument.version);n=su.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime((s=new t6((r=t.readTime)[0],r[1]),t4.fromTimestamp(s))),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(t4.min())))return e}return su.newInvalidDocument(e)}}class oh extends oc{constructor(e,t){super(),this.Mr=e,this.trackRemovals=t,this.Or=new s0(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new nC((e,t)=>tB(e.canonicalString(),t.canonicalString()));return this.changes.forEach((s,i)=>{let a=this.Or.get(s);if(t.push(this.Mr.removeEntry(e,s,a.readTime)),i.isValidDocument()){let o=ab(this.Mr.serializer,i);n=n.add(s.path.popLast());let l=a4(o);r+=l-a.size,t.push(this.Mr.addEntry(e,s,o))}else if(r-=a.size,this.trackRemovals){let r=ab(this.Mr.serializer,i.convertToNoDocument(t4.min()));t.push(this.Mr.addEntry(e,s,r))}}),n.forEach(r=>{t.push(this.Mr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Mr.updateMetadata(e,r)),rc.waitFor(t)}getFromCache(e,t){return this.Mr.Dr(e,t).next(e=>(this.Or.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Mr.vr(e,t).next(({documents:e,Fr:t})=>(t.forEach((t,r)=>{this.Or.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function od(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function of(e,t){let r=t.documentKey.path.toArray();return[e,ax(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function op(e,t){let r=e.path.toArray(),n=t.path.toArray(),s=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(s=tB(r[e],n[e]))return s;return(s=tB(r.length,n.length))||(s=tB(r[r.length-2],n[n.length-2]))||tB(r[r.length-1],n[n.length-1])}class om{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class og{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&iv(r.mutation,e,nj.empty(),t6.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,s7()).next(()=>t))}getLocalViewOfDocuments(e,t,r=s7()){let n=s4();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=s5();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=s4();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,s7()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let s=s1,i=s4(),a=s4();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof i_)?s=s.insert(t.key,t):void 0!==a?(i.set(t.key,a.mutation.getFieldMask()),iv(a.mutation,t,a.mutation.getFieldMask(),t6.now())):i.set(t.key,nj.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>a.set(e,new om(t,i.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=s4(),n=new nT((e,t)=>e-t),s=s7();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let s of e)s.keys().forEach(e=>{let i=t.get(e);if(null===i)return;let a=r.get(e)||nj.empty();a=s.applyToLocalView(i,a),r.set(e,a);let o=(n.get(s.batchId)||s7()).add(e);n=n.insert(s.batchId,o)})}).next(()=>{let i=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,c=s4();l.forEach(e=>{if(!s.has(e)){let n=ix(t.get(e),r.get(e));null!==n&&c.set(e,n),s=s.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,o,c))}return rc.waitFor(i)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return tJ.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):sq(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(s=>{let i=n-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-s.size):rc.resolve(s4()),a=-1,o=s;return i.next(t=>rc.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),s.get(t)?rc.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,s)).next(()=>this.computeViews(e,o,t,s7())).next(e=>({batchId:a,changes:s6(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new tJ(t)).next(e=>{let t=s5();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let s=t.collectionGroup,i=s5();return this.indexManager.getCollectionParents(e,s).next(a=>rc.forEach(a,a=>{let o=new sV(a.child(s),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,r,n){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,n))).next(e=>{s.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,su.newInvalidDocument(n)))});let r=s5();return e.forEach((e,n)=>{let i=s.get(e);void 0!==i&&iv(i.mutation,n,nj.empty(),t6.now()),sY(t,n)&&(r=r.insert(e,n))}),r})}}class oy{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,t){return rc.resolve(this.Nr.get(t))}saveBundleMetadata(e,t){return this.Nr.set(t.id,{id:t.id,version:t.version,createTime:i4(t.createTime)}),rc.resolve()}getNamedQuery(e,t){return rc.resolve(this.Br.get(t))}saveNamedQuery(e,t){return this.Br.set(t.name,{name:t.name,query:aT(t.bundledQuery),readTime:i4(t.readTime)}),rc.resolve()}}class ob{constructor(){this.overlays=new nT(tJ.comparator),this.Lr=new Map}getOverlay(e,t){return rc.resolve(this.overlays.get(t))}getOverlays(e,t){let r=s4();return rc.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.bt(e,t,n)}),rc.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.Lr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.Lr.delete(r)),rc.resolve()}getOverlaysForCollection(e,t,r){let n=s4(),s=t.length+1,i=new tJ(t.child("")),a=this.overlays.getIteratorFrom(i);for(;a.hasNext();){let e=a.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>r&&n.set(e.getKey(),e)}return rc.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let s=new nT((e,t)=>e-t),i=this.overlays.getIterator();for(;i.hasNext();){let e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=s.get(e.largestBatchId);null===t&&(t=s4(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=s4(),o=s.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return rc.resolve(a)}bt(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.Lr.get(n.largestBatchId).delete(r.key);this.Lr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new ij(t,r));let s=this.Lr.get(t);void 0===s&&(s=s7(),this.Lr.set(t,s)),this.Lr.set(t,s.add(r.key))}}class ox{constructor(){this.sessionToken=nR.EMPTY_BYTE_STRING}getSessionToken(e){return rc.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,rc.resolve()}}class ov{constructor(){this.kr=new nC(ow.Kr),this.qr=new nC(ow.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,t){let r=new ow(e,t);this.kr=this.kr.add(r),this.qr=this.qr.add(r)}$r(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Wr(new ow(e,t))}Qr(e,t){e.forEach(e=>this.removeReference(e,t))}Gr(e){let t=new tJ(new tH([])),r=new ow(t,e),n=new ow(t,e+1),s=[];return this.qr.forEachInRange([r,n],e=>{this.Wr(e),s.push(e.key)}),s}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){let t=new tJ(new tH([])),r=new ow(t,e),n=new ow(t,e+1),s=s7();return this.qr.forEachInRange([r,n],e=>{s=s.add(e.key)}),s}containsKey(e){let t=new ow(e,0),r=this.kr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class ow{constructor(e,t){this.key=e,this.Hr=t}static Kr(e,t){return tJ.comparator(e.key,t.key)||tB(e.Hr,t.Hr)}static Ur(e,t){return tB(e.Hr,t.Hr)||tJ.comparator(e.key,t.key)}}class oI{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Yn=1,this.Jr=new nC(ow.Kr)}checkEmpty(e){return rc.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let s=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let i=new ik(s,t,r,n);for(let t of(this.mutationQueue.push(i),n))this.Jr=this.Jr.add(new ow(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return rc.resolve(i)}lookupMutationBatch(e,t){return rc.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.Xr(t+1),n=r<0?0:r;return rc.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return rc.resolve(0===this.mutationQueue.length?-1:this.Yn-1)}getAllMutationBatches(e){return rc.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new ow(t,0),n=new ow(t,1/0),s=[];return this.Jr.forEachInRange([r,n],e=>{let t=this.Zr(e.Hr);s.push(t)}),rc.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new nC(tB);return t.forEach(e=>{let t=new ow(e,0),n=new ow(e,1/0);this.Jr.forEachInRange([t,n],e=>{r=r.add(e.Hr)})}),rc.resolve(this.Yr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,s=r;tJ.isDocumentKey(s)||(s=s.child(""));let i=new ow(new tJ(s),0),a=new nC(tB);return this.Jr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Hr)),!0)},i),rc.resolve(this.Yr(a))}Yr(e){let t=[];return e.forEach(e=>{let r=this.Zr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){tC(0===this.ei(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Jr;return rc.forEach(t.mutations,n=>{let s=new ow(n.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Jr=r})}nr(e){}containsKey(e,t){let r=new ow(t,0),n=this.Jr.firstAfterOrEqual(r);return rc.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,rc.resolve()}ei(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class o_{constructor(e){this.ti=e,this.docs=new nT(tJ.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),s=n?n.size:0,i=this.ti(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return rc.resolve(r?r.document.mutableCopy():su.newInvalidDocument(t))}getEntries(e,t){let r=s1;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():su.newInvalidDocument(e))}),rc.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let s=s1,i=t.path,a=new tJ(i.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||0>=ri(rn(a),r)||(n.has(a.key)||sY(t,a))&&(s=s.insert(a.key,a.mutableCopy()))}return rc.resolve(s)}getAllFromCollectionGroup(e,t,r,n){tN(9500)}ni(e,t){return rc.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new oE(this)}getSize(e){return rc.resolve(this.size)}}class oE extends oc{constructor(e){super(),this.Mr=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Mr.addEntry(e,n)):this.Mr.removeEntry(r)}),rc.waitFor(t)}getFromCache(e,t){return this.Mr.getEntry(e,t)}getAllFromCache(e,t){return this.Mr.getEntries(e,t)}}class oT{constructor(e){this.persistence=e,this.ri=new s0(e=>sR(e),sP),this.lastRemoteSnapshotVersion=t4.min(),this.highestTargetId=0,this.ii=0,this.si=new ov,this.targetCount=0,this.oi=a9._r()}forEachTarget(e,t){return this.ri.forEach((e,r)=>t(r)),rc.resolve()}getLastRemoteSnapshotVersion(e){return rc.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return rc.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),rc.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.ii&&(this.ii=t),rc.resolve()}lr(e){this.ri.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.oi=new a9(t),this.highestTargetId=t),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,t){return this.lr(t),this.targetCount+=1,rc.resolve()}updateTargetData(e,t){return this.lr(t),rc.resolve()}removeTargetData(e,t){return this.ri.delete(t.target),this.si.Gr(t.targetId),this.targetCount-=1,rc.resolve()}removeTargets(e,t,r){let n=0,s=[];return this.ri.forEach((i,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.ri.delete(i),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),rc.waitFor(s).next(()=>n)}getTargetCount(e){return rc.resolve(this.targetCount)}getTargetData(e,t){let r=this.ri.get(t)||null;return rc.resolve(r)}addMatchingKeys(e,t,r){return this.si.$r(t,r),rc.resolve()}removeMatchingKeys(e,t,r){this.si.Qr(t,r);let n=this.persistence.referenceDelegate,s=[];return n&&t.forEach(t=>{s.push(n.markPotentiallyOrphaned(e,t))}),rc.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.si.Gr(t),rc.resolve()}getMatchingKeysForTargetId(e,t){let r=this.si.jr(t);return rc.resolve(r)}containsKey(e,t){return rc.resolve(this.si.containsKey(t))}}class oN{constructor(e,t){this._i={},this.overlays={},this.ai=new rE(0),this.ui=!1,this.ui=!0,this.ci=new ox,this.referenceDelegate=e(this),this.li=new oT(this),this.indexManager=new aJ,this.remoteDocumentCache=new o_(e=>this.referenceDelegate.hi(e)),this.serializer=new ay(t),this.Pi=new oy(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ob,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this._i[e.toKey()];return r||(r=new oI(t,this.referenceDelegate),this._i[e.toKey()]=r),r}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,t,r){tI("MemoryPersistence","Starting transaction:",e);let n=new oS(this.ai.next());return this.referenceDelegate.Ti(),r(n).next(e=>this.referenceDelegate.Ii(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ei(e,t){return rc.or(Object.values(this._i).map(r=>()=>r.containsKey(e,t)))}}class oS extends ro{constructor(e){super(),this.currentSequenceNumber=e}}class oC{constructor(e){this.persistence=e,this.Ri=new ov,this.Ai=null}static Vi(e){return new oC(e)}get di(){if(this.Ai)return this.Ai;throw tN(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.di.delete(r.toString()),rc.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.di.add(r.toString()),rc.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),rc.resolve()}removeTarget(e,t){this.Ri.Gr(t.targetId).forEach(e=>this.di.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ti(){this.Ai=new Set}Ii(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return rc.forEach(this.di,r=>{let n=tJ.fromPath(r);return this.mi(e,n).next(e=>{e||t.removeEntry(n,t4.min())})}).next(()=>(this.Ai=null,t.apply(e)))}updateLimboDocument(e,t){return this.mi(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}hi(e){return 0}mi(e,t){return rc.or([()=>rc.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class ok{constructor(e,t){this.persistence=e,this.fi=new s0(e=>rC(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new oa(this,t)}static Vi(e,t){return new ok(e,t)}Ti(){}Ii(e){return rc.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}pr(e){let t=0;return this.mr(e,e=>{t++}).next(()=>t)}mr(e,t){return rc.forEach(this.fi,(r,n)=>this.wr(e,r,n).next(e=>e?rc.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),s=n.newChangeBuffer();return n.ni(e,n=>this.wr(e,n,t).next(e=>{e||(r++,s.removeEntry(n,t4.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.fi.set(t,e.currentSequenceNumber),rc.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),rc.resolve()}removeReference(e,t,r){return this.fi.set(r,e.currentSequenceNumber),rc.resolve()}updateLimboDocument(e,t){return this.fi.set(t,e.currentSequenceNumber),rc.resolve()}hi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(n0(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=nz(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return nL(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let s;return n=t.mapValue,s=0,n_(n.fields,(t,r)=>{s+=t.length+e(r)}),s;default:throw tN(13486,{value:t})}}(e.data.value)),t}wr(e,t,r){return rc.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.fi.get(t);return rc.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class oA{constructor(e){this.serializer=e}k(e,t,r,n){let s=new rh("createOrUpgrade",t);r<1&&n>=1&&(e.createObjectStore(rj),e.createObjectStore(rR,{keyPath:"userId"}),e.createObjectStore(rP,{keyPath:rO,autoIncrement:!0}).createIndex(rM,rL,{unique:!0}),e.createObjectStore(rV),oj(e),e.createObjectStore(rA));let i=rc.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore(rY),e.deleteObjectStore(rW),e.deleteObjectStore(r2),oj(e)),i=i.next(()=>{let e,t;return e=s.store(r2),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:t4.min().toTimestamp(),targetCount:0},e.put(r1,t)})),r<4&&n>=4&&(0!==r&&(i=i.next(()=>s.store(rP).H().next(t=>{e.deleteObjectStore(rP),e.createObjectStore(rP,{keyPath:rO,autoIncrement:!0}).createIndex(rM,rL,{unique:!0});let r=s.store(rP),n=t.map(e=>r.put(e));return rc.waitFor(n)}))),i=i.next(()=>{e.createObjectStore(r4,{keyPath:"clientId"})})),r<5&&n>=5&&(i=i.next(()=>this.gi(s))),r<6&&n>=6&&(i=i.next(()=>(e.createObjectStore(rK),this.pi(s)))),r<7&&n>=7&&(i=i.next(()=>this.yi(s))),r<8&&n>=8&&(i=i.next(()=>this.wi(e,s))),r<9&&n>=9&&(i=i.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(i=i.next(()=>this.bi(s))),r<11&&n>=11&&(i=i.next(()=>{e.createObjectStore(r3,{keyPath:"bundleId"}),e.createObjectStore(r8,{keyPath:"name"})})),r<12&&n>=12&&(i=i.next(()=>{let t;(t=e.createObjectStore(nl,{keyPath:nc})).createIndex(nu,nh,{unique:!1}),t.createIndex(nd,nf,{unique:!1})})),r<13&&n>=13&&(i=i.next(()=>{let t;(t=e.createObjectStore(rU,{keyPath:rB})).createIndex(rq,rz),t.createIndex(r$,rG)}).next(()=>this.Si(e,s)).next(()=>e.deleteObjectStore(rA))),r<14&&n>=14&&(i=i.next(()=>this.Di(e,s))),r<15&&n>=15&&(i=i.next(()=>{e.createObjectStore(r7,{keyPath:"indexId",autoIncrement:!0}).createIndex(r9,"collectionGroup",{unique:!1}),e.createObjectStore(ne,{keyPath:nt}).createIndex(nr,nn,{unique:!1}),e.createObjectStore(ns,{keyPath:ni}).createIndex(na,no,{unique:!1})})),r<16&&n>=16&&(i=i.next(()=>{t.objectStore(ne).clear()}).next(()=>{t.objectStore(ns).clear()})),r<17&&n>=17&&(i=i.next(()=>{e.createObjectStore(np,{keyPath:"name"})})),r<18&&n>=18&&Y()&&(i=i.next(()=>{t.objectStore(ne).clear()}).next(()=>{t.objectStore(ns).clear()})),i}pi(e){let t=0;return e.store(rA).ee((e,r)=>{t+=a4(r)}).next(()=>{let r={byteSize:t};return e.store(rK).put(rH,r)})}gi(e){let t=e.store(rR),r=e.store(rP);return t.H().next(t=>rc.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.H(rM,n).next(r=>rc.forEach(r,r=>{tC(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=aI(this.serializer,r);return a6(e,t.userId,n).next(()=>{})}))}))}yi(e){let t=e.store(rY),r=e.store(rA);return e.store(r2).get(r1).next(e=>{let n=[];return r.ee((r,s)=>{let i=new tH(r),a=[0,rC(i)];n.push(t.get(a).next(r=>r?rc.resolve():t.put({targetId:0,path:rC(i),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>rc.waitFor(n))})}wi(e,t){e.createObjectStore(r5,{keyPath:r6});let r=t.store(r5),n=new aY,s=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:rC(n)})}};return t.store(rA).ee({Y:!0},(e,t)=>s(new tH(e).popLast())).next(()=>t.store(rV).ee({Y:!0},([e,t,r],n)=>s(rk(t).popLast())))}bi(e){let t=e.store(rW);return t.ee((e,r)=>{let n=a_(r),s=aE(this.serializer,n);return t.put(s)})}Si(e,t){let r=t.store(rA),n=[];return r.ee((e,r)=>{let s=t.store(rU),i=(r.document?new tJ(tH.fromString(r.document.name).popFirst(5)):r.noDocument?tJ.fromSegments(r.noDocument.path):r.unknownDocument?tJ.fromSegments(r.unknownDocument.path):tN(36783)).path.toArray(),a={prefixPath:i.slice(0,i.length-2),collectionGroup:i[i.length-2],documentId:i[i.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(s.put(a))}).next(()=>rc.waitFor(n))}Di(e,t){let r=t.store(rP),n=new ou(this.serializer),s=new oN(oC.Vi,this.serializer.yt);return r.H().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??s7();aI(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),rc.forEach(r,(e,r)=>{let i=new tb(r),a=aA.wt(this.serializer,i),o=s.getIndexManager(i);return new og(n,a3.wt(i,this.serializer,o,s.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new nv(t,rE.ce),e).next()})})}}function oj(e){e.createObjectStore(rY,{keyPath:rX}).createIndex(rZ,r0,{unique:!0}),e.createObjectStore(rW,{keyPath:"targetId"}).createIndex(rQ,rJ,{unique:!0}),e.createObjectStore(r2)}let oD="IndexedDbPersistence",oR="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class oP{constructor(e,t,r,n,s,i,a,o,l,c,u=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Ci=s,this.window=i,this.document=a,this.Fi=l,this.Mi=c,this.xi=u,this.ai=null,this.ui=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Oi=null,this.inForeground=!1,this.Ni=null,this.Bi=null,this.Li=-1/0,this.ki=e=>Promise.resolve(),!oP.v())throw new tA(tk.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new oo(this,n),this.Ki=t+"main",this.serializer=new ay(o),this.qi=new rd(this.Ki,this.xi,new oA(this.serializer)),this.ci=new aj,this.li=new oe(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new ou(this.serializer),this.Pi=new ak,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,!1===c&&t_(oD,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.$i().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new tA(tk.FAILED_PRECONDITION,oR);return this.Wi(),this.Qi(),this.Gi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.li.getHighestSequenceNumber(e))}).then(e=>{this.ai=new rE(e,this.Fi)}).then(()=>{this.ui=!0}).catch(e=>(this.qi&&this.qi.close(),Promise.reject(e)))}zi(e){return this.ki=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.qi.q(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ci.enqueueAndForget(async()=>{this.started&&await this.$i()}))}$i(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>nw(e,r4).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ji(e).next(e=>{e||(this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Ji(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(rg(e))return tI(oD,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return tI(oD,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Ci.enqueueRetryable(()=>this.ki(e)),this.isPrimary=e})}ji(e){return nw(e,rj).get(rD).next(e=>rc.resolve(this.Xi(e)))}Yi(e){return nw(e,r4).delete(this.clientId)}async es(){if(this.isPrimary&&!this.ts(this.Li,18e5)){this.Li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=nw(e,r4);return t.H().next(e=>{let r=this.ns(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return rc.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.rs(t.clientId))}}Gi(){this.Bi=this.Ci.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.$i().then(()=>this.es()).then(()=>this.Gi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.Mi?rc.resolve(!0):nw(e,rj).get(rD).next(t=>{if(null!==t&&this.ts(t.leaseTimestampMs,5e3)&&!this.ss(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new tA(tk.FAILED_PRECONDITION,oR);return!1}}return!(!this.networkEnabled||!this.inForeground)||nw(e,r4).H().next(e=>void 0===this.ns(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&tI(oD,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.ui=!1,this._s(),this.Bi&&(this.Bi.cancel(),this.Bi=null),this.us(),this.cs(),await this.qi.runTransaction("shutdown","readwrite",[rj,r4],e=>{let t=new nv(e,rE.ce);return this.Ji(t).next(()=>this.Yi(t))}),this.qi.close(),this.ls()}ns(e,t){return e.filter(e=>this.ts(e.updateTimeMs,t)&&!this.ss(e.clientId))}hs(){return this.runTransaction("getActiveClients","readonly",e=>nw(e,r4).H().next(e=>this.ns(e,18e5).map(e=>e.clientId)))}get started(){return this.ui}getGlobalsCache(){return this.ci}getMutationQueue(e,t){return a3.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new a0(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return aA.wt(this.serializer,e)}getBundleCache(){return this.Pi}runTransaction(e,t,r){var n;let s;tI(oD,"Starting transaction:",e);let i=18===(n=this.xi)||17===n?nx:16===n||15===n?nb:14===n||13===n?ny:12===n?ng:11===n?nm:void tN(60245);return this.qi.runTransaction(e,"readonly"===t?"readonly":"readwrite",i,n=>(s=new nv(n,this.ai?this.ai.next():rE.ce),"readwrite-primary"===t?this.ji(s).next(e=>!!e||this.Hi(s)).next(t=>{if(!t)throw t_(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ci.enqueueRetryable(()=>this.ki(!1)),new tA(tk.FAILED_PRECONDITION,ra);return r(s)}).next(e=>this.Zi(s).next(()=>e)):this.Ps(s).next(()=>r(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}Ps(e){return nw(e,rj).get(rD).next(e=>{if(null!==e&&this.ts(e.leaseTimestampMs,5e3)&&!this.ss(e.ownerId)&&!this.Xi(e)&&!(this.Mi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new tA(tk.FAILED_PRECONDITION,oR)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return nw(e,rj).put(rD,t)}static v(){return rd.v()}Ji(e){let t=nw(e,rj);return t.get(rD).next(e=>this.Xi(e)?(tI(oD,"Releasing primary lease."),t.delete(rD)):rc.resolve())}ts(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(t_(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=()=>{this.Ci.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.$i()))},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)}us(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)}Qi(){"function"==typeof this.window?.addEventListener&&(this.Oi=()=>{this._s();let e=/(?:Version|Mobile)\/1[456]/;J()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ci.enterRestrictedMode(!0),this.Ci.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Oi))}cs(){this.Oi&&(this.window.removeEventListener("pagehide",this.Oi),this.Oi=null)}ss(e){try{let t=null!==this.Ui?.getItem(this.rs(e));return tI(oD,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return t_(oD,"Failed to get zombied client id.",e),!1}}_s(){if(this.Ui)try{this.Ui.setItem(this.rs(this.clientId),String(Date.now()))}catch(e){t_("Failed to set zombie client id.",e)}}ls(){if(this.Ui)try{this.Ui.removeItem(this.rs(this.clientId))}catch(e){}}rs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function oO(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}class oM{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Ts=r,this.Is=n}static Es(e,t){let r=s7(),n=s7();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new oM(e,t.fromCache,r,n)}}class oL{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class oF{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=J()?8:rf(K())>0?6:4}initialize(e,t){this.fs=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,n){let s={result:null};return this.gs(e,t).next(e=>{s.result=e}).next(()=>{if(!s.result)return this.ps(e,t,n,r).next(e=>{s.result=e})}).next(()=>{if(s.result)return;let r=new oL;return this.ys(e,t,r).next(n=>{if(s.result=n,this.As)return this.ws(e,t,r,n.size)})}).next(()=>s.result)}ws(e,t,r,n){return r.documentReadCount<this.Vs?(tw()<=u.DEBUG&&tI("QueryEngine","SDK will not create cache indexes for query:",sJ(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),rc.resolve()):(tw()<=u.DEBUG&&tI("QueryEngine","Query:",sJ(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.ds*n?(tw()<=u.DEBUG&&tI("QueryEngine","The SDK decides to create cache indexes for query:",sJ(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,s$(t))):rc.resolve())}gs(e,t){if(sB(t))return rc.resolve(null);let r=s$(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=s$(t=sH(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let s=s7(...n);return this.fs.getDocuments(e,s).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let i=this.bs(t,n);return this.Ss(t,i,s,r.readTime)?this.gs(e,sH(t,null,"F")):this.Ds(e,i,t,r)}))})))}ps(e,t,r,n){return sB(t)||n.isEqual(t4.min())?rc.resolve(null):this.fs.getDocuments(e,r).next(s=>{let i=this.bs(t,s);return this.Ss(t,i,r,n)?rc.resolve(null):(tw()<=u.DEBUG&&tI("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),sJ(t)),this.Ds(e,i,t,rr(n,-1)).next(e=>e))})}bs(e,t){let r=new nC(sZ(e));return t.forEach((t,n)=>{sY(e,n)&&(r=r.add(n))}),r}Ss(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(n)>0)}ys(e,t,r){return tw()<=u.DEBUG&&tI("QueryEngine","Using full collection scan to execute query:",sJ(t)),this.fs.getDocumentsMatchingQuery(e,t,rs.min(),r)}Ds(e,t,r,n){return this.fs.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let oV="LocalStore";class oU{constructor(e,t,r,n){this.persistence=e,this.Cs=t,this.serializer=n,this.vs=new nT(tB),this.Fs=new s0(e=>sR(e),sP),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(r)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new og(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.vs))}}async function oB(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(s=>(n=s,e.Os(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let s=[],i=[],a=s7();for(let e of n)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Ns:e,removedBatchIds:s,addedBatchIds:i}))})})}function oq(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.li.getLastRemoteSnapshotVersion(t))}function oz(e,t,r){let n=s7(),s=s7();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=s1;return r.forEach((r,i)=>{let a=e.get(r);i.isFoundDocument()!==a.isFoundDocument()&&(s=s.add(r)),i.isNoDocument()&&i.version.isEqual(t4.min())?(t.removeEntry(r,i.readTime),n=n.insert(r,i)):!a.isValidDocument()||i.version.compareTo(a.version)>0||0===i.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(i),n=n.insert(r,i)):tI(oV,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",i.version)}),{Bs:n,Ls:s}})}function o$(e,t){return e.persistence.runTransaction("Allocate target","readwrite",r=>{let n;return e.li.getTargetData(r,t).next(s=>s?(n=s,rc.resolve(n)):e.li.allocateTargetId(r).next(s=>(n=new ag(t,s,"TargetPurposeListen",r.currentSequenceNumber),e.li.addTargetData(r,n).next(()=>n))))}).then(r=>{let n=e.vs.get(r.targetId);return(null===n||r.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(e.vs=e.vs.insert(r.targetId,r),e.Fs.set(t,r.targetId)),r})}async function oG(e,t,r){let n=e.vs.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!rg(e))throw e;tI(oV,`Failed to update sequence numbers for target ${t}: ${e}`)}e.vs=e.vs.remove(t),e.Fs.delete(n.target)}function oK(e,t,r){let n=t4.min(),s=s7();return e.persistence.runTransaction("Execute query","readwrite",i=>{var a;let o;return(a=s$(t),void 0!==(o=e.Fs.get(a))?rc.resolve(e.vs.get(o)):e.li.getTargetData(i,a)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.li.getMatchingKeysForTargetId(i,t.targetId).next(e=>{s=e})}).next(()=>e.Cs.getDocumentsMatchingQuery(i,t,r?n:t4.min(),r?s:s7())).next(r=>(oQ(e,sX(t),r),{documents:r,ks:s}))})}function oH(e,t){let r=e.li,n=e.vs.get(t);return n?Promise.resolve(n.target):e.persistence.runTransaction("Get target data","readonly",e=>r.At(e,t).next(e=>e?e.target:null))}function oW(e,t){let r=e.Ms.get(t)||t4.min();return e.persistence.runTransaction("Get new document changes","readonly",n=>e.xs.getAllFromCollectionGroup(n,t,rr(r,-1),Number.MAX_SAFE_INTEGER)).then(r=>(oQ(e,t,r),r))}function oQ(e,t,r){let n=e.Ms.get(t)||t4.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.Ms.set(t,n)}async function oJ(e,t,r,n){let s=s7(),i=s1;for(let e of r){let r=t.Ks(e.metadata.name);e.document&&(s=s.add(r));let n=t.qs(e);n.setReadTime(t.Us(e.metadata.readTime)),i=i.insert(r,n)}let a=e.xs.newChangeBuffer({trackRemovals:!0}),o=await o$(e,s$(sU(tH.fromString(`__bundle__/docs/${n}`))));return e.persistence.runTransaction("Apply bundle documents","readwrite",t=>oz(t,a,i).next(e=>(a.apply(t),e)).next(r=>e.li.removeMatchingKeysForTargetId(t,o.targetId).next(()=>e.li.addMatchingKeys(t,s,o.targetId)).next(()=>e.localDocuments.getLocalViewOfDocuments(t,r.Bs,r.Ls)).next(()=>r.Bs)))}async function oY(e,t,r=s7()){let n=await o$(e,s$(aT(t.bundledQuery)));return e.persistence.runTransaction("Save named query","readwrite",s=>{let i=i4(t.readTime);if(n.snapshotVersion.compareTo(i)>=0)return e.Pi.saveNamedQuery(s,t);let a=n.withResumeToken(nR.EMPTY_BYTE_STRING,i);return e.vs=e.vs.insert(a.targetId,a),e.li.updateTargetData(s,a).next(()=>e.li.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>e.li.addMatchingKeys(s,r,n.targetId)).next(()=>e.Pi.saveNamedQuery(s,t))})}let oX="firestore_clients";function oZ(e,t){return`${oX}_${e}_${t}`}let o0="firestore_mutations";function o1(e,t,r){let n=`${o0}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let o2="firestore_targets";function o5(e,t){return`${o2}_${e}_${t}`}let o6="SharedClientState";class o4{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static $s(e,t,r){let n=JSON.parse(r),s,i="object"==typeof n&&-1!==["pending","acknowledged","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(s=new tA(n.error.code,n.error.message)),i?new o4(e,t,n.state,s):(t_(o6,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class o3{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static $s(e,t){let r=JSON.parse(t),n,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new tA(r.error.code,r.error.message)),s?new o3(e,r.state,n):(t_(o6,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class o8{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,s=s9;for(let e=0;n&&e<r.activeTargetIds.length;++e)n=rS(r.activeTargetIds[e]),s=s.add(r.activeTargetIds[e]);return n?new o8(e,s):(t_(o6,`Failed to parse client data for instance '${e}': ${t}`),null)}}class o7{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new o7(t.clientId,t.onlineState):(t_(o6,`Failed to parse online state: ${e}`),null)}}class o9{constructor(){this.activeTargetIds=s9}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class le{constructor(e,t,r,n,s){var i,a,o;this.window=e,this.Ci=t,this.persistenceKey=r,this.zs=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.js=this.Hs.bind(this),this.Js=new nT(tB),this.started=!1,this.Zs=[];const l=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Xs=oZ(this.persistenceKey,this.zs),this.Ys=(i=this.persistenceKey,`firestore_sequence_number_${i}`),this.Js=this.Js.insert(this.zs,new o9),this.eo=RegExp(`^${oX}_${l}_([^_]*)$`),this.no=RegExp(`^${o0}_${l}_(\\d+)(?:_(.*))?$`),this.ro=RegExp(`^${o2}_${l}_(\\d+)$`),this.io=(a=this.persistenceKey,`firestore_online_state_${a}`),this.so=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this.js)}static v(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.hs())){if(e===this.zs)continue;let t=this.getItem(oZ(this.persistenceKey,e));if(t){let r=o8.$s(e,t);r&&(this.Js=this.Js.insert(r.clientId,r))}}this.oo();let e=this.storage.getItem(this.io);if(e){let t=this._o(e);t&&this.ao(t)}for(let e of this.Zs)this.Hs(e);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ys,JSON.stringify(e))}getAllActiveQueryTargets(){return this.uo(this.Js)}isActiveQueryTarget(e){let t=!1;return this.Js.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.co(e,"pending")}updateMutationState(e,t,r){this.co(e,t,r),this.lo(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(o5(this.persistenceKey,e));if(t){let n=o3.$s(e,t);n&&(r=n.state)}}return t&&this.ho.Qs(e),this.oo(),r}removeLocalQueryTarget(e){this.ho.Gs(e),this.oo()}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(o5(this.persistenceKey,e))}updateQueryState(e,t,r){this.Po(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.lo(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.To(e)}notifyBundleLoaded(e){this.Io(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return tI(o6,"READ",e,t),t}setItem(e,t){tI(o6,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){tI(o6,"REMOVE",e),this.storage.removeItem(e)}Hs(e){if(e.storageArea===this.storage){if(tI(o6,"EVENT",e.key,e.newValue),e.key===this.Xs)return void t_("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ci.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.eo.test(e.key)){if(null==e.newValue){let t=this.Eo(e.key);return this.Ro(t,null)}{let t=this.Ao(e.key,e.newValue);if(t)return this.Ro(t.clientId,t)}}else if(this.no.test(e.key)){if(null!==e.newValue){let t=this.Vo(e.key,e.newValue);if(t)return this.mo(t)}}else if(this.ro.test(e.key)){if(null!==e.newValue){let t=this.fo(e.key,e.newValue);if(t)return this.po(t)}}else if(e.key===this.io){if(null!==e.newValue){let t=this._o(e.newValue);if(t)return this.ao(t)}}else if(e.key===this.Ys){let t=function(e){let t=rE.ce;if(null!=e)try{let r=JSON.parse(e);tC("number"==typeof r,30636,{yo:e}),t=r}catch(e){t_(o6,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==rE.ce&&this.sequenceNumberHandler(t)}else if(e.key===this.so){let t=this.wo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.bo(e)))}}}else this.Zs.push(e)})}}get ho(){return this.Js.get(this.zs)}oo(){this.setItem(this.Xs,this.ho.Ws())}co(e,t,r){let n=new o4(this.currentUser,e,t,r),s=o1(this.persistenceKey,this.currentUser,e);this.setItem(s,n.Ws())}lo(e){let t=o1(this.persistenceKey,this.currentUser,e);this.removeItem(t)}To(e){let t={clientId:this.zs,onlineState:e};this.storage.setItem(this.io,JSON.stringify(t))}Po(e,t,r){let n=o5(this.persistenceKey,e),s=new o3(e,t,r);this.setItem(n,s.Ws())}Io(e){let t=JSON.stringify(Array.from(e));this.setItem(this.so,t)}Eo(e){let t=this.eo.exec(e);return t?t[1]:null}Ao(e,t){let r=this.Eo(e);return o8.$s(r,t)}Vo(e,t){let r=this.no.exec(e),n=Number(r[1]),s=void 0!==r[2]?r[2]:null;return o4.$s(new tb(s),n,t)}fo(e,t){let r=Number(this.ro.exec(e)[1]);return o3.$s(r,t)}_o(e){return o7.$s(e)}wo(e){return JSON.parse(e)}async mo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.So(e.batchId,e.state,e.error);tI(o6,`Ignoring mutation for non-active user ${e.user.uid}`)}po(e){return this.syncEngine.Do(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Js.insert(e,t):this.Js.remove(e),n=this.uo(this.Js),s=this.uo(r),i=[],a=[];return s.forEach(e=>{n.has(e)||i.push(e)}),n.forEach(e=>{s.has(e)||a.push(e)}),this.syncEngine.Co(i,a).then(()=>{this.Js=r})}ao(e){this.Js.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}uo(e){let t=s9;return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class lt{constructor(){this.vo=new o9,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,t,r){this.Fo[e]=t}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new o9,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class lr{Mo(e){}shutdown(){}}let ln="ConnectivityMonitor";class ls{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){for(let e of(tI(ln,"Network connectivity changed: AVAILABLE"),this.Lo))e(0)}Bo(){for(let e of(tI(ln,"Network connectivity changed: UNAVAILABLE"),this.Lo))e(1)}static v(){return"u">typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let li=null;function la(){return null===li?li=0x10000000+Math.round(0x80000000*Math.random()):li++,"0x"+li.toString(16)}let lo="RestConnection",ll={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class lc{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.qo=t+"://"+e.host,this.Uo=`projects/${r}/databases/${n}`,this.$o=this.databaseId.database===nK?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Wo(e,t,r,n,s){let i=la(),a=this.Qo(e,t.toUriEncodedString());tI(lo,`Sending RPC '${e}' ${i}:`,a,r);let o={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(o,n,s);let{host:l}=new URL(a),c=B(l);return this.zo(e,a,o,r,c).then(t=>(tI(lo,`Received RPC '${e}' ${i}: `,t),t),t=>{throw tE(lo,`RPC '${e}' ${i} failed with error: `,t,"url: ",a,"request:",r),t})}jo(e,t,r,n,s,i){return this.Wo(e,t,r,n,s)}Go(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+tx,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}Qo(e,t){let r=ll[e],n=`${this.qo}/v1/${t}:${r}`;return this.databaseInfo.apiKey&&(n=`${n}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),n}terminate(){}}class lu{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}let lh="WebChannelConnection",ld=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};class lf extends lc{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){lf.c_||(ld(x(),b.STAT_EVENT,e=>{e.stat===y.PROXY?tI(lh,"STAT_EVENT: detected buffering proxy"):e.stat===y.NOPROXY&&tI(lh,"STAT_EVENT: detected no buffering proxy")}),lf.c_=!0)}zo(e,t,r,n,s){let i=la();return new Promise((s,a)=>{let o=new f;o.setWithCredentials(!0),o.listenOnce(m.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case g.NO_ERROR:let t=o.getResponseJson();tI(lh,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case g.TIMEOUT:tI(lh,`RPC '${e}' ${i} timed out`),a(new tA(tk.DEADLINE_EXCEEDED,"Request time out"));break;case g.HTTP_ERROR:let r=o.getStatus();if(tI(lh,`RPC '${e}' ${i} failed with status:`,r,"response text:",o.getResponseText()),r>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,r=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(tk).indexOf(e)>=0?e:tk.UNKNOWN);a(new tA(r,t.message))}else a(new tA(tk.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new tA(tk.UNAVAILABLE,"Connection failed."));break;default:tN(9055,{l_:e,streamId:i,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{tI(lh,`RPC '${e}' ${i} completed.`)}});let l=JSON.stringify(n);tI(lh,`RPC '${e}' ${i} sending request:`,n),o.send(t,"POST",l,r,15)})}T_(e,t,r){let n=la(),s=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=this.createWebChannelTransport(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},o=this.longPollingOptions.timeoutSeconds;void 0!==o&&(a.longPollingTimeout=Math.round(1e3*o)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Go(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;let l=s.join("");tI(lh,`Creating RPC '${e}' stream ${n}: ${l}`,a);let c=i.createWebChannel(l,a);this.I_(c);let u=!1,h=!1,d=new lu({Ho:t=>{h?tI(lh,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(u||(tI(lh,`Opening RPC '${e}' stream ${n} transport.`),c.open(),u=!0),tI(lh,`RPC '${e}' stream ${n} sending:`,t),c.send(t))},Jo:()=>c.close()});return ld(c,p.EventType.OPEN,()=>{h||(tI(lh,`RPC '${e}' stream ${n} transport opened.`),d.i_())}),ld(c,p.EventType.CLOSE,()=>{h||(h=!0,tI(lh,`RPC '${e}' stream ${n} transport closed`),d.o_(),this.E_(c))}),ld(c,p.EventType.ERROR,t=>{h||(h=!0,tE(lh,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),d.o_(new tA(tk.UNAVAILABLE,"The operation could not be completed")))}),ld(c,p.EventType.MESSAGE,t=>{if(!h){let r=t.data[0];tC(!!r,16349);let s=r?.error||r[0]?.error;if(s){tI(lh,`RPC '${e}' stream ${n} received error:`,s);let t=s.status,r=function(e){let t=w[e];if(void 0!==t)return iO(t)}(t),i=s.message;void 0===r&&(r=tk.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),h=!0,d.o_(new tA(r,i)),c.close()}else tI(lh,`RPC '${e}' stream ${n} received:`,r),d.__(r)}}),lf.u_(),setTimeout(()=>{d.s_()},0),d}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(t=>t===e)}Go(e,t,r){super.Go(e,t,r),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return v()}}function lp(){return"u">typeof window?window:null}function lm(){return"u">typeof document?document:null}function lg(e){return new i1(e,!0)}lf.c_=!1;class ly{constructor(e,t,r=1e3,n=1.5,s=6e4){this.Ci=e,this.timerId=t,this.R_=r,this.A_=n,this.V_=s,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();let t=Math.floor(this.d_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);n>0&&tI("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.d_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}let lb="PersistentStream";class lx{constructor(e,t,r,n,s,i,a,o){this.Ci=e,this.b_=r,this.S_=n,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ly(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===tk.RESOURCE_EXHAUSTED?(t_(t.toString()),t_("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===tk.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(t)}W_(){}auth(){this.state=1;let e=this.Q_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.D_===t&&this.G_(e,r)},t=>{e(()=>{let e=new tA(tk.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.Q_(this.D_);this.stream=this.j_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.Yo(()=>{r(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.H_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return tI(lb,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return t=>{this.Ci.enqueueAndForget(()=>this.D_===e?t():(tI(lb,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class lv extends lx{constructor(e,t,r,n,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,i),this.serializer=s}j_(e,t){return this.connection.T_("Listen",e,t)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,s;t.targetChange;let i="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:tN(39313,{state:n}),a=t.targetChange.targetIds||[],o=(s=t.targetChange.resumeToken,e.useProto3Json?(tC(void 0===s||"string"==typeof s,58123),nR.fromBase64String(s||"")):(tC(void 0===s||s instanceof tf.Buffer||s instanceof Uint8Array,16193),nR.fromUint8Array(s||new Uint8Array))),l=t.targetChange.cause;r=new iH(i,a,o,l&&new tA(void 0===l.code?tk.UNKNOWN:iO(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let s=ae(e,n.document.name),i=i4(n.document.updateTime),a=n.document.createTime?i4(n.document.createTime):t4.min(),o=new sc({mapValue:{fields:n.document.fields}}),l=su.newFoundDocument(s,i,a,o);r=new iG(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let s=ae(e,n.document),i=n.readTime?i4(n.readTime):t4.min(),a=su.newNoDocument(s,i);r=new iG([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let s=ae(e,n.document);r=new iG([],n.removedTargetIds||[],s,null)}else{if(!("filter"in t))return tN(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:s}=e,i=new iR(n,s);r=new iK(e.targetId,i)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return t4.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?t4.min():t.readTime?i4(t.readTime):t4.min()}(e);return this.listener.J_(t,r)}Z_(e){let t,r={};r.database=an(this.serializer),r.addTarget=function(e,t){let r,n=t.target;if((r=sO(n)?{documents:ac(e,n)}:{query:au(e,n).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=i6(e,t.resumeToken);let n=i2(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(t4.min())>0){r.readTime=i5(e,t.snapshotVersion.toTimestamp());let n=i2(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let n=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return tN(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});n&&(r.labels=n),this.K_(r)}X_(e){let t={};t.database=an(this.serializer),t.removeTarget=e,this.K_(t)}}class lw extends lx{constructor(e,t,r,n,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,i),this.serializer=s}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}H_(e){return tC(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,tC(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,r;tC(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(tC(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?i4(e.updateTime):i4(r)).isEqual(t4.min())&&(t=i4(r)),new im(t,e.transformResults||[])})):[]),s=i4(e.commitTime);return this.listener.na(s,n)}ra(){let e={};e.database=an(this.serializer),this.K_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>ao(this.serializer,e))};this.K_(t)}}class lI{}class l_ extends lI{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new tA(tk.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.connection.Wo(e,i8(t,r),n,s,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tk.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tA(tk.UNKNOWN,e.toString())})}jo(e,t,r,n,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.jo(e,i8(t,r),n,i,a,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===tk.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new tA(tk.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class lE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(t_(t),this.aa=!1):tI("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let lT="RemoteStore";class lN{constructor(e,t,r,n,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=s,this.Aa.Mo(e=>{r.enqueueAndForget(async()=>{lO(this)&&(tI(lT,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await lC(e),e.Va.set("Unknown"),e.Ea.delete(4),await lS(e)}(this))})}),this.Va=new lE(r,n)}}async function lS(e){if(lO(e))for(let t of e.Ra)await t(!0)}async function lC(e){for(let t of e.Ra)await t(!1)}function lk(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),lP(e)?lR(e):lY(e).O_()&&lj(e,t))}function lA(e,t){let r=lY(e);e.Ia.delete(t),r.O_()&&lD(e,t),0===e.Ia.size&&(r.O_()?r.L_():lO(e)&&e.Va.set("Unknown"))}function lj(e,t){if(e.da.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(t4.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}lY(e).Z_(t)}function lD(e,t){e.da.$e(t),lY(e).X_(t)}function lR(e){e.da=new iQ({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),lY(e).start(),e.Va.ua()}function lP(e){return lO(e)&&!lY(e).x_()&&e.Ia.size>0}function lO(e){return 0===e.Ea.size}async function lM(e){e.Va.set("Online")}async function lL(e){e.Ia.forEach((t,r)=>{lj(e,t)})}async function lF(e,t){e.da=void 0,lP(e)?(e.Va.ha(t),lR(e)):e.Va.set("Unknown")}async function lV(e,t,r){if(e.Va.set("Online"),t instanceof iH&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ia.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ia.delete(n),e.da.removeTarget(n))}(e,t)}catch(r){tI(lT,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await lU(e,r)}else if(t instanceof iG?e.da.Xe(t):t instanceof iK?e.da.st(t):e.da.tt(t),!r.isEqual(t4.min()))try{let t,n=await oq(e.localStore);r.compareTo(n)>=0&&await ((t=e.da.Tt(r)).targetChanges.forEach((t,n)=>{if(t.resumeToken.approximateByteSize()>0){let s=e.Ia.get(n);s&&e.Ia.set(n,s.withResumeToken(t.resumeToken,r))}}),t.targetMismatches.forEach((t,r)=>{let n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(nR.EMPTY_BYTE_STRING,n.snapshotVersion)),lD(e,t);let s=new ag(n.target,t,r,n.sequenceNumber);lj(e,s)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){tI(lT,"Failed to raise snapshot:",t),await lU(e,t)}}async function lU(e,t,r){if(!rg(t))throw t;e.Ea.add(1),await lC(e),e.Va.set("Offline"),r||(r=()=>oq(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{tI(lT,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await lS(e)})}function lB(e,t){return t().catch(r=>lU(e,r,t))}async function lq(e){var t;let r=lX(e),n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;lO(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Ta.length&&r.L_();break}n=t.batchId,function(e,t){e.Ta.push(t);let r=lX(e);r.O_()&&r.Y_&&r.ea(t.mutations)}(e,t)}catch(t){await lU(e,t)}lz(e)&&l$(e)}function lz(e){return lO(e)&&!lX(e).x_()&&e.Ta.length>0}function l$(e){lX(e).start()}async function lG(e){lX(e).ra()}async function lK(e){let t=lX(e);for(let r of e.Ta)t.ea(r.mutations)}async function lH(e,t,r){let n=e.Ta.shift(),s=iA.from(n,t,r);await lB(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),await lq(e)}async function lW(e,t){t&&lX(e).Y_&&await async function(e,t){var r;if(iP(r=t.code)&&r!==tk.ABORTED){let r=e.Ta.shift();lX(e).B_(),await lB(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await lq(e)}}(e,t),lz(e)&&l$(e)}async function lQ(e,t){e.asyncQueue.verifyOperationInProgress(),tI(lT,"RemoteStore received new credentials");let r=lO(e);e.Ea.add(3),await lC(e),r&&e.Va.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await lS(e)}async function lJ(e,t){t?(e.Ea.delete(2),await lS(e)):t||(e.Ea.add(2),await lC(e),e.Va.set("Unknown"))}function lY(e){var t,r,n;return e.ma||(t=e.datastore,r=e.asyncQueue,n={Zo:lM.bind(null,e),Yo:lL.bind(null,e),t_:lF.bind(null,e),J_:lV.bind(null,e)},t.sa(),e.ma=new lv(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.ma.B_(),lP(e)?lR(e):e.Va.set("Unknown")):(await e.ma.stop(),e.da=void 0)})),e.ma}function lX(e){var t,r,n;return e.fa||(t=e.datastore,r=e.asyncQueue,n={Zo:()=>Promise.resolve(),Yo:lG.bind(null,e),t_:lW.bind(null,e),ta:lK.bind(null,e),na:lH.bind(null,e)},t.sa(),e.fa=new lw(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.Ra.push(async t=>{t?(e.fa.B_(),await lq(e)):(await e.fa.stop(),e.Ta.length>0&&(tI(lT,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class lZ{constructor(e,t,r,n,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=s,this.deferred=new tj,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,s){let i=new lZ(e,t,Date.now()+r,n,s);return i.start(r),i}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new tA(tk.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function l0(e,t){if(t_("AsyncQueue",`${t}: ${e}`),rg(e))return new tA(tk.UNAVAILABLE,`${t}: ${e}`);throw e}class l1{static emptySet(e){return new l1(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||tJ.comparator(t.key,r.key):(e,t)=>tJ.comparator(e.key,t.key),this.keyedMap=s5(),this.sortedSet=new nT(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof l1)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new l1;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class l2{constructor(){this.ga=new nT(tJ.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):tN(63341,{Vt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class l5{constructor(e,t,r,n,s,i,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,s){let i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new l5(e,t,l1.emptySet(t),i,r,n,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&sW(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class l6{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class l4{constructor(){this.queries=l3(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new tA(tk.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=l3(),t.forEach((t,r)=>{for(let t of r.ba)t.onError(e)})}}function l3(){return new s0(e=>sQ(e),sW)}async function l8(e,t){let r=3,n=t.query,s=e.queries.get(n);s?!s.Sa()&&t.Da()&&(r=2):(s=new l6,r=+!t.Da());try{switch(r){case 0:s.wa=await e.onListen(n,!0);break;case 1:s.wa=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=l0(r,`Initialization of query '${sJ(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,s),s.ba.push(t),t.va(e.onlineState),s.wa&&t.Fa(s.wa)&&ct(e)}async function l7(e,t){let r=t.query,n=3,s=e.queries.get(r);if(s){let e=s.ba.indexOf(t);e>=0&&(s.ba.splice(e,1),0===s.ba.length?n=+!t.Da():!s.Sa()&&t.Da()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function l9(e,t){let r=!1;for(let n of t){let t=n.query,s=e.queries.get(t);if(s){for(let e of s.ba)e.Fa(n)&&(r=!0);s.wa=n}}r&&ct(e)}function ce(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.ba)e.onError(r);e.queries.delete(t)}function ct(e){e.Ca.forEach(e=>{e.next()})}(E=_||(_={})).Ma="default",E.Cache="cache";class cr{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new l5(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.Ka||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=l5.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==_.Cache}}class cn{constructor(e,t){this.qa=e,this.byteLength=t}Ua(){return"metadata"in this.qa}}class cs{constructor(e){this.serializer=e}Ks(e){return ae(this.serializer,e)}qs(e){return e.metadata.exists?aa(this.serializer,e.document,!1):su.newNoDocument(this.Ks(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return i4(e)}}class ci{constructor(e,t){this.$a=e,this.serializer=t,this.Wa=[],this.Qa=[],this.collectionGroups=new Set,this.progress=ca(e)}get queries(){return this.Wa}get documents(){return this.Qa}Ga(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Wa.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Qa.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=tH.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Qa[this.Qa.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}za(e){let t=new Map,r=new cs(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.Ks(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||s7()).add(e);t.set(r,n)}}return t}async ja(e){let t=await oJ(e,new cs(this.serializer),this.Qa,this.$a.id),r=this.za(this.documents);for(let t of this.Wa)await oY(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,Ha:this.collectionGroups,Ja:t}}}function ca(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class co{constructor(e){this.key=e}}class cl{constructor(e){this.key=e}}class cc{constructor(e,t){this.query=e,this.Za=t,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=s7(),this.mutatedKeys=s7(),this.eu=sZ(e),this.tu=new l1(this.eu)}get nu(){return this.Za}ru(e,t){let r=t?t.iu:new l2,n=t?t.tu:this.tu,s=t?t.mutatedKeys:this.mutatedKeys,i=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let c=n.get(e),u=sY(this.query,t)?t:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;c&&u?c.data.isEqual(u.data)?h!==d&&(r.track({type:3,doc:u}),f=!0):this.su(c,u)||(r.track({type:2,doc:u}),f=!0,(o&&this.eu(u,o)>0||l&&0>this.eu(u,l))&&(a=!0)):!c&&u?(r.track({type:0,doc:u}),f=!0):c&&!u&&(r.track({type:1,doc:c}),f=!0,(o||l)&&(a=!0)),f&&(u?(i=i.add(u),s=d?s.add(e):s.delete(e)):(i=i.delete(e),s=s.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){let e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),s=s.delete(e.key),r.track({type:1,doc:e})}return{tu:i,iu:r,Ss:a,mutatedKeys:s}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let i=e.iu.ya();i.sort((e,t)=>{var r,n;let s;return r=e.type,n=t.type,(s=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return tN(20277,{Vt:e})}})(r)-s(n)||this.eu(e.doc,t.doc)}),this.ou(r),n=n??!1;let a=t&&!n?this._u():[],o=0===this.Ya.size&&this.current&&!n?1:0,l=o!==this.Xa;return(this.Xa=o,0!==i.length||l)?{snapshot:new l5(this.query,e.tu,s,i,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new l2,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Za=this.Za.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Za=this.Za.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Ya;this.Ya=s7(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Ya=this.Ya.add(e.key))});let t=[];return e.forEach(e=>{this.Ya.has(e)||t.push(new cl(e))}),this.Ya.forEach(r=>{e.has(r)||t.push(new co(r))}),t}cu(e){this.Za=e.ks,this.Ya=s7();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return l5.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Xa,this.hasCachedResults)}}let cu="SyncEngine";class ch{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class cd{constructor(e){this.key=e,this.hu=!1}}class cf{constructor(e,t,r,n,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new s0(e=>sQ(e),sW),this.Iu=new Map,this.Eu=new Set,this.Ru=new nT(tJ.comparator),this.Au=new Map,this.Vu=new ov,this.du={},this.mu=new Map,this.fu=a9.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function cp(e,t,r=!0){let n,s=c$(e),i=s.Tu.get(t);return i?(s.sharedClientState.addLocalQueryTarget(i.targetId),n=i.view.lu()):n=await cg(s,t,r,!0),n}async function cm(e,t){let r=c$(e);await cg(r,t,!0,!1)}async function cg(e,t,r,n){let s,i=await o$(e.localStore,s$(t)),a=i.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(s=await cy(e,t,a,"current"===o,i.resumeToken)),e.isPrimaryClient&&r&&lk(e.remoteStore,i),s}async function cy(e,t,r,n,s){e.pu=(t,r,n)=>(async function(e,t,r,n){let s=t.view.ru(r);s.Ss&&(s=await oK(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,s)));let i=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(s,e.isPrimaryClient,i,a);return cA(e,t.targetId,o.au),o.snapshot})(e,t,r,n);let i=await oK(e.localStore,t,!0),a=new cc(t,i.ks),o=a.ru(i.documents),l=i$.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,s),c=a.applyChanges(o,e.isPrimaryClient,l);cA(e,r,c.au);let u=new ch(t,r,a);return e.Tu.set(t,u),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),c.snapshot}async function cb(e,t,r){let n=e.Tu.get(t),s=e.Iu.get(n.targetId);s.length>1?(e.Iu.set(n.targetId,s.filter(e=>!sW(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await oG(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&lA(e.remoteStore,n.targetId),cC(e,n.targetId)}).catch(rl)):(cC(e,n.targetId),await oG(e.localStore,n.targetId,!0))}async function cx(e,t){let r=e.Tu.get(t),n=e.Iu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),lA(e.remoteStore,r.targetId))}async function cv(e,t,r){let n=cG(e);try{var s,i;let e,a,o,l,c,u=await (s=n.localStore,o=t6.now(),l=t.reduce((e,t)=>e.add(t.key),s7()),s.persistence.runTransaction("Locally write mutations","readwrite",r=>{let n=s1,i=s7();return s.xs.getEntries(r,l).next(e=>{(n=e).forEach((e,t)=>{t.isValidDocument()||(i=i.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(r,n)).next(n=>{e=n;let i=[];for(let r of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),s=is(n.transform,e||null);null!=s&&(null===r&&(r=sc.empty()),r.set(n.field,s))}return r||null}(r,e.get(r.key).overlayedDocument);null!=t&&i.push(new i_(r.key,t,function e(t){let r=[];return n_(t.fields,(t,n)=>{let s=new tQ([t]);if(sr(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(s);else for(let e of t)r.push(s.child(e))}else r.push(s)}),new nj(r)}(t.value.mapValue),ig.exists(!0)))}return s.mutationQueue.addMutationBatch(r,o,i,t)}).next(t=>{a=t;let n=t.applyToLocalDocumentSet(e,i);return s.documentOverlayCache.saveOverlays(r,t.batchId,n)})}).then(()=>({batchId:a.batchId,changes:s6(e)})));n.sharedClientState.addPendingMutation(u.batchId),i=u.batchId,(c=n.du[n.currentUser.toKey()])||(c=new nT(tB)),c=c.insert(i,r),n.du[n.currentUser.toKey()]=c,await cD(n,u.changes),await lq(n.remoteStore)}catch(t){let e=l0(t,"Failed to persist write");r.reject(e)}}async function cw(e,t){var r;try{let n,s,i=await (r=e.localStore,n=t.snapshotVersion,s=r.vs,r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let i=r.xs.newChangeBuffer({trackRemovals:!0});s=r.vs;let a=[];t.targetChanges.forEach((i,o)=>{var l;let c=s.get(o);if(!c)return;a.push(r.li.removeMatchingKeys(e,i.removedDocuments,o).next(()=>r.li.addMatchingKeys(e,i.addedDocuments,o)));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?u=u.withResumeToken(nR.EMPTY_BYTE_STRING,t4.min()).withLastLimboFreeSnapshotVersion(t4.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,n)),s=s.insert(o,u),l=u,(0===c.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-c.snapshotVersion.toMicroseconds()>=3e8||i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size>0)&&a.push(r.li.updateTargetData(e,u))});let o=s1,l=s7();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(oz(e,i,t.documentUpdates).next(e=>{o=e.Bs,l=e.Ls})),!n.isEqual(t4.min())){let t=r.li.getLastRemoteSnapshotVersion(e).next(t=>r.li.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return rc.waitFor(a).next(()=>i.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.vs=s,e)));t.targetChanges.forEach((t,r)=>{let n=e.Au.get(r);n&&(tC(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.hu=!0:t.modifiedDocuments.size>0?tC(n.hu,14607):t.removedDocuments.size>0&&(tC(n.hu,42227),n.hu=!1))}),await cD(e,i,t)}catch(e){await rl(e)}}function cI(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,s=[];e.Tu.forEach((e,r)=>{let n=r.view.va(t);n.snapshot&&s.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.ba)e.va(t)&&(r=!0)}),r&&ct(n),s.length&&e.Pu.J_(s),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function c_(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Au.get(t),s=n&&n.key;if(s){let r=new nT(tJ.comparator);r=r.insert(s,su.newNoDocument(s,t4.min()));let n=s7().add(s),i=new iz(t4.min(),new Map,new nT(tB),r,n);await cw(e,i),e.Ru=e.Ru.remove(s),e.Au.delete(t),cj(e)}else await oG(e.localStore,t,!1).then(()=>cC(e,t,r)).catch(rl)}async function cE(e,t){var r;let n=t.batch.batchId;try{let s=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n,s,i,a=t.batch.keys(),o=r.xs.newChangeBuffer({trackRemovals:!0});return(s=(n=t.batch).keys(),i=rc.resolve(),s.forEach(r=>{i=i.next(()=>o.getEntry(e,r)).next(e=>{let s=t.docVersions.get(r);tC(null!==s,48541),0>e.version.compareTo(s)&&(n.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),i.next(()=>r.mutationQueue.removeMutationBatch(e,n))).next(()=>o.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=s7();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,a))}));cS(e,n,null),cN(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await cD(e,s)}catch(e){await rl(e)}}async function cT(e,t,r){var n;try{let s=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(tC(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));cS(e,t,r),cN(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await cD(e,s)}catch(e){await rl(e)}}function cN(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function cS(e,t,r){let n=e.du[e.currentUser.toKey()];if(n){let s=n.get(t);s&&(r?s.reject(r):s.resolve(),n=n.remove(t)),e.du[e.currentUser.toKey()]=n}}function cC(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(n),r&&e.Pu.yu(n,r);e.Iu.delete(t),e.isPrimaryClient&&e.Vu.Gr(t).forEach(t=>{e.Vu.containsKey(t)||ck(e,t)})}function ck(e,t){e.Eu.delete(t.path.canonicalString());let r=e.Ru.get(t);null!==r&&(lA(e.remoteStore,r),e.Ru=e.Ru.remove(t),e.Au.delete(r),cj(e))}function cA(e,t,r){for(let n of r)n instanceof co?(e.Vu.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.Ru.get(r)||e.Eu.has(n)||(tI(cu,"New document in limbo: "+r),e.Eu.add(n),cj(e))}(e,n)):n instanceof cl?(tI(cu,"Document no longer in limbo: "+n.key),e.Vu.removeReference(n.key,t),e.Vu.containsKey(n.key)||ck(e,n.key)):tN(19791,{wu:n})}function cj(e){for(;e.Eu.size>0&&e.Ru.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let r=new tJ(tH.fromString(t)),n=e.fu.next();e.Au.set(n,new cd(r)),e.Ru=e.Ru.insert(r,n),lk(e.remoteStore,new ag(s$(sU(r.path)),n,"TargetPurposeLimboResolution",rE.ce))}}async function cD(e,t,r){let n=[],s=[],i=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{i.push(e.pu(o,t,r).then(t=>{if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:r?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=oM.Es(o.targetId,t);s.push(e)}}))}),await Promise.all(i),e.Pu.J_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>rc.forEach(t,t=>rc.forEach(t.Ts,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>rc.forEach(t.Is,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!rg(e))throw e;tI(oV,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.vs.get(t),n=r.snapshotVersion,s=r.withLastLimboFreeSnapshotVersion(n);e.vs=e.vs.insert(t,s)}}}(e.localStore,s))}async function cR(e,t){if(!e.currentUser.isEqual(t)){tI(cu,"User change. New user:",t.toKey());let r=await oB(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new tA(tk.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await cD(e,r.Ns)}}function cP(e,t){let r=e.Au.get(t);if(r&&r.hu)return s7().add(r.key);{let r=s7(),n=e.Iu.get(t);if(!n)return r;for(let t of n){let n=e.Tu.get(t);r=r.unionWith(n.view.nu)}return r}}async function cO(e,t){let r=await oK(e.localStore,t.query,!0),n=t.view.cu(r);return e.isPrimaryClient&&cA(e,t.targetId,n.au),n}async function cM(e,t){return oW(e.localStore,t).then(t=>cD(e,t))}async function cL(e,t,r,n){var s,i;let a,o=await (s=e.localStore,a=s.mutationQueue,s.persistence.runTransaction("Lookup mutation documents","readonly",e=>a.Xn(e,t).next(t=>t?s.localDocuments.getDocuments(e,t):rc.resolve(null))));null!==o?("pending"===r?await lq(e.remoteStore):"acknowledged"===r||"rejected"===r?(cS(e,t,n||null),cN(e,t),i=e.localStore,i.mutationQueue.nr(t)):tN(6720,"Unknown batchState",{bu:r}),await cD(e,o)):tI(cu,"Cannot apply mutation batch with id: "+t)}async function cF(e,t){if(c$(e),cG(e),!0===t&&!0!==e.gu){let t=e.sharedClientState.getAllActiveQueryTargets(),r=await cV(e,t.toArray());for(let t of(e.gu=!0,await lJ(e.remoteStore,!0),r))lk(e.remoteStore,t)}else if(!1===t&&!1!==e.gu){let t=[],r=Promise.resolve();e.Iu.forEach((n,s)=>{e.sharedClientState.isLocalQueryTarget(s)?t.push(s):r=r.then(()=>(cC(e,s),oG(e.localStore,s,!0))),lA(e.remoteStore,s)}),await r,await cV(e,t),e.Au.forEach((t,r)=>{lA(e.remoteStore,r)}),e.Vu.zr(),e.Au=new Map,e.Ru=new nT(tJ.comparator),e.gu=!1,await lJ(e.remoteStore,!1)}}async function cV(e,t,r){let n=[],s=[];for(let r of t){let t,i=e.Iu.get(r);if(i&&0!==i.length)for(let r of(t=await o$(e.localStore,s$(i[0])),i)){let t=e.Tu.get(r),n=await cO(e,t);n.snapshot&&s.push(n.snapshot)}else{let n=await oH(e.localStore,r);t=await o$(e.localStore,n),await cy(e,cU(n),r,!1,t.resumeToken)}n.push(t)}return e.Pu.J_(s),n}function cU(e){var t,r,n,s,i;return t=e.path,r=e.collectionGroup,n=e.orderBy,s=e.filters,i=e.limit,new sV(t,r,n,s,i,"F",e.startAt,e.endAt)}function cB(e){return e.localStore.persistence.hs()}async function cq(e,t,r,n){if(e.gu)return void tI(cu,"Ignoring unexpected query state notification.");let s=e.Iu.get(t);if(s&&s.length>0)switch(r){case"current":case"not-current":{let n=await oW(e.localStore,sX(s[0])),i=iz.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,nR.EMPTY_BYTE_STRING);await cD(e,n,i);break}case"rejected":await oG(e.localStore,t,!0),cC(e,t,n);break;default:tN(64155,r)}}async function cz(e,t,r){let n=c$(e);if(n.gu){for(let e of t){if(n.Iu.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){tI(cu,"Adding an already active target "+e);continue}let t=await oH(n.localStore,e),r=await o$(n.localStore,t);await cy(n,cU(t),r.targetId,!1,r.resumeToken),lk(n.remoteStore,r)}for(let e of r)n.Iu.has(e)&&await oG(n.localStore,e,!1).then(()=>{lA(n.remoteStore,e),cC(n,e)}).catch(rl)}}function c$(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=cw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=cP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=c_.bind(null,e),e.Pu.J_=l9.bind(null,e.eventManager),e.Pu.yu=ce.bind(null,e.eventManager),e}function cG(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=cE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=cT.bind(null,e),e}class cK{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=lg(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new oF,new oU(t,r,e.initialUser,this.serializer)}Cu(e){return new oN(oC.Vi,this.serializer)}Du(e){return new lt}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}cK.provider={build:()=>new cK};class cH extends cK{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return tC(this.persistence.referenceDelegate instanceof ok,46915),new oi(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?a5.withCacheSize(this.cacheSizeBytes):a5.DEFAULT;return new oN(e=>ok.Vi(e,t),this.serializer)}}class cW extends cK{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await cG(this.xu.syncEngine),await lq(this.xu.remoteStore),await this.persistence.zi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,r;return t=this.persistence,r=new oF,new oU(t,r,e.initialUser,this.serializer)}Fu(e,t){return new oi(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let r=new r_(t,this.persistence);return new rI(e.asyncQueue,r)}Cu(e){let t=oO(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?a5.withCacheSize(this.cacheSizeBytes):a5.DEFAULT;return new oP(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,lp(),lm(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new lt}}class cQ extends cW{constructor(e,t){super(e,t,!1),this.xu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.xu.syncEngine;this.sharedClientState instanceof le&&(this.sharedClientState.syncEngine={So:cL.bind(null,t),Do:cq.bind(null,t),Co:cz.bind(null,t),hs:cB.bind(null,t),bo:cM.bind(null,t)},await this.sharedClientState.start()),await this.persistence.zi(async e=>{await cF(this.xu.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}Du(e){let t=lp();if(!le.v(t))throw new tA(tk.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=oO(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new le(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class cJ{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>cI(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=cR.bind(null,this.syncEngine),await lJ(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new l4}createDatastore(e){var t;let r=lg(e.databaseInfo.databaseId),n=new lf(e.databaseInfo);return t=e.authCredentials,new l_(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new lN(t,r,e.asyncQueue,e=>cI(this.syncEngine,e,0),ls.v()?new ls:new lr)}createSyncEngine(e,t){var r,n,s,i,a,o;let l;return r=this.localStore,n=this.remoteStore,s=this.eventManager,i=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new cf(r,n,s,i,a,o),t&&(l.gu=!0),l}async terminate(){await async function(e){tI(lT,"RemoteStore shutting down."),e.Ea.add(5),await lC(e),e.Aa.shutdown(),e.Va.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}function cY(e,t=10240){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}cJ.provider={build:()=>new cJ};class cX{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):t_("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class cZ{constructor(e,t){this.Bu=e,this.serializer=t,this.metadata=new tj,this.buffer=new Uint8Array,this.Lu=new TextDecoder("utf-8"),this.ku().then(e=>{e&&e.Ua()?this.metadata.resolve(e.qa.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.qa)}`))},e=>this.metadata.reject(e))}close(){return this.Bu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.ku()}async ku(){let e=await this.Ku();if(null===e)return null;let t=this.Lu.decode(e),r=Number(t);return isNaN(r)&&this.qu(`length string (${t}) is not valid number`),new cn(JSON.parse(await this.Uu(r)),e.length+r)}$u(){return this.buffer.findIndex(e=>123===e)}async Ku(){for(;0>this.$u()&&!await this.Wu(););if(0===this.buffer.length)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Uu(e){for(;this.buffer.length<e;)await this.Wu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Lu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Bu.cancel(),Error(`Invalid bundle format: ${e}`)}async Wu(){let e=await this.Bu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class c0{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Ua())throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.qa)}`);this.metadata=r;do null!==(r=this.Su())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}Qu(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let e=this.Ku();return new cn(JSON.parse(this.Uu(e)),e)}Uu(e){if(this.cursor+e>this.bundleData.length)throw new tA(tk.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}Ku(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class c1{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new tA(tk.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await async function(e,t){let r={documents:t.map(t=>i9(e.serializer,t))},n=await e.jo("BatchGetDocuments",e.serializer.databaseId,tH.emptyPath(),r,t.length),s=new Map;n.forEach(t=>{var r;let n,i,a,o,l,c,u=(r=e.serializer,"found"in t?(tC(!!t.found,43571),t.found.name,t.found.updateTime,n=ae(r,t.found.name),i=i4(t.found.updateTime),a=t.found.createTime?i4(t.found.createTime):t4.min(),o=new sc({mapValue:{fields:t.found.fields}}),su.newFoundDocument(n,i,a,o)):"missing"in t?(tC(!!t.missing,3894),tC(!!t.readTime,22933),l=ae(r,t.missing),c=i4(t.readTime),su.newNoDocument(l,c)):tN(7234,{result:t}));s.set(u.key.toString(),u)});let i=[];return t.forEach(e=>{let t=s.get(e.toString());tC(!!t,55234,{key:e}),i.push(t)}),i}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new iS(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=tJ.fromPath(t);this.mutations.push(new iC(r,this.precondition(r)))}),await async function(e,t){let r={writes:t.map(t=>ao(e.serializer,t))};await e.Wo("Commit",e.serializer.databaseId,tH.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw tN(50498,{Gu:e.constructor.name});t=t4.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new tA(tk.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(t4.min())?ig.exists(!1):ig.updateTime(t):ig.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(t4.min()))throw new tA(tk.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ig.updateTime(t)}return ig.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class c2{constructor(e,t,r,n,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=s,this.zu=r.maxAttempts,this.M_=new ly(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Hu()}Hu(){this.M_.p_(async()=>{let e=new c1(this.datastore),t=this.Ju(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Zu(e)}))}).catch(e=>{this.Zu(e)})})}Ju(e){try{let t=this.updateFunction(e);return!rT(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Zu(e){this.zu>0&&this.Xu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Hu(),Promise.resolve()))):this.deferred.reject(e)}Xu(e){if("FirebaseError"===e?.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!iP(t)}return!1}}let c5="FirestoreClient";class c6{constructor(e,t,r,n,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this._databaseInfo=n,this.user=tb.UNAUTHENTICATED,this.clientId=tU.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async e=>{tI(c5,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(tI(c5,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new tj;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=l0(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function c4(e,t){e.asyncQueue.verifyOperationInProgress(),tI(c5,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await oB(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function c3(e,t){e.asyncQueue.verifyOperationInProgress();let r=await c8(e);tI(c5,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>lQ(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>lQ(t.remoteStore,r)),e._onlineComponents=t}async function c8(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){tI(c5,"Using user provided OfflineComponentProvider");try{await c4(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===tk.FAILED_PRECONDITION||t.code===tk.UNIMPLEMENTED:!("u">typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;tE("Error using user provided cache. Falling back to memory cache: "+t),await c4(e,new cK)}}else tI(c5,"Using default OfflineComponentProvider"),await c4(e,new cH(void 0));return e._offlineComponents}async function c7(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(tI(c5,"Using user provided OnlineComponentProvider"),await c3(e,e._uninitializedComponentsProvider._online)):(tI(c5,"Using default OnlineComponentProvider"),await c3(e,new cJ))),e._onlineComponents}function c9(e){return c8(e).then(e=>e.localStore)}function ue(e){return c7(e).then(e=>e.syncEngine)}function ut(e){return c7(e).then(e=>e.datastore)}async function ur(e){let t=await c7(e),r=t.eventManager;return r.onListen=cp.bind(null,t.syncEngine),r.onUnlisten=cb.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=cm.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=cx.bind(null,t.syncEngine),r}function un(e,t,r={}){let n=new tj;return e.asyncQueue.enqueueAndForget(async()=>{var s,i;let a,o;return s=await ur(e),i=e.asyncQueue,a=new cX({next:e=>{a.Nu(),i.enqueueAndForget(()=>l7(s,o));let l=e.docs.has(t);!l&&e.fromCache?n.reject(new tA(tk.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&r&&"server"===r.source?n.reject(new tA(tk.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(e)},error:e=>n.reject(e)}),l8(s,o=new cr(sU(t.path),a,{includeMetadataChanges:!0,Ka:!0}))}),n.promise}function us(e,t,r={}){let n=new tj;return e.asyncQueue.enqueueAndForget(async()=>{var s,i;let a,o;return s=await ur(e),i=e.asyncQueue,o=new cr(t,a=new cX({next:e=>{a.Nu(),i.enqueueAndForget(()=>l7(s,o)),e.fromCache&&"server"===r.source?n.reject(new tA(tk.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(e)},error:e=>n.reject(e)}),{includeMetadataChanges:!0,Ka:!0}),l8(s,o)}),n.promise}function ui(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let ua=new Map,uo="firestore.googleapis.com";class ul{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new tA(tk.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=uo,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new tA(tk.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new tA(tk.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ui(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new tA(tk.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new tA(tk.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new tA(tk.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class uc{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ul({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new tA(tk.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new tA(tk.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ul(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new tR;switch(e.type){case"firstParty":return new tL(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new tA(tk.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=ua.get(this))&&(tI("ComponentProvider","Removing Datastore"),ua.delete(this),e.terminate()),Promise.resolve()}}class uu{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new uu(this.firestore,e,this._query)}}class uh{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ud(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new uh(this.firestore,e,this._key)}toJSON(){return{type:uh._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(t5(t,uh._jsonSchema))return new uh(e,r||null,new tJ(tH.fromString(t.referencePath)))}}uh._jsonSchemaVersion="firestore/documentReference/1.0",uh._jsonSchema={type:t2("string",uh._jsonSchemaVersion),referencePath:t2("string")};class ud extends uu{constructor(e,t,r){super(e,t,sU(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new uh(this.firestore,null,new tJ(e))}withConverter(e){return new ud(this.firestore,e,this._path)}}function uf(e,t){return e=ed(e),t=ed(t),e instanceof uu&&t instanceof uu&&e.firestore===t.firestore&&sW(e._query,t._query)&&e.converter===t.converter}let up="AsyncQueue";class um{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ly(this,"async_queue_retry"),this._c=()=>{let e=lm();e&&tI(up,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=lm();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=lm();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new tj;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(0!==this.Yu.length){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!rg(e))throw e;tI(up,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,t_("INTERNAL UNHANDLED ERROR: ",ug(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let n=lZ.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&tN(47125,{Pc:ug(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function ug(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class uy{constructor(){this._progressObserver={},this._taskCompletionResolver=new tj,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class ub extends uc{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new um,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new um(e),this._firestoreClient=void 0,await e}}}function ux(e){if(e._terminated)throw new tA(tk.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,r,n,s,i;let a,o=e._freezeSettings(),l=(t=e._databaseId,r=e._app?.options.appId||"",n=e._persistenceKey,s=e._app?.options.apiKey,new nG(t,r,n,o.host,o.ssl,o.experimentalForceLongPolling,o.experimentalAutoDetectLongPolling,ui(o.experimentalLongPollingOptions),o.useFetchStreams,o.isUsingEmulator,s));e._componentsProvider||o.localCache?._offlineComponentProvider&&o.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new c6(e._authCredentials,e._appCheckCredentials,e._queue,l,e._componentsProvider&&(i=e._componentsProvider,a=i?._online.build(),{_offline:i?._offline.build(a),_online:a}))}(e),e._firestoreClient}function uv(e,t){let r=ux(e=t0(e,ub)),n=new uy;return function(e,t,r,n){var s;let i=(s=lg(t),new cZ(function(e,t){if(e instanceof Uint8Array)return cY(e,void 0);if(e instanceof ArrayBuffer)return cY(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof r?iL().encode(r):r),s));e.asyncQueue.enqueueAndForget(async()=>{var t;(async function(e,t,r){try{var n,s;let i,a=await t.getMetadata();if(await (n=e.localStore,i=i4(a.createTime),n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Pi.getBundleMetadata(e,a.id)).then(e=>!!e&&e.createTime.compareTo(i)>=0)))return await t.close(),r._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}),Promise.resolve(new Set);r._updateProgress(ca(a));let o=new ci(a,t.serializer),l=await t.Su();for(;l;){let e=await o.Ga(l);e&&r._updateProgress(e),l=await t.Su()}let c=await o.ja(e.localStore);return await cD(e,c.Ja,void 0),await (s=e.localStore,s.persistence.runTransaction("Save bundle","readwrite",e=>s.Pi.saveBundleMetadata(e,a))),r._completeWith(c.progress),Promise.resolve(c.Ha)}catch(e){return tE(cu,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}})(t=await ue(e),i,n).then(e=>{t.sharedClientState.notifyBundleLoaded(e)})})}(r,e._databaseId,t,n),n}class uw{constructor(e){this._byteString=e}static fromBase64String(e){try{return new uw(nR.fromBase64String(e))}catch(e){throw new tA(tk.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new uw(nR.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:uw._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(t5(e,uw._jsonSchema))return uw.fromBase64String(e.bytes)}}uw._jsonSchemaVersion="firestore/bytes/1.0",uw._jsonSchema={type:t2("string",uw._jsonSchemaVersion),bytes:t2("string")};class uI{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new tA(tk.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tQ(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class u_{constructor(e){this._methodName=e}}class uE{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new tA(tk.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new tA(tk.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return tB(this._lat,e._lat)||tB(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:uE._jsonSchemaVersion}}static fromJSON(e){if(t5(e,uE._jsonSchema))return new uE(e.latitude,e.longitude)}}uE._jsonSchemaVersion="firestore/geoPoint/1.0",uE._jsonSchema={type:t2("string",uE._jsonSchemaVersion),latitude:t2("number"),longitude:t2("number")};class uT{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:uT._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(t5(e,uT._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new uT(e.vectorValues);throw new tA(tk.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}uT._jsonSchemaVersion="firestore/vectorValue/1.0",uT._jsonSchema={type:t2("string",uT._jsonSchemaVersion),vectorValues:t2("object")};let uN=/^__.*__$/;class uS{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new i_(e,this.data,this.fieldMask,t,this.fieldTransforms):new iI(e,this.data,t,this.fieldTransforms)}}class uC{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new i_(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function uk(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw tN(40011,{dataSource:e})}}class uA{constructor(e,t,r,n,s,i){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===s&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new uA({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return uG(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(uk(this.dataSource)&&uN.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class uj{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||lg(e)}createContext(e,t,r,n=!1){return new uA({dataSource:e,methodName:t,targetDoc:r,path:tQ.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function uD(e){let t=e._freezeSettings(),r=lg(e._databaseId);return new uj(e._databaseId,!!t.ignoreUndefinedProperties,r)}function uR(e,t,r,n,s,i={}){let a,o,l=e.createContext(i.merge||i.mergeFields?2:0,t,r,s);uB("Data must be an object, but it was:",l,n);let c=uV(n,l);if(i.merge)a=new nj(l.fieldMask),o=l.fieldTransforms;else if(i.mergeFields){let e=[];for(let n of i.mergeFields){let s=uq(t,n,r);if(!l.contains(s))throw new tA(tk.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);uK(e,s)||e.push(s)}a=new nj(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new uS(new sc(c),a,o)}class uP extends u_{_toFieldTransform(e){if(2!==e.dataSource)throw 1===e.dataSource?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof uP}}function uO(e,t,r,n){let s=e.createContext(1,t,r);uB("Data must be an object, but it was:",s,n);let i=[],a=sc.empty();return n_(n,(e,n)=>{let o=u$(t,e,r);n=ed(n);let l=s.childContextForFieldPath(o);if(n instanceof uP)i.push(o);else{let e=uF(n,l);null!=e&&(i.push(o),a.set(o,e))}}),new uC(a,new nj(i),s.fieldTransforms)}function uM(e,t,r,n,s,i){let a=e.createContext(1,t,r),o=[uq(t,n,r)],l=[s];if(i.length%2!=0)throw new tA(tk.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<i.length;e+=2)o.push(uq(t,i[e])),l.push(i[e+1]);let c=[],u=sc.empty();for(let e=o.length-1;e>=0;--e)if(!uK(c,o[e])){let t=o[e],r=l[e];r=ed(r);let n=a.childContextForFieldPath(t);if(r instanceof uP)c.push(t);else{let e=uF(r,n);null!=e&&(c.push(t),u.set(t,e))}}return new uC(u,new nj(c),a.fieldTransforms)}function uL(e,t,r,n=!1){return uF(r,e.createContext(n?4:3,t))}function uF(e,t){if(uU(e=ed(e)))return uB("Unsupported field value:",t,e),uV(e,t);if(e instanceof u_)return function(e,t){if(!uk(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");let r=[],n=0;for(let s of e){let e=uF(s,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}return function(e,t){var r,n,s;if(null===(e=ed(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return r=t.serializer,rS(n=e)?it(n):ie(r,n);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=t6.fromDate(e);return{timestampValue:i5(t.serializer,r)}}if(e instanceof t6){let r=new t6(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:i5(t.serializer,r)}}if(e instanceof uE)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof uw)return{bytesValue:i6(t.serializer,e._byteString)};if(e instanceof uh){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:i3(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof uT)return{mapValue:{fields:{[nW]:{stringValue:nY},[nX]:{arrayValue:{values:((s=e)instanceof uT?s.toArray():s).map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return ie(t.serializer,e)})}}}}};if(am(e))return e._toProto(t.serializer);throw t.createError(`Unsupported field value: ${tZ(e)}`)}(e,t)}function uV(e,t){let r={};return nE(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):n_(e,(e,n)=>{let s=uF(n,t.childContextForField(e));null!=s&&(r[e]=s)}),{mapValue:{fields:r}}}function uU(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof t6||e instanceof uE||e instanceof uw||e instanceof uh||e instanceof u_||e instanceof uT||am(e))}function uB(e,t,r){if(!uU(r)||!tX(r)){let n=tZ(r);throw"an object"===n?t.createError(e+" a custom object"):t.createError(e+" "+n)}}function uq(e,t,r){if((t=ed(t))instanceof uI)return t._internalPath;if("string"==typeof t)return u$(e,t);throw uG("Field path arguments must be of type string or ",e,!1,void 0,r)}let uz=RegExp("[~\\*/\\[\\]]");function u$(e,t,r){if(t.search(uz)>=0)throw uG(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new uI(...t.split("."))._internalPath}catch(n){throw uG(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function uG(e,t,r,n,s){let i=n&&!n.isEmpty(),a=void 0!==s,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${n}`),a&&(l+=` in document ${s}`),l+=")"),new tA(tk.INVALID_ARGUMENT,o+e+l)}function uK(e,t){return e.some(e=>e.isEqual(t))}class uH{convertValue(e,t="none"){switch(n0(e)){case 0:return null;case 1:return e.booleanValue;case 2:return nM(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nL(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw tN(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return n_(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new uT(e.fields?.[nX].arrayValue?.values?.map(e=>nM(e.doubleValue)))}convertGeoPoint(e){return new uE(nM(e.latitude),nM(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=nz(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(n$(e));default:return null}}convertTimestamp(e){let t=nO(e);return new t6(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=tH.fromString(e);tC(ap(r),9688,{name:e});let n=new nH(r.get(1),r.get(3)),s=new tJ(r.popFirst(5));return n.isEqual(t)||t_(`Document ${s} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}class uW extends uH{constructor(e){super(),this.firestore=e}convertBytes(e){return new uw(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new uh(this.firestore,null,t)}}let uQ="@firebase/firestore",uJ="4.10.0";function uY(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class uX{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class uZ{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}_fieldsProto(){return new sc({mapValue:{fields:this._data}}).clone().value.mapValue.fields}}class u0{constructor(e,t,r,n,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new uh(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new u1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){return this._document?.data.clone().value.mapValue.fields??void 0}get(e){if(this._document){let t=this._document.data.field(uq("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class u1 extends u0{data(){return super.data()}}function u2(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new tA(tk.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class u5{}class u6 extends u5{}function u4(e,t,...r){let n=[];for(let s of(t instanceof u5&&n.push(t),function(e){let t=e.filter(e=>e instanceof u7).length,r=e.filter(e=>e instanceof u3).length;if(t>1||t>0&&r>0)throw new tA(tk.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(r)),n))e=s._apply(e);return e}class u3 extends u6{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new u3(e,t,r)}_apply(e){let t=this._parse(e);return hm(e._query,t),new uu(e.firestore,e.converter,sK(e._query,t))}_parse(e){let t=uD(e.firestore);return function(e,t,r,n,s,i,a){let o;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new tA(tk.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){hp(a,i);let t=[];for(let r of a)t.push(hf(n,e,r));o={arrayValue:{values:t}}}else o=hf(n,e,a)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||hp(a,i),o=uL(r,t,a,"in"===i||"not-in"===i);return sg.create(s,i,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function u8(e,t,r){let n=uq("where",e);return u3._create(n,t,r)}class u7 extends u5{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new u7(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:sy.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())hm(r,e),r=sK(r,e)}(e._query,t),new uu(e.firestore,e.converter,sK(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function u9(...e){return e.forEach(e=>hg("or",e)),u7._create("or",e)}function he(...e){return e.forEach(e=>hg("and",e)),u7._create("and",e)}class ht extends u6{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ht(e,t)}_apply(e){var t;let r,n=function(e,t,r){if(null!==e.startAt)throw new tA(tk.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new tA(tk.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new sp(t,r)}(e._query,this._field,this._direction);return new uu(e.firestore,e.converter,(t=e._query,r=t.explicitOrderBy.concat([n]),new sV(t.path,t.collectionGroup,r,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function hr(e,t="asc"){let r=uq("orderBy",e);return ht._create(r,t)}class hn extends u6{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new hn(e,t,r)}_apply(e){return new uu(e.firestore,e.converter,sH(e._query,this._limit,this._limitType))}}function hs(e){return t1("limit",e),hn._create("limit",e,"F")}function hi(e){return t1("limitToLast",e),hn._create("limitToLast",e,"L")}class ha extends u6{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ha(e,t,r)}_apply(e){var t;let r=hd(e,this.type,this._docOrFields,this._inclusive);return new uu(e.firestore,e.converter,(t=e._query,new sV(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,r,t.endAt)))}}function ho(...e){return ha._create("startAt",e,!0)}function hl(...e){return ha._create("startAfter",e,!1)}class hc extends u6{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new hc(e,t,r)}_apply(e){var t;let r=hd(e,this.type,this._docOrFields,this._inclusive);return new uu(e.firestore,e.converter,(t=e._query,new sV(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,r)))}}function hu(...e){return hc._create("endBefore",e,!1)}function hh(...e){return hc._create("endAt",e,!0)}function hd(e,t,r,n){if(r[0]=ed(r[0]),r[0]instanceof u0)return function(e,t,r,n,s){if(!n)throw new tA(tk.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let i=[];for(let r of sz(e))if(r.field.isKeyField())i.push(n8(t,n.key));else{let e=n.data.field(r.field);if(nq(e))throw new tA(tk.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=r.field.canonicalString();throw new tA(tk.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}i.push(e)}return new sh(i,s)}(e._query,e.firestore._databaseId,t,r[0]._document,n);{let s=uD(e.firestore);return function(e,t,r,n,s,i){let a=e.explicitOrderBy;if(s.length>a.length)throw new tA(tk.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let i=0;i<s.length;i++){let l=s[i];if(a[i].field.isKeyField()){if("string"!=typeof l)throw new tA(tk.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!sq(e)&&-1!==l.indexOf("/"))throw new tA(tk.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(tH.fromString(l));if(!tJ.isDocumentKey(r))throw new tA(tk.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let s=new tJ(r);o.push(n8(t,s))}else{let e=uL(r,n,l);o.push(e)}}return new sh(o,i)}(e._query,e.firestore._databaseId,s,t,r,n)}}function hf(e,t,r){if("string"==typeof(r=ed(r))){if(""===r)throw new tA(tk.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sq(t)&&-1!==r.indexOf("/"))throw new tA(tk.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(tH.fromString(r));if(!tJ.isDocumentKey(n))throw new tA(tk.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return n8(e,new tJ(n))}if(r instanceof uh)return n8(e,r._key);throw new tA(tk.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${tZ(r)}.`)}function hp(e,t){if(!Array.isArray(e)||0===e.length)throw new tA(tk.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function hm(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new tA(tk.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new tA(tk.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function hg(e,t){if(!(t instanceof u3||t instanceof u7))throw new tA(tk.INVALID_ARGUMENT,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function hy(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class hb extends uH{constructor(e){super(),this.firestore=e}convertBytes(e){return new uw(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new uh(this.firestore,null,t)}}function hx(e){return new uX("sum",uq("sum",e))}function hv(e){return new uX("avg",uq("average",e))}function hw(){return new uX("count")}function hI(e,t){return e instanceof uX&&t instanceof uX&&e.aggregateType===t.aggregateType&&e._internalFieldPath?.canonicalString()===t._internalFieldPath?.canonicalString()}function h_(e,t){return uf(e.query,t.query)&&es(e.data(),t.data())}function hE(e){return hT(e,{count:hw()})}function hT(e,t){var r;let n,s=t0(e.firestore,ub),i=ux(s),a=function(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}(t,(e,t)=>new iD(t,e.aggregateType,e._internalFieldPath));return(r=e._query,n=new tj,i.asyncQueue.enqueueAndForget(async()=>{try{let e=await ut(i);n.resolve(async function(e,t,r){let{request:n,gt:s,parent:i}=function(e,t,r,n){let{ft:s,parent:i}=au(e,t),a={},o=[],l=0;return r.forEach(e=>{let t="aggregate_"+l++;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:ad(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:ad(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:s.structuredQuery},parent:s.parent},gt:a,parent:i}}(e.serializer,(t.Re||(t.Re=sG(t,t.explicitOrderBy)),t.Re),r);e.connection.Ko||delete n.parent;let a=(await e.jo("RunAggregationQuery",e.serializer.databaseId,i,n,1)).filter(e=>!!e.result);tC(1===a.length,64727);let o=a[0].result?.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[s[t]]=o[t],e),{})}(e,r,a))}catch(e){n.reject(e)}}),n.promise).then(t=>new uZ(e,new uW(s),t))}class hN{constructor(e){this.kind="memory",this._onlineComponentProvider=cJ.provider,this._offlineComponentProvider=e?.garbageCollector?e.garbageCollector._offlineComponentProvider:{build:()=>new cH(void 0)}}toJSON(){return{kind:this.kind}}}class hS{constructor(e){let t;this.kind="persistent",e?.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=hM(void 0))._initialize(e),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class hC{constructor(){this.kind="memoryEager",this._offlineComponentProvider=cK.provider}toJSON(){return{kind:this.kind}}}class hk{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new cH(e)}}toJSON(){return{kind:this.kind}}}function hA(){return new hC}function hj(e){return new hk(e?.cacheSizeBytes)}function hD(e){return new hN(e)}function hR(e){return new hS(e)}class hP{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=cJ.provider,this._offlineComponentProvider={build:t=>new cW(t,e?.cacheSizeBytes,this.forceOwnership)}}}class hO{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=cJ.provider,this._offlineComponentProvider={build:t=>new cQ(t,e?.cacheSizeBytes)}}}function hM(e){return new hP(e?.forceOwnership)}function hL(){return new hO}let hF="NOT SUPPORTED";class hV{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hU extends u0{constructor(e,t,r,n,s,i){super(e,t,r,n,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new hq(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(uq("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new tA(tk.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=hU._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}function hB(e,t,r){if(t5(t,hU._jsonSchema)){var n;if(t.bundle===hF)throw new tA(tk.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let s=lg(e._databaseId),i=(n=t.bundle,new c0(n,s)),a=i.t(),o=new ci(i.getMetadata(),s);for(let e of a)o.o(e);let l=o.documents;if(1!==l.length)throw new tA(tk.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${l.length} documents.`);let c=aa(s,l[0].document),u=new tJ(tH.fromString(t.bundleName));return new hU(e,new hb(e),u,c,new hV(!1,!1),r||null)}}hU._jsonSchemaVersion="firestore/documentSnapshot/1.0",hU._jsonSchema={type:t2("string",hU._jsonSchemaVersion),bundleSource:t2("string","DocumentSnapshot"),bundleName:t2("string"),bundle:t2("string")};class hq extends hU{data(e={}){return super.data(e)}}class hz{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new hV(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new hq(this._firestore,this._userDataWriter,r.key,r,new hV(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new tA(tk.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new hq(e._firestore,e._userDataWriter,r.doc.key,r.doc,new hV(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new hq(e._firestore,e._userDataWriter,t.doc.key,t.doc,new hV(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),s=-1,i=-1;return 0!==t.type&&(s=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(i=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return tN(61501,{type:e})}}(t.type),doc:n,oldIndex:s,newIndex:i}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new tA(tk.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=hz._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=tU.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function h$(e,t,r){if(t5(t,hz._jsonSchema)){var n;if(t.bundle===hF)throw new tA(tk.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let s=lg(e._databaseId),i=(n=t.bundle,new c0(n,s)),a=i.t(),o=new ci(i.getMetadata(),s);for(let e of a)o.o(e);if(1!==o.queries.length)throw new tA(tk.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let l=aT(o.queries[0].bundledQuery),c=o.documents,u=new l1;c.map(e=>{let t=aa(s,e.document);u=u.add(t)});let h=l5.fromInitialDocuments(l,u,s7(),!1,!1),d=new uu(e,r||null,l);return new hz(e,new hb(e),d,h)}}function hG(e,t){return e instanceof hU&&t instanceof hU?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof hz&&t instanceof hz&&e._firestore===t._firestore&&uf(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}hz._jsonSchemaVersion="firestore/querySnapshot/1.0",hz._jsonSchema={type:t2("string",hz._jsonSchemaVersion),bundleSource:t2("string","QuerySnapshot"),bundleName:t2("string"),bundle:t2("string")};let hK={maxAttempts:5};class hH{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=uD(e)}set(e,t,r){this._verifyNotCommitted();let n=hW(e,this._firestore),s=hy(n.converter,t,r),i=uR(this._dataReader,"WriteBatch.set",n._key,s,null!==n.converter,r);return this._mutations.push(i.toMutation(n._key,ig.none())),this}update(e,t,r,...n){let s;this._verifyNotCommitted();let i=hW(e,this._firestore);return s="string"==typeof(t=ed(t))||t instanceof uI?uM(this._dataReader,"WriteBatch.update",i._key,t,r,n):uO(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,ig.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=hW(e,this._firestore);return this._mutations=this._mutations.concat(new iS(t._key,ig.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new tA(tk.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function hW(e,t){if((e=ed(e)).firestore!==t)throw new tA(tk.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class hQ{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=uD(e)}get(e){let t=hW(e,this._firestore),r=new hb(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return tN(24041);let n=e[0];if(n.isFoundDocument())return new u0(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new u0(this._firestore,r,t._key,null,t.converter);throw tN(18433,{doc:n})})}set(e,t,r){let n=hW(e,this._firestore),s=hy(n.converter,t,r),i=uR(this._dataReader,"Transaction.set",n._key,s,null!==n.converter,r);return this._transaction.set(n._key,i),this}update(e,t,r,...n){let s,i=hW(e,this._firestore);return s="string"==typeof(t=ed(t))||t instanceof uI?uM(this._dataReader,"Transaction.update",i._key,t,r,n):uO(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){let t=hW(e,this._firestore);return this._transaction.delete(t._key),this}}class hJ extends hQ{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=hW(e,this._firestore),r=new uW(this._firestore);return super.get(e).then(e=>new hU(this._firestore,r,t._key,e._document,new hV(!1,!1),t.converter))}}function hY(e,t,r){var n,s;let i;e=t0(e,ub);let a={...hK,...r};if(a.maxAttempts<1)throw new tA(tk.INVALID_ARGUMENT,"Max attempts must be at least 1");return n=ux(e),s=r=>t(new hJ(e,r)),i=new tj,n.asyncQueue.enqueueAndForget(async()=>{let e=await ut(n);new c2(n.asyncQueue,e,a,s,i).ju()}),i.promise}function hX(e){e=t0(e,uh);let t=t0(e.firestore,ub);return un(ux(t),e._key).then(r=>dr(t,e,r))}function hZ(e){var t;let r;e=t0(e,uh);let n=t0(e.firestore,ub),s=ux(n),i=new uW(n);return(t=e._key,r=new tj,s.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await e.persistence.runTransaction("read document","readonly",r=>e.localDocuments.getDocument(r,t));n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new tA(tk.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=l0(n,`Failed to get document '${t} from cache`);r.reject(e)}})(await c9(s),t,r)),r.promise).then(t=>new hU(n,i,e._key,t,new hV(null!==t&&t.hasLocalMutations,!0),e.converter))}function h0(e){e=t0(e,uh);let t=t0(e.firestore,ub);return un(ux(t),e._key,{source:"server"}).then(r=>dr(t,e,r))}function h1(e){e=t0(e,uu);let t=t0(e.firestore,ub),r=ux(t),n=new uW(t);return u2(e._query),us(r,e._query).then(r=>new hz(t,n,e,r))}function h2(e){var t;let r;e=t0(e,uu);let n=t0(e.firestore,ub),s=ux(n),i=new uW(n);return(t=e._query,r=new tj,s.asyncQueue.enqueueAndForget(async()=>(async function(e,t,r){try{let n=await oK(e,t,!0),s=new cc(t,n.ks),i=s.ru(n.documents),a=s.applyChanges(i,!1);r.resolve(a.snapshot)}catch(n){let e=l0(n,`Failed to execute query '${t} against cache`);r.reject(e)}})(await c9(s),t,r)),r.promise).then(t=>new hz(n,i,e,t))}function h5(e){e=t0(e,uu);let t=t0(e.firestore,ub),r=ux(t),n=new uW(t);return us(r,e._query,{source:"server"}).then(r=>new hz(t,n,e,r))}function h6(e,t,r){e=t0(e,uh);let n=t0(e.firestore,ub),s=hy(e.converter,t,r),i=uD(n);return dt(n,[uR(i,"setDoc",e._key,s,null!==e.converter,r).toMutation(e._key,ig.none())])}function h4(e,t,r,...n){e=t0(e,uh);let s=t0(e.firestore,ub),i=uD(s);return dt(s,[("string"==typeof(t=ed(t))||t instanceof uI?uM(i,"updateDoc",e._key,t,r,n):uO(i,"updateDoc",e._key,t)).toMutation(e._key,ig.exists(!0))])}function h3(e){return dt(t0(e.firestore,ub),[new iS(e._key,ig.none())])}function h8(e,t){let r=t0(e.firestore,ub),n=function(e,t,...r){if(e=ed(e),1==arguments.length&&(t=tU.newId()),function(e,t,r){if(!r)throw new tA(tk.INVALID_ARGUMENT,`Function doc() cannot be called with an empty ${t}.`)}(0,"path",t),e instanceof uc){let n=tH.fromString(t,...r);return tY(n),new uh(e,null,new tJ(n))}{if(!(e instanceof uh||e instanceof ud))throw new tA(tk.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(tH.fromString(t,...r));return tY(n),new uh(e.firestore,e instanceof ud?e.converter:null,new tJ(n))}}(e),s=hy(e.converter,t);return dt(r,[uR(uD(e.firestore),"addDoc",n._key,s,null!==e.converter,{}).toMutation(n._key,ig.exists(!1))]).then(()=>n)}function h7(e,...t){var r;let n,s,i,a,o;e=ed(e);let l={includeMetadataChanges:!1,source:"default"},c=0;"object"!=typeof t[0]||uY(t[c])||(l=t[c++]);let u={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(uY(t[c])){let e=t[c];t[c]=e.next?.bind(e),t[c+1]=e.error?.bind(e),t[c+2]=e.complete?.bind(e)}if(e instanceof uh)s=t0(e.firestore,ub),i=sU(e._key.path),n={next:r=>{t[c]&&t[c](dr(s,e,r))},error:t[c+1],complete:t[c+2]};else{let r=t0(e,uu);s=t0(r.firestore,ub),i=r._query;let a=new uW(s);n={next:e=>{t[c]&&t[c](new hz(s,a,r,e))},error:t[c+1],complete:t[c+2]},u2(e._query)}return r=ux(s),o=new cr(i,a=new cX(n),u),r.asyncQueue.enqueueAndForget(async()=>l8(await ur(r),o)),()=>{a.Nu(),r.asyncQueue.enqueueAndForget(async()=>l7(await ur(r),o))}}function h9(e,t,...r){var n,s,i,a,o,l;let c=ed(e),u=function(e){let t={bundle:"",bundleName:"",bundleSource:""};for(let r of["bundle","bundleName","bundleSource"]){if(!(r in e)){t.error=`snapshotJson missing required field: ${r}`;break}let n=e[r];if("string"!=typeof n){t.error=`snapshotJson field '${r}' must be a string.`;break}if(0===n.length){t.error=`snapshotJson field '${r}' cannot be an empty string.`;break}"bundle"===r?t.bundle=n:"bundleName"===r?t.bundleName=n:"bundleSource"===r&&(t.bundleSource=n)}return t}(t);if(u.error)throw new tA(tk.INVALID_ARGUMENT,u.error);let h,d=0;if("object"!=typeof r[0]||uY(r[d])||(h=r[d++]),"QuerySnapshot"===u.bundleSource){let e,t,a=null;if("object"==typeof r[d]&&uY(r[d])){let e=r[d++];a={next:e.next,error:e.error,complete:e.complete}}else a={next:r[d++],error:r[d++],complete:r[d++]};return n=h,s=a,i=r[d],t=!1,uv(c,u.bundle).then(()=>{var e,t,r;return e=c,t=u.bundleName,(r=ux(e=t0(e,ub)),r.asyncQueue.enqueue(async()=>{var e;return e=await c9(r),e.persistence.runTransaction("Get named query","readonly",r=>e.Pi.getNamedQuery(r,t))})).then(t=>t?new uu(e,null,t.query):null)}).then(r=>{r&&!t&&(i&&r.withConverter(i),e=h7(r,n||{},s))}).catch(e=>(s.error&&s.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}if("DocumentSnapshot"===u.bundleSource){let e,t,n=null;if("object"==typeof r[d]&&uY(r[d])){let e=r[d++];n={next:e.next,error:e.error,complete:e.complete}}else n={next:r[d++],error:r[d++],complete:r[d++]};return a=h,o=n,l=r[d],t=!1,uv(c,u.bundle).then(()=>{t||(e=h7(new uh(c,l||null,tJ.fromPath(u.bundleName)),a||{},o))}).catch(e=>(o.error&&o.error(e),()=>{})),()=>{t||(t=!0,e&&e())}}throw new tA(tk.INVALID_ARGUMENT,`unsupported bundle source: ${u.bundleSource}`)}function de(e,t){let r,n=ux(e=t0(e,ub));return r=new cX(uY(t)?t:{next:t}),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await ur(n),void(e.Ca.add(r),r.next())}),()=>{r.Nu(),n.asyncQueue.enqueueAndForget(async()=>{var e;return e=await ur(n),void e.Ca.delete(r)})}}function dt(e,t){var r;let n;return r=ux(e),n=new tj,r.asyncQueue.enqueueAndForget(async()=>cv(await ue(r),t,n)),n.promise}function dr(e,t,r){let n=r.docs.get(t._key),s=new uW(e);return new hU(e,s,t._key,n,new hV(r.hasPendingWrites,r.fromCache),t.converter)}function dn(e){return ux(e=t0(e,ub)),new hH(e,t=>dt(e,t))}function ds(e,t){let r=ux(e=t0(e,ub));if(!r._uninitializedComponentsProvider||"memory"===r._uninitializedComponentsProvider._offline.kind)return tE("Cannot enable indexes when persistence is disabled"),Promise.resolve();let n=function(e){let t="string"==typeof e?function(e){try{return JSON.parse(e)}catch(e){throw new tA(tk.INVALID_ARGUMENT,"Failed to parse JSON: "+e?.message)}}(e):e,r=[];if(Array.isArray(t.indexes))for(let e of t.indexes){let t=di(e,"collectionGroup"),n=[];if(Array.isArray(e.fields))for(let t of e.fields){let e=u$("setIndexConfiguration",di(t,"fieldPath"));"CONTAINS"===t.arrayConfig?n.push(new re(e,2)):"ASCENDING"===t.order?n.push(new re(e,0)):"DESCENDING"===t.order&&n.push(new re(e,1))}r.push(new t3(t3.UNKNOWN_ID,t,n,rt.empty()))}return r}(t);return r.asyncQueue.enqueue(async()=>(async function(e,t){let r=e.indexManager,n=[];return e.persistence.runTransaction("Configure indexes","readwrite",e=>r.getFieldIndexes(e).next(s=>(function(e,t,r,n,s){t=[...t],(e=[...e]).sort(r),t.sort(r);let i=e.length,a=t.length,o=0,l=0;for(;o<a&&l<i;){let i=r(e[l],t[o]);i<0?s(e[l++]):i>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<i;)s(e[l++])})(s,t,t9,t=>{n.push(r.addFieldIndex(e,t))},t=>{n.push(r.deleteFieldIndex(e,t))})).next(()=>rc.waitFor(n)))})(await c9(r),n))}function di(e,t){if("string"!=typeof e[t])throw new tA(tk.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}class da{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function dl(e){e=t0(e,ub);let t=df.get(e);if(t)return t;let r=ux(e);if("persistent"!==r._uninitializedComponentsProvider?._offline.kind)return null;let n=new da(e);return df.set(e,n),n}function dc(e){dd(e,!0)}function du(e){dd(e,!1)}function dh(e){var t;(t=ux(e._firestore)).asyncQueue.enqueue(async()=>{var e;let r;return r=(e=await c9(t)).indexManager,e.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}).then(e=>tI("deleting all persistent cache indexes succeeded")).catch(e=>tE("deleting all persistent cache indexes failed",e))}function dd(e,t){var r;(r=ux(e._firestore),r.asyncQueue.enqueue(async()=>{var e;return e=await c9(r),void(e.Cs.As=t)})).then(e=>tI(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>tE(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}let df=new WeakMap;class dp{constructor(){throw Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return dm.instance.onExistenceFilterMismatch(e)}}class dm{constructor(){this.i=new Map}static get instance(){return dg||function(e){if(iM)throw Error("a TestingHooksSpi instance is already set");iM=e}(dg=new dm),dg}u(e){this.i.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.i;return r.set(t,e),()=>r.delete(t)}}let dg=null;function dy(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}!function(e=!0){tx=e6,eH(new ef("firestore",(t,{instanceIdentifier:r,options:n})=>{let s=t.getProvider("app").getImmediate(),i=new ub(new tO(t.getProvider("auth-internal")),new tV(s,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new tA(tk.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new nH(e.options.projectId,t)}(s,r),s);return n={useFetchStreams:e,...n},i._setSettings(n),i},"PUBLIC").setMultipleInstances(!0)),te(uQ,uJ,void 0),te(uQ,uJ,"esm2020")}(),e.s(["AggregateField",()=>uX,"AggregateQuerySnapshot",()=>uZ,"DocumentSnapshot",()=>hU,"PersistentCacheIndexManager",()=>da,"QueryCompositeFilterConstraint",()=>u7,"QueryConstraint",()=>u6,"QueryDocumentSnapshot",()=>hq,"QueryEndAtConstraint",()=>hc,"QueryFieldFilterConstraint",()=>u3,"QueryLimitConstraint",()=>hn,"QueryOrderByConstraint",()=>ht,"QuerySnapshot",()=>hz,"QueryStartAtConstraint",()=>ha,"SnapshotMetadata",()=>hV,"Transaction",()=>hJ,"WriteBatch",()=>hH,"_TestingHooks",()=>dp,"addDoc",()=>h8,"aggregateFieldEqual",()=>hI,"aggregateQuerySnapshotEqual",()=>h_,"and",()=>he,"average",()=>hv,"count",()=>hw,"deleteAllPersistentCacheIndexes",()=>dh,"deleteDoc",()=>h3,"disablePersistentCacheIndexAutoCreation",()=>du,"documentSnapshotFromJSON",()=>hB,"enablePersistentCacheIndexAutoCreation",()=>dc,"endAt",()=>hh,"endBefore",()=>hu,"executeWrite",()=>dt,"getAggregateFromServer",()=>hT,"getCountFromServer",()=>hE,"getDoc",()=>hX,"getDocFromCache",()=>hZ,"getDocFromServer",()=>h0,"getDocs",()=>h1,"getDocsFromCache",()=>h2,"getDocsFromServer",()=>h5,"getPersistentCacheIndexManager",()=>dl,"limit",()=>hs,"limitToLast",()=>hi,"memoryEagerGarbageCollector",()=>hA,"memoryLocalCache",()=>hD,"memoryLruGarbageCollector",()=>hj,"onSnapshot",()=>h7,"onSnapshotResume",()=>h9,"onSnapshotsInSync",()=>de,"or",()=>u9,"orderBy",()=>hr,"persistentLocalCache",()=>hR,"persistentMultipleTabManager",()=>hL,"persistentSingleTabManager",()=>hM,"query",()=>u4,"querySnapshotFromJSON",()=>h$,"runTransaction",()=>hY,"setDoc",()=>h6,"setIndexConfiguration",()=>ds,"snapshotEqual",()=>hG,"startAfter",()=>hl,"startAt",()=>ho,"sum",()=>hx,"updateDoc",()=>h4,"where",()=>u8,"writeBatch",()=>dn],63802),e.i(63802);let db=new er("auth","Firebase",dy()),dx=new eI("@firebase/auth");function dv(e,...t){dx.logLevel<=u.ERROR&&dx.error(`Auth (${e6}): ${e}`,...t)}function dw(e,...t){throw dT(e,...t)}function dI(e,...t){return dT(e,...t)}function d_(e,t,r){return new er("auth","Firebase",{...dy(),[t]:r}).create(t,{appName:e.name})}function dE(e){return d_(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function dT(e,...t){if("string"!=typeof e){let r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return db.create(e,...t)}function dN(e,t,...r){if(!e)throw dT(t,...r)}function dS(e){let t="INTERNAL ASSERTION FAILED: "+e;throw dv(t),Error(t)}function dC(){return"u">typeof self&&self.location?.href||""}function dk(){return"u">typeof self&&self.location?.protocol||null}class dA{constructor(e,t){var r;this.shortDelay=e,this.longDelay=t,r="Short delay should be less than long delay!",t>e||dS(r),this.isMobile="u">typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(K())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return!("u">typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===dk()||"https:"===dk()||Q()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function dj(e,t){var r,n;r=e.emulator,n="Emulator should always be set here",r||dS(n);let{url:s}=e.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}class dD{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"u">typeof self&&"fetch"in self?self.fetch:"u">typeof globalThis&&globalThis.fetch?globalThis.fetch:"u">typeof fetch?fetch:void dS("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"u">typeof self&&"Headers"in self?self.Headers:"u">typeof globalThis&&globalThis.Headers?globalThis.Headers:"u">typeof Headers?Headers:void dS("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"u">typeof self&&"Response"in self?self.Response:"u">typeof globalThis&&globalThis.Response?globalThis.Response:"u">typeof Response?Response:void dS("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let dR={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},dP=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],dO=new dA(3e4,6e4);function dM(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function dL(e,t,r,n,s={}){return dF(e,s,async()=>{let s={},i={};n&&("GET"===t?i=n:s={body:JSON.stringify(n)});let a=ea({key:e.config.apiKey,...i}).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:o,...s};return"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&B(e.emulatorConfig.host)&&(l.credentials="include"),dD.fetch()(await dU(e,e.config.apiHost,r,a),l)})}async function dF(e,t,r){e._canInitEmulator=!1;let n={...dR,...t};try{let t=new dB(e),s=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let i=await s.json();if("needConfirmation"in i)throw dq(e,"account-exists-with-different-credential",i);if(s.ok&&!("errorMessage"in i))return i;{let[t,r]=(s.ok?i.errorMessage:i.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw dq(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===t)throw dq(e,"email-already-in-use",i);if("USER_DISABLED"===t)throw dq(e,"user-disabled",i);let a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw d_(e,a,r);dw(e,a)}}catch(t){if(t instanceof et)throw t;dw(e,"network-request-failed",{message:String(t)})}}async function dV(e,t,r,n,s={}){let i=await dL(e,t,r,n,s);return"mfaPendingCredential"in i&&dw(e,"multi-factor-auth-required",{_serverResponse:i}),i}async function dU(e,t,r,n){let s=`${t}${r}?${n}`,i=e.config.emulator?dj(e.config,s):`${e.config.apiScheme}://${s}`;return dP.includes(r)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(i).toString():i}class dB{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(dI(this.auth,"network-request-failed")),dO.get())})}}function dq(e,t,r){let n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);let s=dI(e,t,n);return s.customData._tokenResponse=r,s}function dz(e){return void 0!==e&&void 0!==e.enterprise}class d${constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function dG(e,t){return dL(e,"GET","/v2/recaptchaConfig",dM(e,t))}async function dK(e,t){return dL(e,"POST","/v1/accounts:delete",t)}async function dH(e,t){return dL(e,"POST","/v1/accounts:lookup",t)}function dW(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function dQ(e,t=!1){let r=ed(e),n=await r.getIdToken(t),s=dY(n);dN(s&&s.exp&&s.auth_time&&s.iat,r.auth,"internal-error");let i="object"==typeof s.firebase?s.firebase:void 0,a=i?.sign_in_provider;return{claims:s,token:n,authTime:dW(dJ(s.auth_time)),issuedAtTime:dW(dJ(s.iat)),expirationTime:dW(dJ(s.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function dJ(e){return 1e3*Number(e)}function dY(e){let[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return dv("JWT malformed, contained fewer than 3 sections"),null;try{let e=P(r);if(!e)return dv("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return dv("Caught error parsing JWT payload as JSON",e?.toString()),null}}function dX(e){let t=dY(e);return dN(t,"internal-error"),dN(void 0!==t.exp,"internal-error"),dN(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function dZ(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof et&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class d0{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class d1{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=dW(this.lastLoginAt),this.creationTime=dW(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function d2(e){var t,r;let n=e.auth,s=await e.getIdToken(),i=await dZ(e,dH(n,{idToken:s}));dN(i?.users.length,n,"internal-error");let a=i.users[0];e._notifyReloadListener(a);let o=a.providerUserInfo?.length?d6(a.providerUserInfo):[],l=(t=e.providerData,r=o,[...t.filter(e=>!r.some(t=>t.providerId===e.providerId)),...r]),c=e.isAnonymous,u=!(e.email&&a.passwordHash)&&!l?.length;Object.assign(e,{uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new d1(a.createdAt,a.lastLoginAt),isAnonymous:!!c&&u})}async function d5(e){let t=ed(e);await d2(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function d6(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function d4(e,t){let r=await dF(e,{},async()=>{let r=ea({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:s}=e.config,i=await dU(e,n,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let o={method:"POST",headers:a,body:r};return e.emulatorConfig&&B(e.emulatorConfig.host)&&(o.credentials="include"),dD.fetch()(i,o)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function d3(e,t){return dL(e,"POST","/v2/accounts:revokeToken",dM(e,t))}class d8{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){dN(e.idToken,"internal-error"),dN(void 0!==e.idToken,"internal-error"),dN(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):dX(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){dN(0!==e.length,"internal-error");let t=dX(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(dN(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:n,expiresIn:s}=await d4(e,t);this.updateTokensAndExpiration(r,n,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:s}=t,i=new d8;return r&&(dN("string"==typeof r,"internal-error",{appName:e}),i.refreshToken=r),n&&(dN("string"==typeof n,"internal-error",{appName:e}),i.accessToken=n),s&&(dN("number"==typeof s,"internal-error",{appName:e}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new d8,this.toJSON())}_performRefresh(){return dS("not implemented")}}function d7(e,t){dN("string"==typeof e||void 0===e,"internal-error",{appName:t})}class d9{constructor({uid:e,auth:t,stsTokenManager:r,...n}){this.providerId="firebase",this.proactiveRefresh=new d0(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new d1(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(e){let t=await dZ(this,this.stsTokenManager.getToken(this.auth,e));return dN(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return dQ(this,e)}reload(){return d5(this)}_assign(e){this!==e&&(dN(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new d9({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){dN(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await d2(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(eX(this.auth.app))return Promise.reject(dE(this.auth));let e=await this.getIdToken();return await dZ(this,dK(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,n=t.email??void 0,s=t.phoneNumber??void 0,i=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,l=t.createdAt??void 0,c=t.lastLoginAt??void 0,{uid:u,emailVerified:h,isAnonymous:d,providerData:f,stsTokenManager:p}=t;dN(u&&p,e,"internal-error");let m=d8.fromJSON(this.name,p);dN("string"==typeof u,e,"internal-error"),d7(r,e.name),d7(n,e.name),dN("boolean"==typeof h,e,"internal-error"),dN("boolean"==typeof d,e,"internal-error"),d7(s,e.name),d7(i,e.name),d7(a,e.name),d7(o,e.name),d7(l,e.name),d7(c,e.name);let g=new d9({uid:u,auth:e,email:n,emailVerified:h,displayName:r,isAnonymous:d,photoURL:i,phoneNumber:s,tenantId:a,stsTokenManager:m,createdAt:l,lastLoginAt:c});return f&&Array.isArray(f)&&(g.providerData=f.map(e=>({...e}))),o&&(g._redirectEventId=o),g}static async _fromIdTokenResponse(e,t,r=!1){let n=new d8;n.updateFromServerResponse(t);let s=new d9({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await d2(s),s}static async _fromGetAccountInfoResponse(e,t,r){let n=t.users[0];dN(void 0!==n.localId,"internal-error");let s=void 0!==n.providerUserInfo?d6(n.providerUserInfo):[],i=!(n.email&&n.passwordHash)&&!s?.length,a=new d8;a.updateFromIdToken(r);let o=new d9({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:i});return Object.assign(o,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:s,metadata:new d1(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!s?.length}),o}}let fe=new Map;function ft(e){var t,r;t="Expected a class definition",e instanceof Function||dS(t);let n=fe.get(e);return n?(r="Instance stored in cache mismatched with class",n instanceof e||dS(r)):(n=new e,fe.set(e,n)),n}class fr{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function fn(e,t,r){return`firebase:${e}:${t}:${r}`}fr.type="NONE";class fs{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:n,name:s}=this.auth;this.fullUserKey=fn(this.userKey,n.apiKey,s),this.fullPersistenceKey=fn("persistence",n.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await dH(this.auth,{idToken:e}).catch(()=>void 0);return t?d9._fromGetAccountInfoResponse(this.auth,t,e):null}return d9._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new fs(ft(fr),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),s=n[0]||ft(fr),i=fn(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(i);if(t){let n;if("string"==typeof t){let r=await dH(e,{idToken:t}).catch(()=>void 0);if(!r)break;n=await d9._fromGetAccountInfoResponse(e,r,t)}else n=d9._fromJSON(e,t);r!==s&&(a=n),s=r;break}}catch{}let o=n.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&o.length&&(s=o[0],a&&await s._set(i,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(i)}catch{}}))),new fs(s,e,r)}}function fi(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(fc(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(fa(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(fh(t))return"Blackberry";if(fd(t))return"Webos";if(fo(t))return"Safari";if((t.includes("chrome/")||fl(t))&&!t.includes("edge/"))return"Chrome";if(fu(t))return"Android";let r=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(r?.length===2)return r[1]}return"Other"}function fa(e=K()){return/firefox\//i.test(e)}function fo(e=K()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function fl(e=K()){return/crios\//i.test(e)}function fc(e=K()){return/iemobile/i.test(e)}function fu(e=K()){return/android/i.test(e)}function fh(e=K()){return/blackberry/i.test(e)}function fd(e=K()){return/webos/i.test(e)}function ff(e=K()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function fp(e=K()){return ff(e)||fu(e)||fd(e)||fh(e)||/windows phone/i.test(e)||fc(e)}function fm(e,t=[]){let r;switch(e){case"Browser":r=fi(K());break;case"Worker":r=`${fi(K())}-${e}`;break;default:r=e}let n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${e6}/${n}`}class fg{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,n)=>{try{let n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);let n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function fy(e,t={}){return dL(e,"GET","/v2/passwordPolicy",dM(e,t))}class fb{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class fx{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new fv(this),this.idTokenSubscription=new fv(this),this.beforeStateQueue=new fg(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=db,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ft(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await fs.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await dH(this,{idToken:e}),r=await d9._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(eX(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,n=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,s=r?._redirectEventId,i=await this.tryRedirectSignIn(e);(!t||t===s)&&i?.user&&(r=i.user,n=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(n)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(dN(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await d2(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("u"<typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(eX(this.app))return Promise.reject(dE(this));let t=e?ed(e):null;return t&&dN(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&dN(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return eX(this.app)?Promise.reject(dE(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return eX(this.app)?Promise.reject(dE(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ft(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new fb(await fy(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new er("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await d3(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&ft(e)||this._popupRedirectResolver;dN(t,this,"argument-error"),this.redirectPersistenceManager=await fs.create(this,[ft(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let s="function"==typeof t?t:t.next.bind(t),i=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(dN(a,this,"internal-error"),a.then(()=>{i||s(this.currentUser)}),"function"==typeof t){let s=e.addObserver(t,r,n);return()=>{i=!0,s()}}{let r=e.addObserver(t);return()=>{i=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return dN(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=fm(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(eX(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){dx.logLevel<=u.WARN&&dx.warn(`Auth (${e6}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}class fv{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let r=new ec(e,void 0);return r.subscribe.bind(r)}(e=>this.observer=e)}get next(){return dN(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let fw={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function fI(e){return`__${e}${Math.floor(1e6*Math.random())}`}class f_{constructor(){this.enterprise=new fE}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class fE{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let fT="NO_RECAPTCHA";class fN{constructor(e){this.type="recaptcha-enterprise",this.auth=ed(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{dG(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new d$(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){let s=window.grecaptcha;dz(s)?s.enterprise.ready(()=>{s.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(fT)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new f_().execute("siteKey",{action:"verify"}):new Promise((e,s)=>{r(this.auth).then(r=>{if(!t&&dz(window.grecaptcha))n(r,e,s);else{var i;if("u"<typeof window)return void s(Error("RecaptchaVerifier is only supported in browser"));let t=fw.recaptchaEnterpriseScript;0!==t.length&&(t+=r),(i=t,fw.loadJS(i)).then(()=>{n(r,e,s)}).catch(e=>{s(e)})}}).catch(e=>{s(e)})})}}async function fS(e,t,r,n=!1,s=!1){let i,a=new fN(e);if(s)i=fT;else try{i=await a.verify(r)}catch(e){i=await a.verify(r,!0)}let o={...t};if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:i,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:i,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function fC(e,t,r,n,s){if("EMAIL_PASSWORD_PROVIDER"===s)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async s=>{if("auth/missing-recaptcha-token"!==s.code)return Promise.reject(s);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let s=await fS(e,t,r,"getOobCode"===r);return n(e,s)}});else{let s=await fS(e,t,r,"getOobCode"===r);return n(e,s)}if("PHONE_PROVIDER"!==s)return Promise.reject(s+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let s=await fS(e,t,r);return n(e,s).catch(async s=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===s.code||"auth/invalid-app-credential"===s.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let s=await fS(e,t,r,!1,!0);return n(e,s)}return Promise.reject(s)})}{let s=await fS(e,t,r,!1,!0);return n(e,s)}}async function fk(e){let t=ed(e),r=new d$(await dG(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new fN(t).verify()}function fA(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function fj(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class fD{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return dS("not implemented")}_getIdTokenResponse(e){return dS("not implemented")}_linkToIdToken(e,t){return dS("not implemented")}_getReauthenticationResolver(e){return dS("not implemented")}}async function fR(e,t){return dL(e,"POST","/v1/accounts:signUp",t)}async function fP(e,t){return dV(e,"POST","/v1/accounts:signInWithPassword",dM(e,t))}async function fO(e,t){return dV(e,"POST","/v1/accounts:signInWithEmailLink",dM(e,t))}async function fM(e,t){return dV(e,"POST","/v1/accounts:signInWithEmailLink",dM(e,t))}class fL extends fD{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new fL(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new fL(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return fC(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",fP,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return fO(e,{email:this._email,oobCode:this._password});default:dw(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return fC(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",fR,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return fM(e,{idToken:t,email:this._email,oobCode:this._password});default:dw(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function fF(e,t){return dV(e,"POST","/v1/accounts:signInWithIdp",dM(e,t))}class fV extends fD{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new fV(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):dw("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:r,...n}="string"==typeof e?JSON.parse(e):e;if(!t||!r)return null;let s=new fV(t,r);return s.idToken=n.idToken||void 0,s.accessToken=n.accessToken||void 0,s.secret=n.secret,s.nonce=n.nonce,s.pendingToken=n.pendingToken||null,s}_getIdTokenResponse(e){return fF(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,fF(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,fF(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ea(t)}return e}}async function fU(e,t){return dL(e,"POST","/v1/accounts:sendVerificationCode",dM(e,t))}async function fB(e,t){return dV(e,"POST","/v1/accounts:signInWithPhoneNumber",dM(e,t))}async function fq(e,t){let r=await dV(e,"POST","/v1/accounts:signInWithPhoneNumber",dM(e,t));if(r.temporaryProof)throw dq(e,"account-exists-with-different-credential",r);return r}let fz={USER_NOT_FOUND:"user-not-found"};async function f$(e,t){return dV(e,"POST","/v1/accounts:signInWithPhoneNumber",dM(e,{...t,operation:"REAUTH"}),fz)}class fG extends fD{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new fG({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new fG({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return fB(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return fq(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return f$(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:s}=e;return r||t||n||s?new fG({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:s}):null}}class fK{constructor(e){const t=eo(el(e)),r=t.apiKey??null,n=t.oobCode??null,s=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);dN(r&&n&&s,"argument-error"),this.apiKey=r,this.operation=s,this.code=n,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t,r,n,s=(r=(t=eo(el(e)).link)?eo(el(t)).deep_link_id:null,((n=eo(el(e)).deep_link_id)?eo(el(n)).link:null)||n||r||t||e);try{return new fK(s)}catch{return null}}}class fH{constructor(){this.providerId=fH.PROVIDER_ID}static credential(e,t){return fL._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=fK.parseLink(t);return dN(r,"argument-error"),fL._fromEmailAndCode(e,r.code,r.tenantId)}}fH.PROVIDER_ID="password",fH.EMAIL_PASSWORD_SIGN_IN_METHOD="password",fH.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class fW{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class fQ extends fW{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class fJ extends fQ{constructor(){super("facebook.com")}static credential(e){return fV._fromParams({providerId:fJ.PROVIDER_ID,signInMethod:fJ.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return fJ.credentialFromTaggedObject(e)}static credentialFromError(e){return fJ.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return fJ.credential(e.oauthAccessToken)}catch{return null}}}fJ.FACEBOOK_SIGN_IN_METHOD="facebook.com",fJ.PROVIDER_ID="facebook.com";class fY extends fQ{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return fV._fromParams({providerId:fY.PROVIDER_ID,signInMethod:fY.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return fY.credentialFromTaggedObject(e)}static credentialFromError(e){return fY.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return fY.credential(t,r)}catch{return null}}}fY.GOOGLE_SIGN_IN_METHOD="google.com",fY.PROVIDER_ID="google.com";class fX extends fQ{constructor(){super("github.com")}static credential(e){return fV._fromParams({providerId:fX.PROVIDER_ID,signInMethod:fX.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return fX.credentialFromTaggedObject(e)}static credentialFromError(e){return fX.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return fX.credential(e.oauthAccessToken)}catch{return null}}}fX.GITHUB_SIGN_IN_METHOD="github.com",fX.PROVIDER_ID="github.com";class fZ extends fQ{constructor(){super("twitter.com")}static credential(e,t){return fV._fromParams({providerId:fZ.PROVIDER_ID,signInMethod:fZ.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return fZ.credentialFromTaggedObject(e)}static credentialFromError(e){return fZ.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return fZ.credential(t,r)}catch{return null}}}fZ.TWITTER_SIGN_IN_METHOD="twitter.com",fZ.PROVIDER_ID="twitter.com";class f0{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){return new f0({user:await d9._fromIdTokenResponse(e,r,n),providerId:f1(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new f0({user:e,providerId:f1(r),_tokenResponse:r,operationType:t})}}function f1(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class f2 extends et{constructor(e,t,r,n){super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,f2.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new f2(e,t,r,n)}}function f5(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw f2._fromErrorAndOperation(e,r,t,n);throw r})}async function f6(e,t,r=!1){let n=await dZ(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return f0._forOperation(e,"link",n)}async function f4(e,t,r=!1){let{auth:n}=e;if(eX(n.app))return Promise.reject(dE(n));let s="reauthenticate";try{let i=await dZ(e,f5(n,s,t,e),r);dN(i.idToken,n,"internal-error");let a=dY(i.idToken);dN(a,n,"internal-error");let{sub:o}=a;return dN(e.uid===o,n,"user-mismatch"),f0._forOperation(e,s,i)}catch(e){throw e?.code==="auth/user-not-found"&&dw(n,"user-mismatch"),e}}async function f3(e,t,r=!1){if(eX(e.app))return Promise.reject(dE(e));let n="signIn",s=await f5(e,n,t),i=await f0._fromIdTokenResponse(e,n,s);return r||await e._updateCurrentUser(i.user),i}async function f8(e,t){return f3(ed(e),t)}class f7{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?f9._fromServerResponse(e,t):"totpInfo"in t?pe._fromServerResponse(e,t):dw(e,"internal-error")}}class f9 extends f7{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new f9(t)}}class pe extends f7{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new pe(t)}}async function pt(e){let t=ed(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}function pr(e,t){return dL(e,"POST","/v2/accounts/mfaEnrollment:start",dM(e,t))}new WeakMap;let pn="__sak";class ps{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(pn,"1"),this.storage.removeItem(pn),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class pi extends ps{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=fp(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let r=this.storage.getItem(t),n=this.localCache[t];r!==n&&e(t,n,r)}}onStorageEvent(e,t=!1){let r;if(!e.key)return void this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)});let n=e.key;t?this.detachListener():this.stopPolling();let s=()=>{let e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);((r=K()).indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0)&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,10):s()}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}pi.type="LOCAL";class pa extends ps{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}pa.type="SESSION";class po{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let r=new po(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:r,data:n}=e.data,s=this.handlersMap[r];if(!s?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:r});let i=Array.from(s).map(async t=>t(e.origin,n)),a=await Promise.all(i.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function pl(e="",t=10){let r="";for(let e=0;e<t;e++)r+=Math.floor(10*Math.random());return e+r}po.receivers=[];class pc{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let n,s,i="u">typeof MessageChannel?new MessageChannel:null;if(!i)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=pl("",20);i.port1.start();let c=setTimeout(()=>{o(Error("unsupported_event"))},r);s={messageChannel:i,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(c),n=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(n),a(e.data.response);break;default:clearTimeout(c),clearTimeout(n),o(Error("invalid_response"))}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}function pu(){return window}function ph(){return void 0!==pu().WorkerGlobalScope&&"function"==typeof pu().importScripts}async function pd(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let pf="firebaseLocalStorageDb",pp="firebaseLocalStorage",pm="fbase_key";class pg{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function py(e,t){return e.transaction([pp],t?"readwrite":"readonly").objectStore(pp)}function pb(){let e=indexedDB.open(pf,1);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(pp,{keyPath:pm})}catch(e){r(e)}}),e.addEventListener("success",async()=>{let r=e.result;r.objectStoreNames.contains(pp)?t(r):(r.close(),await new pg(indexedDB.deleteDatabase(pf)).toPromise(),t(await pb()))})})}async function px(e,t,r){return new pg(py(e,!0).put({[pm]:t,value:r})).toPromise()}async function pv(e,t){let r=py(e,!1).get(t),n=await new pg(r).toPromise();return void 0===n?null:n.value}function pw(e,t){return new pg(py(e,!0).delete(t)).toPromise()}class pI{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await pb()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ph()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=po._getInstance(ph()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await pd(),!this.activeServiceWorker)return;this.sender=new pc(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await pb();return await px(e,pn,"1"),await pw(e,pn),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>px(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>pv(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>pw(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new pg(py(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],r=new Set;if(0!==e.length)for(let{fbase_key:n,value:s}of e)r.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(s)&&(this.notifyListeners(n,s),t.push(n));for(let e of Object.keys(this.localCache))this.localCache[e]&&!r.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function p_(e,t){return dL(e,"POST","/v2/accounts/mfaSignIn:start",dM(e,t))}pI.type="LOCAL",fI("rcb"),new dA(3e4,6e4);let pE="recaptcha";async function pT(e,t,r){if(!e._getRecaptchaConfig())try{await fk(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let n;if(n="string"==typeof t?{phoneNumber:t}:t,"session"in n){let t=n.session;if("phoneNumber"in n){dN("enroll"===t.type,e,"internal-error");let s={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:n.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},i=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===fT){dN(r?.type===pE,e,"argument-error");let n=await pN(e,t,r);return pr(e,n)}return pr(e,t)},a=fC(e,s,"mfaSmsEnrollment",i,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{dN("signin"===t.type,e,"internal-error");let s=n.multiFactorHint?.uid||n.multiFactorUid;dN(s,e,"missing-multi-factor-info");let i={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===fT){dN(r?.type===pE,e,"argument-error");let n=await pN(e,t,r);return p_(e,n)}return p_(e,t)},o=fC(e,i,"mfaSmsSignIn",a,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:n.phoneNumber,clientType:"CLIENT_TYPE_WEB"},s=async(e,t)=>{if(t.captchaResponse===fT){dN(r?.type===pE,e,"argument-error");let n=await pN(e,t,r);return fU(e,n)}return fU(e,t)},i=fC(e,t,"sendVerificationCode",s,"PHONE_PROVIDER");return(await i.catch(e=>Promise.reject(e))).sessionInfo}}finally{r?._reset()}}async function pN(e,t,r){dN(r.type===pE,e,"argument-error");let n=await r.verify();dN("string"==typeof n,e,"argument-error");let s={...t};if("phoneEnrollmentInfo"in s){let e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,r=s.phoneEnrollmentInfo.clientType,i=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:n,captchaResponse:t,clientType:r,recaptchaVersion:i}}),s}if(!("phoneSignInInfo"in s))return Object.assign(s,{recaptchaToken:n}),s;{let e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,r=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:n,captchaResponse:e,clientType:t,recaptchaVersion:r}}),s}}class pS{constructor(e){this.providerId=pS.PROVIDER_ID,this.auth=ed(e)}verifyPhoneNumber(e,t){return pT(this.auth,e,ed(t))}static credential(e,t){return fG._fromVerification(e,t)}static credentialFromResult(e){return pS.credentialFromTaggedObject(e)}static credentialFromError(e){return pS.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:r}=e;return t&&r?fG._fromTokenResponse(t,r):null}}pS.PROVIDER_ID="phone",pS.PHONE_SIGN_IN_METHOD="phone";class pC extends fD{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fF(e,this._buildIdpRequest())}_linkToIdToken(e,t){return fF(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return fF(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function pk(e){return f3(e.auth,new pC(e),e.bypassAuthState)}function pA(e){let{auth:t,user:r}=e;return dN(r,t,"internal-error"),f4(r,new pC(e),e.bypassAuthState)}async function pj(e){let{auth:t,user:r}=e;return dN(r,t,"internal-error"),f6(r,new pC(e),e.bypassAuthState)}class pD{constructor(e,t,r,n,s=!1){this.auth=e,this.resolver=r,this.user=n,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:n,tenantId:s,error:i,type:a}=e;if(i)return void this.reject(i);let o={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return pk;case"linkViaPopup":case"linkViaRedirect":return pj;case"reauthViaPopup":case"reauthViaRedirect":return pA;default:dw(this.auth,"internal-error")}}resolve(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||dS(r),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||dS(r),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let pR=new dA(2e3,1e4);class pP extends pD{constructor(e,t,r,n,s){super(e,t,n,s),this.provider=r,this.authWindow=null,this.pollId=null,pP.currentPopupAction&&pP.currentPopupAction.cancel(),pP.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return dN(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||dS(t);let r=pl();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],r),this.authWindow.associatedEvent=r,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(dI(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(dI(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,pP.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(dI(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,pR.get())};e()}}pP.currentPopupAction=null;let pO=new Map;class pM extends pD{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=pO.get(this.auth._key());if(!e){try{let t=await pL(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}pO.set(this.auth._key(),e)}return this.bypassAuthState||pO.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function pL(e,t){var r;let n=fn("pendingRedirect",(r=t).config.apiKey,r.name),s=ft(e._redirectPersistence);if(!await s._isAvailable())return!1;let i=await s._get(n)==="true";return await s._remove(n),i}function pF(e,t){pO.set(e._key(),t)}async function pV(e,t,r=!1){if(eX(e.app))return Promise.reject(dE(e));let n=ed(e),s=t?ft(t):(dN(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver),i=new pM(n,s,r),a=await i.execute();return a&&!r&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,t)),a}class pU{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return pq(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!pq(e)){let r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(dI(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(pB(e))}saveEventToCache(e){this.cachedEventUids.add(pB(e)),this.lastProcessedEventTime=Date.now()}}function pB(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function pq({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function pz(e,t={}){return dL(e,"GET","/v1/projects",t)}let p$=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,pG=/^https?/;async function pK(e){if(e.config.emulator)return;let{authorizedDomains:t}=await pz(e);for(let e of t)try{if(function(e){let t=dC(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){let s=new URL(e);return""===s.hostname&&""===n?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&s.hostname===n}if(!pG.test(r))return!1;if(p$.test(e))return n===e;let s=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+s+"|"+s+")$","i").test(n)}(e))return}catch{}dw(e,"unauthorized-domain")}let pH=new dA(3e4,6e4);function pW(){let e=pu().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let pQ=null,pJ=new dA(5e3,15e3),pY={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},pX=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function pZ(e){let t,r,n,s,i,a=await (pQ=pQ||new Promise((t,r)=>{function n(){pW(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{pW(),r(dI(e,"network-request-failed"))},timeout:pH.get()})}if(pu().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(pu().gapi?.load)n();else{var s;let t=fI("iframefcb");return pu()[t]=()=>{gapi.load?n():r(dI(e,"network-request-failed"))},(s=`${fw.gapiScript}?onload=${t}`,fw.loadJS(s)).catch(e=>r(e))}}).catch(e=>{throw pQ=null,e})),o=pu().gapi;return dN(o,e,"internal-error"),a.open({where:document.body,url:(dN((t=e.config).authDomain,e,"auth-domain-config-required"),r=t.emulator?dj(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,n={apiKey:t.apiKey,appName:e.name,v:e6},(s=pX.get(e.config.apiHost))&&(n.eid=s),(i=e._getFrameworks()).length&&(n.fw=i.join(",")),`${r}?${ea(n).slice(1)}`),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:pY,dontclear:!0},t=>new Promise(async(r,n)=>{await t.restyle({setHideOnLeave:!1});let s=dI(e,"network-request-failed"),i=pu().setTimeout(()=>{n(s)},pJ.get());function a(){pu().clearTimeout(i),r(t)}t.ping(a).then(a,()=>{n(s)})}))}let p0={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class p1{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let p2=encodeURIComponent("fac");async function p5(e,t,r,n,s,i){dN(e.config.authDomain,e,"auth-domain-config-required"),dN(e.config.apiKey,e,"invalid-api-key");let a={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:e6,eventId:s};if(t instanceof fW)for(let[r,n]of(t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",!function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())&&(a.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(i||{})))a[r]=n;if(t instanceof fQ){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}for(let t of(e.tenantId&&(a.tid=e.tenantId),Object.keys(a)))void 0===a[t]&&delete a[t];let o=await e._getAppCheckToken(),l=o?`#${p2}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?dj(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${ea(a).slice(1)}${l}`}let p6="webStorageSupport",p4=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=pa,this._completeRedirectFn=pV,this._overrideRedirectResult=pF}async _openPopup(e,t,r,n){var s,i;s=this.eventManagers[e._key()]?.manager,i="_initialize() not called before _openPopup()",s||dS(i);let a=await p5(e,t,r,dC(),n);return function(e,t,r,n=500,s=600){let i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString(),o="",l={...p0,width:n.toString(),height:s.toString(),top:i,left:a},c=K().toLowerCase();r&&(o=fl(c)?"_blank":r),fa(c)&&(t=t||"http://localhost",l.scrollbars="yes");let u=Object.entries(l).reduce((e,[t,r])=>`${e}${t}=${r},`,"");if(function(e=K()){return ff(e)&&!!window.navigator?.standalone}(c)&&"_self"!==o){var h,d;let e,r;return h=t||"",d=o,(e=document.createElement("a")).href=h,e.target=d,(r=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(r),new p1(null)}let f=window.open(t||"",o,u);dN(f,e,"popup-blocked");try{f.focus()}catch(e){}return new p1(f)}(e,a,pl())}async _openRedirect(e,t,r,n){var s;return await this._originValidation(e),s=await p5(e,t,r,dC(),n),pu().location.href=s,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var r;let{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(r="If manager is not set, promise should be",n||dS(r),n)}let n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){let t=await pZ(e),r=new pU(e);return t.register("authEvent",t=>(dN(t?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(p6,{type:p6},r=>{let n=r?.[0]?.[p6];void 0!==n&&t(!!n),dw(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=pK(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return fp()||fo()||ff()}};var p3="@firebase/auth",p8="1.12.0";class p7{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){dN(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let p9=V("authIdTokenMaxAge")||300,me=null;fw={loadJS:e=>new Promise((t,r)=>{let n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=e=>{let t=dI("internal-error");t.customData=e,r(t)},n.type="text/javascript",n.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},c="Browser",eH(new ef("auth",(e,{options:t})=>{let r,n,s=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=s.options;dN(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});let u=new fx(s,i,a,{apiKey:o,authDomain:l,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:fm(c)});return n=(Array.isArray(r=t?.persistence||[])?r:[r]).map(ft),t?.errorMap&&u._updateErrorMap(t.errorMap),u._initializeWithPersistence(n,t?.popupRedirectResolver),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),eH(new ef("auth-internal",e=>new p7(ed(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),te(p3,p8,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(c)),te(p3,p8,"esm2020"),e.s([],58556),e.i(58556);let mt="@firebase/installations",mr="0.6.19",mn=`w:${mr}`,ms="FIS_v2",mi=new er("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function ma(e){return e instanceof et&&e.code.includes("request-failed")}function mo({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function ml(e){return{token:e.token,requestStatus:2,expiresIn:Number(e.expiresIn.replace("s","000")),creationTime:Date.now()}}async function mc(e,t){let r=(await t.json()).error;return mi.create("request-failed",{requestName:e,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function mu({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function mh(e){let t=await e();return t.status>=500&&t.status<600?e():t}async function md({appConfig:e,heartbeatServiceProvider:t},{fid:r}){let n=mo(e),s=mu(e),i=t.getImmediate({optional:!0});if(i){let e=await i.getHeartbeatsHeader();e&&s.append("x-firebase-client",e)}let a={method:"POST",headers:s,body:JSON.stringify({fid:r,authVersion:ms,appId:e.appId,sdkVersion:mn})},o=await mh(()=>fetch(n,a));if(o.ok){let e=await o.json();return{fid:e.fid||r,registrationStatus:2,refreshToken:e.refreshToken,authToken:ml(e.authToken)}}throw await mc("Create Installation",o)}function mf(e){return new Promise(t=>{setTimeout(t,e)})}let mp=/^[cdef][\w-]{21}$/;function mm(e){return`${e.appName}!${e.appId}`}let mg=new Map;function my(e,t){var r,n;let s,i=mm(e);mb(i,t),r=i,n=t,(s=(!mx&&"BroadcastChannel"in self&&((mx=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{mb(e.data.key,e.data.fid)}),mx))&&s.postMessage({key:r,fid:n}),0===mg.size&&mx&&(mx.close(),mx=null)}function mb(e,t){let r=mg.get(e);if(r)for(let e of r)e(t)}let mx=null,mv="firebase-installations-store",mw=null;function mI(){return mw||(mw=ej("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(mv)}})),mw}async function m_(e,t){let r=mm(e),n=(await mI()).transaction(mv,"readwrite"),s=n.objectStore(mv),i=await s.get(r);return await s.put(t,r),await n.done,i&&i.fid===t.fid||my(e,t.fid),t}async function mE(e){let t=mm(e),r=(await mI()).transaction(mv,"readwrite");await r.objectStore(mv).delete(t),await r.done}async function mT(e,t){let r=mm(e),n=(await mI()).transaction(mv,"readwrite"),s=n.objectStore(mv),i=await s.get(r),a=t(i);return void 0===a?await s.delete(r):await s.put(a,r),await n.done,a&&(!i||i.fid!==a.fid)&&my(e,a.fid),a}async function mN(e){let t,r=await mT(e.appConfig,r=>{let n=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(mi.create("app-offline"))};let r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=mS(e,r);return{installationEntry:r,registrationPromise:n}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:mC(e)}:{installationEntry:t}}(e,mA(r||{fid:function(){try{var e;let t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;let r=(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22));return mp.test(r)?r:""}catch{return""}}(),registrationStatus:0}));return t=n.registrationPromise,n.installationEntry});return""===r.fid?{installationEntry:await t}:{installationEntry:r,registrationPromise:t}}async function mS(e,t){try{let r=await md(e,t);return m_(e.appConfig,r)}catch(r){throw ma(r)&&409===r.customData.serverCode?await mE(e.appConfig):await m_(e.appConfig,{fid:t.fid,registrationStatus:0}),r}}async function mC(e){let t=await mk(e.appConfig);for(;1===t.registrationStatus;)await mf(100),t=await mk(e.appConfig);if(0===t.registrationStatus){let{installationEntry:t,registrationPromise:r}=await mN(e);return r||t}return t}function mk(e){return mT(e,e=>{if(!e)throw mi.create("installation-not-found");return mA(e)})}function mA(e){var t;return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function mj({appConfig:e,heartbeatServiceProvider:t},r){let n=function(e,{fid:t}){return`${mo(e)}/${t}/authTokens:generate`}(e,r),s=function(e,{refreshToken:t}){var r;let n=mu(e);return n.append("Authorization",(r=t,`${ms} ${r}`)),n}(e,r),i=t.getImmediate({optional:!0});if(i){let e=await i.getHeartbeatsHeader();e&&s.append("x-firebase-client",e)}let a={method:"POST",headers:s,body:JSON.stringify({installation:{sdkVersion:mn,appId:e.appId}})},o=await mh(()=>fetch(n,a));if(o.ok)return ml(await o.json());throw await mc("Generate Auth Token",o)}async function mD(e,t=!1){let r,n=await mT(e.appConfig,n=>{var s,i,a;let o;if(!mM(n))throw mi.create("not-registered");let l=n.authToken;if(!t&&2===(s=l).requestStatus&&(i=s,!((o=Date.now())<i.creationTime)&&!(i.creationTime+i.expiresIn<o+36e5)))return n;if(1===l.requestStatus)return r=mR(e,t),n;{let t;if(!navigator.onLine)throw mi.create("app-offline");let s=(a=n,t={requestStatus:1,requestTime:Date.now()},{...a,authToken:t});return r=mO(e,s),s}});return r?await r:n.authToken}async function mR(e,t){let r=await mP(e.appConfig);for(;1===r.authToken.requestStatus;)await mf(100),r=await mP(e.appConfig);let n=r.authToken;return 0===n.requestStatus?mD(e,t):n}function mP(e){return mT(e,e=>{var t;if(!mM(e))throw mi.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?{...e,authToken:{requestStatus:0}}:e})}async function mO(e,t){try{let r=await mj(e,t),n={...t,authToken:r};return await m_(e.appConfig,n),r}catch(r){if(ma(r)&&(401===r.customData.serverCode||404===r.customData.serverCode))await mE(e.appConfig);else{let r={...t,authToken:{requestStatus:0}};await m_(e.appConfig,r)}throw r}}function mM(e){return void 0!==e&&2===e.registrationStatus}async function mL(e){let{installationEntry:t,registrationPromise:r}=await mN(e);return r?r.catch(console.error):mD(e).catch(console.error),t.fid}async function mF(e,t=!1){return await mV(e),(await mD(e,t)).token}async function mV(e){let{registrationPromise:t}=await mN(e);t&&await t}function mU(e){return mi.create("missing-app-config-values",{valueName:e})}let mB="installations";eH(new ef(mB,e=>{let t=e.getProvider("app").getImmediate(),r=function(e){if(!e||!e.options)throw mU("App Configuration");if(!e.name)throw mU("App Name");for(let t of["projectId","apiKey","appId"])if(!e.options[t])throw mU(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),n=eW(t,"heartbeat");return{app:t,appConfig:r,heartbeatServiceProvider:n,_delete:()=>Promise.resolve()}},"PUBLIC")),eH(new ef("installations-internal",e=>{let t=eW(e.getProvider("app").getImmediate(),mB).getImmediate();return{getId:()=>mL(t),getToken:e=>mF(t,e)}},"PRIVATE")),te(mt,mr),te(mt,mr,"esm2020");let mq="analytics",mz="https://www.googletagmanager.com/gtag/js",m$=new eI("@firebase/analytics"),mG=new er("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function mK(e){if(!e.startsWith(mz)){let t=mG.create("invalid-gtag-resource",{gtagURL:e});return m$.warn(t.message),""}return e}function mH(e){return Promise.all(e.map(e=>e.catch(e=>e)))}async function mW(e,t,r,n,s,i){let a=n[s];try{if(a)await t[a];else{let e=(await mH(r)).find(e=>e.measurementId===s);e&&await t[e.appId]}}catch(e){m$.error(e)}e("config",s,i)}async function mQ(e,t,r,n,s){try{let i=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);let n=await mH(r);for(let r of e){let e=n.find(e=>e.measurementId===r),s=e&&t[e.appId];if(s)i.push(s);else{i=[];break}}}0===i.length&&(i=Object.values(t)),await Promise.all(i),e("event",n,s||{})}catch(e){m$.error(e)}}let mJ=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function mY(e){let{appId:t,apiKey:r}=e,n={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":r})},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",t),i=await fetch(s,n);if(200!==i.status&&304!==i.status){let e="";try{let t=await i.json();t.error?.message&&(e=t.error.message)}catch(e){}throw mG.create("config-fetch-failed",{httpStatus:i.status,responseMessage:e})}return i.json()}async function mX(e,t=mJ,r){let{appId:n,apiKey:s,measurementId:i}=e.options;if(!n)throw mG.create("no-app-id");if(!s){if(i)return{measurementId:i,appId:n};throw mG.create("no-api-key")}let a=t.getThrottleMetadata(n)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new m0;return setTimeout(async()=>{o.abort()},void 0!==r?r:6e4),mZ({appId:n,apiKey:s,measurementId:i},a,o,t)}async function mZ(e,{throttleEndTimeMillis:t,backoffCount:r},n,s=mJ){let{appId:i,measurementId:a}=e;try{var o,l;await (o=n,l=t,new Promise((e,t)=>{let r=setTimeout(e,Math.max(l-Date.now(),0));o.addEventListener(()=>{clearTimeout(r),t(mG.create("fetch-throttle",{throttleEndTimeMillis:l}))})}))}catch(e){if(a)return m$.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${e?.message}]`),{appId:i,measurementId:a};throw e}try{let t=await mY(e);return s.deleteThrottleMetadata(i),t}catch(l){if(!function(e){if(!(e instanceof et)||!e.customData)return!1;let t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(l)){if(s.deleteThrottleMetadata(i),a)return m$.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l?.message}]`),{appId:i,measurementId:a};throw l}let t=503===Number(l?.customData?.httpStatus)?eh(r,s.intervalMillis,30):eh(r,s.intervalMillis),o={throttleEndTimeMillis:Date.now()+t,backoffCount:r+1};return s.setThrottleMetadata(i,o),m$.debug(`Calling attemptFetch again in ${t} millis`),mZ(e,o,n,s)}}class m0{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function m1(e,t,r,n,s){if(s&&s.global)return void e("event",r,n);{let s=await t;e("event",r,{...n,send_to:s})}}async function m2(e,t,r,n){if(n&&n.global){let t={};for(let e of Object.keys(r))t[`user_properties.${e}`]=r[e];return e("set",t),Promise.resolve()}e("config",await t,{update:!0,user_properties:r})}async function m5(){if(!X())return m$.warn(mG.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await Z()}catch(e){return m$.warn(mG.create("indexeddb-unavailable",{errorInfo:e?.toString()}).message),!1}return!0}async function m6(e,t,r,i,a,o,l){var c,u;let h,d,f,p,m=mX(e);m.then(t=>{r[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&m$.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>m$.error(e)),t.push(m);let g=m5().then(e=>e?i.getId():void 0),[y,b]=await Promise.all([m,g]);!function(e){for(let t of Object.values(window.document.getElementsByTagName("script")))if(t.src&&t.src.includes(mz)&&t.src.includes(e))return t;return null}(o)&&(c=y.measurementId,u={createScriptURL:mK},window.trustedTypes&&(h=window.trustedTypes.createPolicy("firebase-js-sdk-policy",u)),d=h,f=document.createElement("script"),p=`${mz}?l=${o}&id=${c}`,f.src=d?d?.createScriptURL(p):p,f.async=!0,document.head.appendChild(f)),s&&(a("consent","default",s),s=void 0),a("js",new Date);let x=l?.config??{};return x.origin="firebase",x.update=!0,null!=b&&(x.firebase_id=b),a("config",y.measurementId,x),n&&(a("set",n),n=void 0),y.measurementId}class m4{constructor(e){this.app=e}_delete(){return delete m3[this.app.options.appId],Promise.resolve()}}let m3={},m8=[],m7={},m9="dataLayer",ge=!1;async function gt(){if(Q()||!ee()||!X())return!1;try{return await Z()}catch(e){return!1}}let gr="@firebase/analytics",gn="0.10.19";eH(new ef(mq,(e,{options:t})=>(function(e,t,r){let n=[];if(Q()&&n.push("This is a browser extension environment."),ee()||n.push("Cookies are not available."),n.length>0){let e=n.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=mG.create("invalid-analytics-context",{errorInfo:e});m$.warn(t.message)}let s=e.options.appId;if(!s)throw mG.create("no-app-id");if(!e.options.apiKey)if(e.options.measurementId)m$.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw mG.create("no-api-key");if(null!=m3[s])throw mG.create("already-exists",{id:s});if(!ge){var o,l;let e,t;e=[],Array.isArray(window[m9])?e=window[m9]:window[m9]=e;let{wrappedGtag:r,gtagCore:n}=(o="gtag",t=function(){window[m9].push(arguments)},window[o]&&"function"==typeof window[o]&&(t=window[o]),window[o]=(l=t,async function(e,...t){try{if("event"===e){let[e,r]=t;await mQ(l,m3,m8,e,r)}else if("config"===e){let[e,r]=t;await mW(l,m3,m8,m7,e,r)}else if("consent"===e){let[e,r]=t;l("consent",e,r)}else if("get"===e){let[e,r,n]=t;l("get",e,r,n)}else if("set"===e){let[e]=t;l("set",e)}else l(e,...t)}catch(e){m$.error(e)}}),{gtagCore:t,wrappedGtag:window[o]});a=r,i=n,ge=!0}return m3[s]=m6(e,m8,m7,t,i,m9,r),new m4(e)})(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),eH(new ef("analytics-internal",function(e){try{let t=e.getProvider(mq).getImmediate();return{logEvent:(e,r,n)=>{var s;return s=t,void(s=ed(s),m1(a,m3[s.app.options.appId],e,r,n).catch(e=>m$.error(e)))},setUserProperties:(e,r)=>{var n;return n=t,void(n=ed(n),m2(a,m3[n.app.options.appId],e,r).catch(e=>m$.error(e)))}}}catch(e){throw mG.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),te(gr,gn),te(gr,gn,"esm2020");let gs=0===e7().length?e4({apiKey:"AIzaSyBzIxWGRtcmjMafcRud91WGJTnSpJhYx7c",authDomain:"tupresulisto.firebaseapp.com",projectId:"tupresulisto",storageBucket:"tupresulisto.firebasestorage.app",messagingSenderId:"755896919636",appId:"1:755896919636:web:ab79e04b27f974ebf2afc1",measurementId:"G-B7VXNVG8JJ"}):e7()[0];var gi=gs;let ga=eW("object"==typeof gi?gi:e8(),"firestore").getImmediate({identifier:"string"==typeof gi?gi:nK});if(!ga._initialized){let e=(e=>{let t=L(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]})("firestore");e&&function(e,t,r,n={}){e=t0(e,uc);let s=B(t),i=e._getSettings(),a={...i,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;s&&(q(`https://${o}`),G("Firestore",!0)),i.host!==uo&&i.host!==o&&tE("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...i,host:o,ssl:s,emulatorOptions:n};if(!es(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=tb.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r=t||"demo-project",n=e.iat||0,s=e.sub||e.user_id;if(!s)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let i={iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...e};return[R(JSON.stringify({alg:"none",type:"JWT"})),R(JSON.stringify(i)),""].join(".")}(n.mockUserToken,e._app?.options.projectId);let s=n.mockUserToken.sub||n.mockUserToken.user_id;if(!s)throw new tA(tk.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new tb(s)}e._authCredentials=new tP(new tD(t,r))}}(ga,...e)}let go=function(e=e8()){let t=eW(e,"auth");if(t.isInitialized())return t.getImmediate();let r=function(e,t){let r=eW(e,"auth");if(r.isInitialized()){let e=r.getImmediate();if(es(r.getOptions(),t??{}))return e;dw(e,"already-initialized")}return r.initialize({options:t})}(e,{popupRedirectResolver:p4,persistence:[pI,pi,pa]}),n=V("authTokenSyncURL");if(n&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(n,location.origin);if(location.origin===e.origin){let t,n=(t=e.toString(),async e=>{let r=e&&await e.getIdTokenResult(),n=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(n&&n>p9)return;let s=r?.token;me!==s&&(me=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))});ed(r).beforeAuthStateChanged(n,()=>n(r.currentUser)),ed(r).onIdTokenChanged(e=>n(e),void 0,void 0)}}let s=L("auth");return s&&function(e,t,r){let n=ed(e);dN(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");let s=fA(t),{host:i,port:a}=function(e){let t=fA(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let n=r[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(n);if(s){let e=s[1];return{host:e,port:fj(n.substr(e.length+1))}}{let[e,t]=n.split(":");return{host:e,port:fj(t)}}}(t),o=null===a?"":`:${a}`,l={url:`${s}//${i}${o}/`},c=Object.freeze({host:i,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!n._canInitEmulator){dN(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),dN(es(l,n.config.emulator)&&es(c,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=l,n.emulatorConfig=c,n.settings.appVerificationDisabledForTesting=!0,B(i)?(q(`${s}//${i}${o}`),G("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"u">typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"u">typeof window&&"u">typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(r,`http://${s}`),r}(gs);gt().then(e=>{e&&function(e=e8()){let t=eW(e=ed(e),mq);t.isInitialized()?t.getImmediate():function(e,t={}){let r=eW(e,mq);if(r.isInitialized()){if(r.getImmediate(),es(t,r.getOptions()))return;throw mG.create("already-initialized")}r.initialize({options:t})}(e)}(gs)});let gl=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},gc=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var gu={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let gh=(0,N.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:s="",children:i,iconNode:a,...o},l)=>(0,N.createElement)("svg",{ref:l,...gu,width:t,height:t,stroke:e,strokeWidth:n?24*Number(r)/Number(t):r,className:gc("lucide",s),...!i&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(o)&&{"aria-hidden":"true"},...o},[...a.map(([e,t])=>(0,N.createElement)(e,t)),...Array.isArray(i)?i:[i]])),gd=(e,t)=>{let r=(0,N.forwardRef)(({className:r,...n},s)=>(0,N.createElement)(gh,{ref:s,iconNode:t,className:gc(`lucide-${gl(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,r),...n}));return r.displayName=gl(e),r},gf=gd("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),gp=({onLoginSuccess:e})=>{let[t,r]=(0,N.useState)("demo@tupresulisto.com"),[n,s]=(0,N.useState)("123456"),[i,a]=(0,N.useState)(!1),[o,l]=(0,N.useState)(""),c=async r=>{r.preventDefault(),a(!0),l("");try{let r=await (eX(go.app)?Promise.reject(dE(go)):f8(ed(go),fH.credential(t,n)).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&pt(go),e}));e&&e(r.user)}catch(e){console.error(e),l("Error al iniciar sesin. Verifica tus credenciales."),a(!1)}};return(0,T.jsx)("div",{className:"h-screen w-full bg-slate-900 flex items-center justify-center p-4",children:(0,T.jsxs)("div",{className:"bg-white w-full max-w-md rounded-2xl p-8 shadow-2xl animate-fade-in",children:[(0,T.jsxs)("div",{className:"text-center mb-8",children:[(0,T.jsxs)("h1",{className:"text-3xl font-black text-slate-900 tracking-tight",children:["tupresulisto",(0,T.jsx)("span",{className:"text-sky-600",children:".com"})]}),(0,T.jsx)("p",{className:"text-slate-500 mt-2",children:"Gestin profesional para carpintera"})]}),o&&(0,T.jsx)("div",{className:"mb-4 p-3 bg-red-50 text-red-500 text-sm rounded-lg border border-red-100",children:o}),(0,T.jsxs)("form",{onSubmit:c,className:"space-y-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-xs font-bold text-slate-700 mb-1",children:"EMAIL"}),(0,T.jsx)("input",{type:"email",required:!0,className:"w-full input-saas p-3 rounded-lg text-slate-900",placeholder:"usuario@empresa.com",value:t,onChange:e=>r(e.target.value)})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"block text-xs font-bold text-slate-700 mb-1",children:"CONTRASEA"}),(0,T.jsx)("input",{type:"password",required:!0,className:"w-full input-saas p-3 rounded-lg text-slate-900",placeholder:"",value:n,onChange:e=>s(e.target.value)})]}),(0,T.jsx)("button",{disabled:i,className:"w-full py-3 flex items-center justify-center px-4 rounded-lg font-semibold transition-all duration-200 bg-sky-600 text-white hover:bg-sky-500 shadow-lg shadow-sky-500/30 disabled:opacity-50",children:i?"Accediendo...":(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(gf,{className:"mr-2",size:18})," Iniciar Sesin Segura"]})})]})]})})},gm="app_data",gg={open:()=>new Promise((e,t)=>{let r=indexedDB.open("TuPresuListoDB",1);r.onupgradeneeded=e=>{e.target.result.createObjectStore(gm)},r.onsuccess=t=>e(t.target.result),r.onerror=e=>t(e.target.error)}),get:async e=>{let t=await gg.open();return t?new Promise((r,n)=>{let s=t.transaction(gm,"readonly").objectStore(gm).get(e);s.onsuccess=()=>r(s.result),s.onerror=()=>n(s.error)}):null},set:async(e,t)=>{let r=await gg.open();if(r)return new Promise((n,s)=>{let i=r.transaction(gm,"readwrite").objectStore(gm).put(t,e);i.onsuccess=()=>n(),i.onerror=()=>s(i.error)})}},gy=(0,N.createContext)(),gb=({children:e})=>{let[t,r]=(0,N.useState)([]);return(0,T.jsxs)(gy.Provider,{value:(e,t="info")=>{let n=Date.now();r(r=>[...r,{id:n,msg:e,type:t}]),setTimeout(()=>r(e=>e.filter(e=>e.id!==n)),3e3)},children:[e,(0,T.jsx)("div",{className:"fixed top-4 right-4 z-[9999] space-y-2 pointer-events-none",children:t.map(e=>(0,T.jsxs)("div",{className:`pointer-events-auto min-w-[250px] p-3 rounded-lg shadow-xl border flex items-center gap-3 animate-slide-up bg-white ${"error"===e.type?"border-red-500 text-red-600":"success"===e.type?"border-green-500 text-green-700":"border-blue-500 text-blue-700"}`,children:[(0,T.jsx)("div",{className:`w-2 h-2 rounded-full ${"error"===e.type?"bg-red-500":"success"===e.type?"bg-green-500":"bg-blue-500"}`}),(0,T.jsx)("span",{className:"text-sm font-bold",children:e.msg})]},e.id))})]})},gx=()=>(0,N.useContext)(gy),gv=gd("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),gw=gd("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]),gI=gd("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),g_=gd("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),gE=gd("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),gT=gd("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),gN=gd("box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),gS=gd("chart-no-axes-column",[["path",{d:"M5 21v-6",key:"1hz6c0"}],["path",{d:"M12 21V3",key:"1lcnhd"}],["path",{d:"M19 21V9",key:"unv183"}]]),gC=gd("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),gk=gd("list",[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]]),gA=gd("target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),gj=gd("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),gD=e=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(e||0),gR=({data:e,color:t})=>{let r=Math.max(...e.map(e=>e.value));return(0,T.jsxs)("div",{className:"h-48 flex items-end gap-2 p-2 border-b border-l border-slate-200",children:[e.map((e,n)=>(0,T.jsxs)("div",{className:"flex-1 flex flex-col items-center group relative",children:[" ",(0,T.jsxs)("div",{className:"w-full bg-blue-100 rounded-t hover:bg-blue-200 transition-all relative group-hover:shadow-lg",style:{height:`${e.value/r*100}%`,backgroundColor:t},children:[" ",(0,T.jsx)("span",{className:"opacity-0 group-hover:opacity-100 absolute -top-8 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-xs rounded px-2 py-1 transition-opacity z-10 whitespace-nowrap",children:e.value})," "]})," ",(0,T.jsx)("span",{className:"text-[10px] text-slate-500 mt-1 rotate-0 truncate w-full text-center",children:e.label})," "]},n))," "]})},gP=({data:e})=>{let t=e.reduce((e,t)=>e+t.value,0),r=0,n=e.map(e=>{let n=e.value/t*100,s=r;return r+=n,`${e.color} ${s}% ${r}%`}),s={background:`conic-gradient(${n.join(", ")})`};return(0,T.jsxs)("div",{className:"flex items-center gap-6",children:[" ",(0,T.jsx)("div",{className:"w-32 h-32 rounded-full shadow-inner shrink-0",style:s})," ",(0,T.jsxs)("div",{className:"flex-1 space-y-1",children:[" ",e.map((e,r)=>(0,T.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[" ",(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),(0,T.jsx)("span",{className:"truncate max-w-[100px]",children:e.label})]})," ",(0,T.jsxs)("span",{className:"font-bold",children:[Math.round(e.value/t*100),"%"]})," "]},r))," "]})," "]})},gO=({history:e,products:t,clients:r,onNavigate:n,config:s})=>{let[i,a]=(0,N.useState)("all"),[o,l]=(0,N.useState)("all"),[c,u]=(0,N.useState)(null),[h,d]=(0,N.useState)(5),f=(e,t)=>{if(!e||"all"===t)return!0;let[r,n,s]=e.split("/").map(Number),i=new Date(s,n-1,r),a=new Date,o=Math.ceil(Math.abs(a-i)/864e5);return"day"===t?o<=1:"week"===t?o<=7:"month"===t?a.getMonth()===i.getMonth()&&a.getFullYear()===i.getFullYear():"year"!==t||a.getFullYear()===i.getFullYear()},p=(0,N.useMemo)(()=>e.filter(e=>"accepted"===e.status&&f(e.date,i)),[e,i]),m=(0,N.useMemo)(()=>e.filter(e=>f(e.date,o)),[e,o]),g=(0,N.useMemo)(()=>e.filter(e=>!e.status||"pending"===e.status),[e]),y=(0,N.useMemo)(()=>{let t=p.reduce((e,t)=>e+t.grandTotal,0),r=g.reduce((e,t)=>e+t.grandTotal,0),n={};e.forEach(e=>e.items.forEach(e=>{n[e.product.name]=(n[e.product.name]||0)+e.quantity}));let s=Object.entries(n).sort((e,t)=>t[1]-e[1]),i=s[0],a={accepted:0,rejected:0,pending:0};e.forEach(e=>{"accepted"===e.status?a.accepted++:"rejected"===e.status?a.rejected++:a.pending++});let o={},l=new Date;for(let e=5;e>=0;e--)o[new Date(l.getFullYear(),l.getMonth()-e,1).toLocaleString("default",{month:"short"})]=0;e.forEach(e=>{if("accepted"===e.status){let[t,r,n]=e.date.split("/"),s=new Date(n,r-1,t).toLocaleString("default",{month:"short"});void 0!==o[s]&&(o[s]+=e.grandTotal)}});let c=Object.entries(o).map(([e,t])=>({label:e,value:Math.round(t)})),u={},h=0;e.forEach(e=>{if("accepted"===e.status){let t=e.client.source||"Desconocido";u[t]=(u[t]||0)+1,h++}});let d=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#64748b"],f=Object.entries(u).sort((e,t)=>t[1]-e[1]).map(([e,t],r)=>({label:e,value:t,color:d[r%d.length]}));return{totalSales:t,pendingAmount:r,ranking:s,bestSeller:i,totalQuotes:m.length,statusCounts:a,chartData:c,sourceChartData:f,totalSources:h}},[e,p,m,g]),b=({title:e,onClose:t,children:r,maxWidth:n="max-w-2xl"})=>(0,T.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm modal-overlay animate-fade-in",onClick:t,children:(0,T.jsxs)("div",{className:`bg-white rounded-2xl w-full ${n} max-h-[85vh] flex flex-col shadow-2xl overflow-hidden animate-pop`,onClick:e=>e.stopPropagation(),children:[(0,T.jsxs)("div",{className:"p-4 border-b flex justify-between items-center bg-slate-50",children:[(0,T.jsx)("h3",{className:"font-bold text-lg",children:e}),(0,T.jsx)("button",{onClick:t,className:"p-2 hover:bg-slate-200 rounded-full",children:(0,T.jsx)(gj,{})})]}),(0,T.jsx)("div",{className:"overflow-y-auto p-0",children:r})]})});return(0,T.jsxs)("div",{className:"p-4 md:p-8 h-full overflow-y-auto animate-fade-in",children:[(0,T.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,T.jsxs)("div",{children:[(0,T.jsxs)("h1",{className:"text-3xl font-black text-slate-800",children:["Hola, ",s.name]}),(0,T.jsx)("p",{className:"text-slate-500 text-sm mt-1",children:"Resumen de actividad."})]}),(0,T.jsx)("div",{className:"hidden md:block text-right",children:(0,T.jsx)("p",{className:"text-sm font-bold text-slate-400 uppercase",children:new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})})})]}),(0,T.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,T.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-5 flex flex-col justify-between h-36 bg-gradient-to-br from-blue-600 to-blue-800 text-white border-none shadow-blue-200 shadow-xl relative overflow-visible cursor-pointer hover:scale-[1.02] transition-transform",onClick:()=>u("sales"),children:[(0,T.jsxs)("div",{className:"flex justify-between items-start z-10",children:[(0,T.jsx)("span",{className:"text-blue-200 font-bold text-xs uppercase",children:"Ventas Aceptadas"}),(0,T.jsxs)("select",{className:"bg-white/20 text-white text-[10px] rounded border-none outline-none p-1 cursor-pointer hover:bg-white/30",value:i,onClick:e=>e.stopPropagation(),onChange:e=>a(e.target.value),children:[(0,T.jsx)("option",{className:"text-black",value:"all",children:"Total"}),(0,T.jsx)("option",{className:"text-black",value:"day",children:"Hoy"}),(0,T.jsx)("option",{className:"text-black",value:"week",children:"Semana"}),(0,T.jsx)("option",{className:"text-black",value:"month",children:"Mes"}),(0,T.jsx)("option",{className:"text-black",value:"year",children:"Ao"})]})]}),(0,T.jsxs)("div",{className:"z-10",children:[(0,T.jsx)("span",{className:"text-3xl font-black",children:gD(y.totalSales)}),(0,T.jsxs)("p",{className:"text-xs text-blue-200 mt-1",children:[p.length," pedidos"]})]}),(0,T.jsx)(gC,{className:"absolute -bottom-4 -right-4 text-white opacity-10 w-24 h-24 rotate-12"})]}),(0,T.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-5 flex flex-col justify-between h-36 cursor-pointer hover:border-orange-300 transition-colors",onClick:()=>u("pending"),children:[(0,T.jsxs)("div",{className:"flex justify-between items-start",children:[(0,T.jsx)("span",{className:"text-slate-400 font-bold text-xs uppercase",children:"Pendiente"}),(0,T.jsx)("div",{className:"p-1 bg-orange-100 rounded text-orange-600",children:(0,T.jsx)(gk,{size:14})})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("span",{className:"text-3xl font-black text-slate-800",children:gD(y.pendingAmount)}),(0,T.jsxs)("p",{className:"text-xs text-slate-400 mt-1",children:[g.length," presupuestos"]})]})]}),(0,T.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-5 flex flex-col justify-between h-36 cursor-pointer hover:border-purple-300 transition-colors",onClick:()=>u("charts"),children:[(0,T.jsxs)("div",{className:"flex justify-between items-start",children:[(0,T.jsx)("span",{className:"text-slate-400 font-bold text-xs uppercase",children:"Presupuestos"}),(0,T.jsx)("div",{className:"p-1 bg-purple-100 rounded text-purple-600",children:(0,T.jsx)(gS,{size:14})})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("span",{className:"text-3xl font-black text-slate-800",children:y.totalQuotes}),(0,T.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:"Ver Anlisis Grfico"})]})]}),(0,T.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-5 flex flex-col justify-between h-36 cursor-pointer hover:border-green-300 transition-colors",onClick:()=>u("ranking"),children:[(0,T.jsxs)("div",{className:"flex justify-between items-start",children:[(0,T.jsx)("span",{className:"text-slate-400 font-bold text-xs uppercase",children:"Top Producto"}),(0,T.jsx)("div",{className:"p-1 bg-green-100 rounded text-green-600",children:(0,T.jsx)(gN,{size:14})})]}),(0,T.jsxs)("div",{className:"truncate",children:[(0,T.jsx)("span",{className:"text-lg font-bold text-slate-800 leading-tight block truncate",children:y.bestSeller?y.bestSeller[0]:"---"}),(0,T.jsx)("span",{className:"text-xs text-slate-400",children:y.bestSeller?`${y.bestSeller[1]} uds vendidas`:"Sin datos"})]})]})]}),(0,T.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,T.jsxs)("div",{className:"md:col-span-2 space-y-4",children:[(0,T.jsx)("h3",{className:"font-bold text-lg text-slate-700",children:"Recientes"}),0===e.length?(0,T.jsx)("div",{className:"text-center py-10 text-slate-400 border-2 border-dashed rounded-xl",children:"No hay actividad reciente."}):e.slice(0,h).map(e=>(0,T.jsxs)("div",{onClick:()=>n(e),className:"bg-white p-4 rounded-xl border hover:shadow-md cursor-pointer transition-all flex justify-between items-center group",children:[(0,T.jsxs)("div",{className:"flex items-center gap-4",children:[(0,T.jsx)("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold text-white shadow-sm ${"accepted"===e.status?"bg-emerald-500":"rejected"===e.status?"bg-red-400":"bg-slate-400"}`,children:e.client.name.charAt(0)}),(0,T.jsxs)("div",{children:[(0,T.jsx)("p",{className:"font-bold text-slate-800 group-hover:text-blue-600 transition-colors",children:e.client.name}),(0,T.jsxs)("p",{className:"text-xs text-slate-500",children:["#",e.number,"  ",e.date]})]})]}),(0,T.jsxs)("div",{className:"text-right",children:[(0,T.jsx)("p",{className:"font-bold text-slate-700",children:gD(e.grandTotal)}),(0,T.jsx)("span",{className:`px-2 py-0.5 rounded-md text-[10px] font-bold uppercase tracking-wider ${"accepted"===e.status?"bg-emerald-100 text-emerald-700":"rejected"===e.status?"bg-red-100 text-red-700":"bg-slate-100 text-slate-600"}`,children:"accepted"===e.status?"Aceptado":"rejected"===e.status?"Rechazado":"Pendiente"})]})]},e.id)),e.length>h&&(0,T.jsx)("button",{onClick:()=>d(e=>e+5),className:"w-full py-2 text-center text-xs font-bold text-blue-600 hover:bg-blue-50 rounded border border-blue-100 dashed",children:"VER MS ANTIGUOS"})]}),(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsx)("h3",{className:"font-bold text-lg text-slate-700",children:"Acciones"}),(0,T.jsxs)("button",{onClick:()=>n(null,"quote"),className:"w-full p-4 bg-blue-50 hover:bg-blue-100 border border-blue-100 rounded-xl flex items-center gap-3 text-blue-800 transition-colors",children:[(0,T.jsx)("div",{className:"bg-white p-2 rounded-full shadow-sm text-blue-600",children:(0,T.jsx)("div",{style:{fontSize:18,fontWeight:"bold"},children:"+"})}),(0,T.jsx)("div",{className:"text-left",children:(0,T.jsx)("span",{className:"block font-bold",children:"Nuevo Presupuesto"})})]}),(0,T.jsxs)("button",{onClick:()=>n(null,"prods"),className:"w-full p-4 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-xl flex items-center gap-3 text-slate-700 transition-colors",children:[(0,T.jsx)("div",{className:"bg-white p-2 rounded-full shadow-sm text-slate-500",children:(0,T.jsx)(gN,{size:18})}),(0,T.jsx)("div",{className:"text-left",children:(0,T.jsx)("span",{className:"block font-bold",children:"Gestionar Productos"})})]}),(0,T.jsxs)("button",{onClick:()=>n(null,"clients"),className:"w-full p-4 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-xl flex items-center gap-3 text-slate-700 transition-colors",children:[(0,T.jsx)("div",{className:"bg-white p-2 rounded-full shadow-sm text-slate-500",children:(0,T.jsx)(gT,{size:18})}),(0,T.jsx)("div",{className:"text-left",children:(0,T.jsx)("span",{className:"block font-bold",children:"Base de Clientes"})})]})]})]}),"sales"===c&&(0,T.jsxs)(b,{title:`Ventas Aceptadas (${"all"===i?"Total":i})`,onClose:()=>u(null),children:[0===p.length&&(0,T.jsx)("p",{className:"p-4 text-center text-slate-500",children:"No hay ventas en este periodo."}),p.map(e=>(0,T.jsxs)("div",{onClick:()=>{u(null),n(e)},className:"p-4 border-b hover:bg-slate-50 cursor-pointer flex justify-between",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("p",{className:"font-bold",children:e.client.name}),(0,T.jsx)("p",{className:"text-xs text-slate-500",children:e.date})]}),(0,T.jsx)("span",{className:"font-bold text-green-600",children:gD(e.grandTotal)})]},e.id))]}),"pending"===c&&(0,T.jsx)(b,{title:"Presupuestos Pendientes",onClose:()=>u(null),children:g.map(e=>(0,T.jsxs)("div",{onClick:()=>{u(null),n(e)},className:"p-4 border-b hover:bg-slate-50 cursor-pointer flex justify-between",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("p",{className:"font-bold",children:e.client.name}),(0,T.jsx)("p",{className:"text-xs text-slate-500",children:e.date})]}),(0,T.jsx)("span",{className:"font-bold text-orange-600",children:gD(e.grandTotal)})]},e.id))}),"ranking"===c&&(0,T.jsx)(b,{title:"Ranking de Productos",onClose:()=>u(null),children:(0,T.jsxs)("table",{className:"w-full text-sm",children:[(0,T.jsx)("thead",{className:"bg-slate-100",children:(0,T.jsxs)("tr",{className:"text-left",children:[(0,T.jsx)("th",{className:"p-3",children:"Producto"}),(0,T.jsx)("th",{className:"p-3 text-right",children:"Unidades"})]})}),(0,T.jsx)("tbody",{children:y.ranking.map(([e,t],r)=>(0,T.jsxs)("tr",{className:"border-b",children:[(0,T.jsxs)("td",{className:"p-3 font-medium flex items-center gap-2",children:[(0,T.jsx)("span",{className:`text-[10px] w-6 h-6 flex items-center justify-center rounded-full font-bold text-white ${0===r?"bg-yellow-400":1===r?"bg-slate-400":2===r?"bg-amber-600":"bg-slate-200 text-slate-500"}`,children:r+1}),e]}),(0,T.jsx)("td",{className:"p-3 text-right font-bold",children:t})]},r))})]})}),"charts"===c&&(0,T.jsx)(b,{title:"Anlisis Grfico Avanzado",onClose:()=>u(null),maxWidth:"max-w-5xl",children:(0,T.jsxs)("div",{className:"p-6 grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:[(0,T.jsxs)("div",{className:"lg:col-span-2",children:[(0,T.jsxs)("h4",{className:"font-bold text-slate-700 mb-4 flex items-center gap-2",children:[(0,T.jsx)(gS,{size:18})," Ventas ltimos 6 meses"]}),(0,T.jsx)(gR,{data:y.chartData,color:s.color})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"font-bold text-slate-700 mb-4",children:"Estado Presupuestos"}),(0,T.jsx)(gP,{data:[{label:"Aceptado",value:y.statusCounts.accepted,color:"#10b981"},{label:"Rechazado",value:y.statusCounts.rejected,color:"#ef4444"},{label:"Pendiente",value:y.statusCounts.pending,color:"#f59e0b"}]})]}),(0,T.jsxs)("div",{className:"md:col-span-3 border-t pt-6",children:[(0,T.jsxs)("h4",{className:"font-bold text-slate-700 mb-4 flex items-center gap-2",children:[(0,T.jsx)(gA,{size:18,className:"text-blue-500"})," Fuentes de Adquisicin (Clientes Aceptados)"]}),(0,T.jsx)("div",{className:"grid md:grid-cols-2 gap-6 items-center",children:y.sourceChartData.length>0?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(gP,{data:y.sourceChartData}),(0,T.jsxs)("div",{className:"space-y-2",children:[(0,T.jsx)("p",{className:"text-sm text-slate-500 mb-2",children:"Desglose detallado:"}),y.sourceChartData.map((e,t)=>(0,T.jsxs)("div",{className:"flex justify-between items-center p-2 bg-slate-50 rounded border border-slate-100",children:[(0,T.jsxs)("div",{className:"flex items-center gap-2",children:[(0,T.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),(0,T.jsx)("span",{className:"font-bold text-sm text-slate-700",children:e.label})]}),(0,T.jsxs)("div",{className:"text-xs",children:[(0,T.jsxs)("span",{className:"font-bold mr-2",children:[e.value," clientes"]}),(0,T.jsxs)("span",{className:"text-slate-400",children:["(",Math.round(e.value/y.totalSources*100),"%)"]})]})]},t))]})]}):(0,T.jsx)("div",{className:"col-span-2 text-center py-8 text-slate-400 bg-slate-50 rounded-xl border border-dashed",children:"An no hay datos de origen registrados en ventas aceptadas."})})]}),(0,T.jsxs)("div",{className:"md:col-span-3 grid grid-cols-3 gap-4 border-t pt-6",children:[(0,T.jsxs)("div",{className:"p-3 bg-slate-50 rounded-lg text-center",children:[(0,T.jsx)("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Total Generado"}),(0,T.jsx)("p",{className:"text-xl font-black text-slate-800",children:gD(y.totalSales)})]}),(0,T.jsxs)("div",{className:"p-3 bg-slate-50 rounded-lg text-center",children:[(0,T.jsx)("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Ticket Medio"}),(0,T.jsx)("p",{className:"text-xl font-black text-slate-800",children:y.statusCounts.accepted>0?gD(y.totalSales/y.statusCounts.accepted):"0 "})]}),(0,T.jsxs)("div",{className:"p-3 bg-slate-50 rounded-lg text-center",children:[(0,T.jsx)("p",{className:"text-xs text-slate-500 font-bold uppercase",children:"Tasa Conversin"}),(0,T.jsxs)("p",{className:"text-xl font-black text-slate-800",children:[e.length>0?Math.round(y.statusCounts.accepted/e.length*100):0,"%"]})]})]})]})})]})},gM=gd("calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),gL=gd("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),gF=gd("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),gV=gd("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),gU=gd("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),gB=gd("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),gq=gd("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),gz=gd("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),g$=gd("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),gG=gd("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),gK=gd("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),gH=gd("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),gW=gd("trash",[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]),gQ=gd("ban",[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),gJ=gd("wand",[["path",{d:"M15 4V2",key:"z1p9b7"}],["path",{d:"M15 16v-2",key:"px0unx"}],["path",{d:"M8 9h2",key:"1g203m"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M17.8 11.8 19 13",key:"yihg8r"}],["path",{d:"M15 9h.01",key:"x1ddxp"}],["path",{d:"M17.8 6.2 19 5",key:"fd4us0"}],["path",{d:"m3 21 9-9",key:"1jfql5"}],["path",{d:"M12.2 6.2 11 5",key:"i3da3b"}]]),gY=gd("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]),gX=({matrix:e,onChange:t})=>{let r={widths:e?.widths||[1e3],heights:e?.heights||[1e3],prices:e?.prices||[[0]]},[n,s]=(0,N.useState)(100),[i,a]=(0,N.useState)(!1),o=gx(),[l,c]=(0,N.useState)({wMin:600,wMax:2e3,wStep:200,hMin:600,hMax:2e3,hStep:200}),u=(e,n,s)=>{let i=[...r[e]];i[n]=parseInt(s)||0,t({...r,[e]:i})},h=e=>{let s=(r[e][r[e].length-1]||0)+parseInt(n),i=[...r[e],s],a="heights"===e?[...r.prices,Array(r.widths.length).fill(0)]:r.prices.map(e=>[...e,0]);t({...r,[e]:i,prices:a})},d=(e,n)=>{if(r[e].length<=1)return o("Mnimo 1 fila/columna","error");let s=r[e].filter((e,t)=>t!==n),i="heights"===e?r.prices.filter((e,t)=>t!==n):r.prices.map(e=>e.filter((e,t)=>t!==n));t({...r,[e]:s,prices:i})},f=(e,n,s)=>{let i=[...r.prices];i[e]=[...i[e]],i[e][n]=null===s?null:parseFloat(s),t({...r,prices:i})};return(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{className:"flex gap-2 items-center bg-slate-50 p-3 rounded-xl border border-slate-100 justify-between flex-wrap",children:[(0,T.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,T.jsx)("span",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Paso:"}),(0,T.jsx)("input",{type:"number",className:"w-16 p-1 border rounded text-sm text-center font-bold text-slate-700",value:n,onChange:e=>s(e.target.value)})]}),(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsxs)("button",{onClick:()=>{let e=r.heights.length-1,n=r.widths.length-1,s=parseFloat(r.prices[0][0])||0,i=parseFloat(r.prices[0][n])||0,a=parseFloat(r.prices[e][0])||0,l=parseFloat(r.prices[e][n])||0;if(!s||!i||!a||!l)return o("Rellena las 4 esquinas","error");let c=r.prices.map((t,o)=>t.map((t,c)=>{let u=(r.widths[c]-r.widths[0])/(r.widths[n]-r.widths[0]),h=(r.heights[o]-r.heights[0])/(r.heights[e]-r.heights[0]);return Math.round(s*(1-u)*(1-h)+i*u*(1-h)+a*(1-u)*h+l*u*h)}));t({...r,prices:c}),o("Precios calculados","success")},className:"flex items-center gap-2 py-1 px-3 rounded-lg text-xs font-bold text-indigo-600 bg-indigo-50 hover:bg-indigo-100 transition-colors",children:[(0,T.jsx)(gY,{size:14})," Bilineal"]}),(0,T.jsxs)("button",{onClick:()=>a(!i),className:"flex items-center gap-2 py-1 px-3 rounded-lg text-xs font-bold text-slate-600 hover:bg-slate-100 transition-colors",children:[(0,T.jsx)(gJ,{size:14})," Generador"]})]})]}),i&&(0,T.jsxs)("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100 grid grid-cols-2 gap-4 animate-fade-in mb-2 shadow-inner",children:[(0,T.jsx)("div",{className:"col-span-2 text-xs text-blue-800 font-bold mb-1",children:"Configuracin Rpida"}),(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"font-bold text-[10px] uppercase text-blue-400 mb-1",children:"Ancho (X)"}),(0,T.jsxs)("div",{className:"flex gap-1",children:[(0,T.jsx)("input",{placeholder:"Min",className:"w-full p-1 text-xs border rounded",value:l.wMin,onChange:e=>c({...l,wMin:e.target.value})}),(0,T.jsx)("input",{placeholder:"Max",className:"w-full p-1 text-xs border rounded",value:l.wMax,onChange:e=>c({...l,wMax:e.target.value})}),(0,T.jsx)("input",{placeholder:"Step",className:"w-full p-1 text-xs border rounded",value:l.wStep,onChange:e=>c({...l,wStep:e.target.value})})]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("h4",{className:"font-bold text-[10px] uppercase text-blue-400 mb-1",children:"Alto (Y)"}),(0,T.jsxs)("div",{className:"flex gap-1",children:[(0,T.jsx)("input",{placeholder:"Min",className:"w-full p-1 text-xs border rounded",value:l.hMin,onChange:e=>c({...l,hMin:e.target.value})}),(0,T.jsx)("input",{placeholder:"Max",className:"w-full p-1 text-xs border rounded",value:l.hMax,onChange:e=>c({...l,hMax:e.target.value})}),(0,T.jsx)("input",{placeholder:"Step",className:"w-full p-1 text-xs border rounded",value:l.hStep,onChange:e=>c({...l,hStep:e.target.value})})]})]}),(0,T.jsx)("button",{onClick:()=>{let e=[];for(let t=parseInt(l.wMin);t<=parseInt(l.wMax);t+=parseInt(l.wStep))e.push(t);let r=[];for(let e=parseInt(l.hMin);e<=parseInt(l.hMax);e+=parseInt(l.hStep))r.push(e);if(0===e.length||0===r.length)return o("Rango invlido","error");t({widths:e,heights:r,prices:Array(r.length).fill().map(()=>Array(e.length).fill(0))}),a(!1),o("Tabla regenerada","success")},className:"col-span-2 py-1.5 text-xs font-bold bg-blue-600 text-white rounded hover:bg-blue-700",children:"Generar Tabla"})]}),(0,T.jsx)("div",{className:"overflow-x-auto overflow-y-auto border rounded-xl shadow-sm bg-white max-h-[600px] relative custom-scrollbar",children:(0,T.jsxs)("table",{className:"min-w-full text-xs border-collapse",children:[(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{className:"sticky-corner bg-slate-200 p-2 border-b border-r text-slate-500 font-black tracking-tighter text-[10px] min-w-[80px] shadow-[2px_2px_5px_rgba(0,0,0,0.05)]",children:"ALTO \\ ANCHO"}),r.widths.map((e,t)=>(0,T.jsx)("th",{className:"sticky-row-header bg-slate-50 p-1 min-w-[70px] border-b border-r border-slate-100 group hover:bg-slate-100 transition-colors",children:(0,T.jsxs)("div",{className:"flex flex-col items-center",children:[(0,T.jsx)("input",{type:"number",className:"w-full bg-transparent text-center font-bold text-slate-700 outline-none mb-1 text-sm",value:e,onChange:e=>u("widths",t,e.target.value)}),(0,T.jsx)("button",{onClick:()=>d("widths",t),className:"text-red-300 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,T.jsx)(gW,{size:10})})]})},`w${t}`)),(0,T.jsx)("th",{className:"sticky-row-header p-1 border-b bg-slate-50 min-w-[40px]",children:(0,T.jsx)("button",{onClick:()=>h("widths"),className:"text-blue-600 hover:bg-blue-100 p-1 rounded w-full flex justify-center",children:(0,T.jsx)(gL,{size:14})})})]})}),(0,T.jsxs)("tbody",{children:[r.heights.map((e,t)=>(0,T.jsxs)("tr",{children:[(0,T.jsx)("td",{className:"sticky-col bg-slate-50 p-1 border-r border-b border-slate-100 font-bold text-slate-700 group hover:bg-slate-100 transition-colors min-w-[80px] shadow-[2px_0_5px_rgba(0,0,0,0.02)]",children:(0,T.jsxs)("div",{className:"flex flex-col items-center",children:[(0,T.jsx)("input",{type:"number",className:"w-full bg-transparent text-center outline-none text-sm",value:e,onChange:e=>u("heights",t,e.target.value)}),(0,T.jsx)("button",{onClick:()=>d("heights",t),className:"text-red-300 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,T.jsx)(gW,{size:10})})]})}),r.widths.map((e,n)=>{let s=r.prices[t]?.[n];return(0,T.jsx)("td",{className:`p-0 border-r border-b border-slate-100 relative group transition-colors hover:z-0 hover:shadow-lg ${null===s?"bg-red-50":"hover:bg-blue-50"}`,children:null===s?(0,T.jsx)("button",{onClick:()=>f(t,n,0),className:"w-full h-8 text-center text-red-50 font-bold text-[10px] hover:text-red-500",children:"N/A"}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("input",{type:"number",className:"w-full h-8 text-center outline-none bg-transparent font-medium text-slate-600 focus:text-blue-700 focus:font-bold",value:s||0,onChange:e=>f(t,n,e.target.value)}),(0,T.jsx)("button",{onClick:()=>f(t,n,null),className:"absolute top-0 right-0 text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 p-0.5",children:(0,T.jsx)(gQ,{size:10})})]})},`c${n}`)})]},`r${t}`)),(0,T.jsx)("tr",{children:(0,T.jsx)("td",{className:"sticky-col text-center p-1 border-r bg-slate-50 min-w-[80px]",children:(0,T.jsx)("button",{onClick:()=>h("heights"),className:"text-blue-600 hover:bg-blue-100 p-1 rounded w-full flex justify-center",children:(0,T.jsx)(gL,{size:14})})})})]})]})})]})},gZ=e=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(e||0),g0=N.default.memo(({item:e,idx:t,onRemove:r,onUpdateQty:n,onMove:s})=>(0,T.jsxs)("div",{className:"p-3 border border-slate-100 rounded-xl relative group bg-white shadow-sm hover:shadow-md transition-all mb-2 animate-fade-in",children:[(0,T.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1",children:[(0,T.jsxs)("div",{className:"flex flex-col mr-2 bg-slate-50 rounded border border-slate-100",children:[(0,T.jsx)("button",{onClick:()=>s(t,-1),className:"p-0.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-t",children:(0,T.jsx)(gz,{size:12})}),(0,T.jsx)("button",{onClick:()=>s(t,1),className:"p-0.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-b border-t border-slate-100",children:(0,T.jsx)(g$,{size:12})})]}),(0,T.jsx)("button",{onClick:()=>r(e.id),className:"text-slate-300 hover:text-red-500 p-1 rounded-full hover:bg-red-50 transition-colors h-fit",children:(0,T.jsx)(gj,{size:16})})]}),(0,T.jsxs)("div",{className:"flex gap-3",children:[(0,T.jsx)("div",{className:"w-12 h-12 bg-slate-50 rounded-lg flex items-center justify-center shrink-0 border border-slate-100",children:e.product.image?(0,T.jsx)("img",{src:e.product.image,className:"w-full h-full object-cover rounded-lg"}):(0,T.jsx)(gN,{className:"text-slate-300"})}),(0,T.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,T.jsx)("p",{className:"font-bold text-sm text-slate-800 truncate pr-16",children:e.product.name}),(0,T.jsxs)("p",{className:"text-xs text-slate-500",children:[e.width,"x",e.height," ",e.locationLabel&&`\xb7 ${e.locationLabel}`]}),e.selectedExtras?.length>0&&(0,T.jsx)("div",{className:"mt-1 flex flex-wrap gap-1",children:e.selectedExtras.map((e,t)=>(0,T.jsxs)("span",{className:"inline-flex items-center text-[10px] bg-slate-50 text-slate-600 px-1.5 py-0.5 rounded border border-slate-200",children:[e.qty>1&&(0,T.jsxs)("b",{className:"text-blue-600 mr-1",children:[e.qty,"x"]}),e.name]},t))}),(0,T.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,T.jsxs)("div",{className:"flex items-center gap-1 bg-slate-50 rounded-lg p-0.5 border border-slate-200",children:[(0,T.jsx)("button",{onClick:()=>n(e.id,-1),className:"w-6 h-6 flex items-center justify-center hover:bg-white rounded-md transition-colors text-slate-600 font-bold",children:"-"}),(0,T.jsx)("span",{className:"text-xs font-bold w-6 text-center text-slate-700",children:e.quantity}),(0,T.jsx)("button",{onClick:()=>n(e.id,1),className:"w-6 h-6 flex items-center justify-center hover:bg-white rounded-md transition-colors text-slate-600 font-bold",children:"+"})]}),(0,T.jsx)("b",{className:"text-sm text-blue-900 font-mono",children:gZ(e.price)})]})]})]})]})),g1=({products:e,categories:t,config:r,cart:n,setCart:s,onSave:i,onReset:a,initialData:o,clientsDb:l,className:c})=>{let[u,h]=(0,N.useState)(null),[d,f]=(0,N.useState)({w:1e3,h:1e3,q:1}),[p,m]=(0,N.useState)(""),[g,y]=(0,N.useState)(o?.client||{name:"",phone:"",email:"",address:"",city:"",source:""}),[b,x]=(0,N.useState)(o?.financials||{discountPercent:0,deposit:0}),[v,w]=(0,N.useState)(o?{number:o.number,date:o.date,status:o.status||"pending"}:{number:`${new Date().getFullYear()}-${Math.floor(1e4*Math.random())}`,date:new Date().toLocaleDateString("es-ES"),status:"pending"}),[I,_]=(0,N.useState)(!1),[E,S]=(0,N.useState)(""),[C,k]=(0,N.useState)(""),[A,j]=(0,N.useState)("Todas"),[D,R]=(0,N.useState)("edit"),[P,O]=(0,N.useState)("products"),[M,L]=(0,N.useState)(.8),[F,V]=(0,N.useState)("quote"),U=gx(),B=void 0!==r.iva&&""!==r.iva?parseFloat(r.iva):21;(0,N.useEffect)(()=>{o&&(y(o.client||{name:"",phone:"",email:"",address:"",city:"",source:o.client?.source||""}),x(o.financials||{discountPercent:0,deposit:0}),w({number:o.number,date:o.date,status:o.status||"pending"}))},[o]);let[q,z]=(0,N.useState)([]),[$,G]=(0,N.useState)({}),[K,H]=(0,N.useState)(null);(0,N.useEffect)(()=>{u&&H(((e,t,r,n,s,i)=>{let a=0;if("matrix"===e.priceType){let n=e.matrix.widths,s=e.matrix.heights,i=e.matrix.prices,o=n.findIndex(e=>e>=t);-1===o&&(o=n.length-1);let l=s.findIndex(e=>e>=r);-1===l&&(l=s.length-1),a=parseFloat(i[l][o])}else"unit"===e.priceType?a=parseFloat(e.unitPrice):"simple_area"===e.priceType?a=t*r/1e6*parseFloat(e.unitPrice):"simple_linear"===e.priceType&&(a=Math.max(t,r)/1e3*parseFloat(e.unitPrice));let o=0;s.forEach(e=>{"fixed"===e.type?o+=parseFloat(e.value)*e.qty:"percent"===e.type?o+=a*(parseFloat(e.value)/100)*e.qty:"linear"===e.type?o+=Math.max(t,r)/1e3*parseFloat(e.value)*e.qty:"area"===e.type&&(o+=t*r/1e6*parseFloat(e.value)*e.qty)}),Object.keys(i).forEach(n=>{let s=e.extras.find(e=>e.id.toString()===n);if(s&&s.optionsList){let e=parseInt(i[n]),l=s.optionsList[e];l&&("fixed"===l.type?o+=parseFloat(l.value):"percent"===l.type?o+=a*(parseFloat(l.value)/100):"linear"===l.type?o+=Math.max(t,r)/1e3*parseFloat(l.value):"area"===l.type&&(o+=t*r/1e6*parseFloat(l.value)))}});let l=a+o,c=0;return"percent"===e.marginType&&e.marginValue?c=l*(parseFloat(e.marginValue)/100):"fixed"===e.marginType&&e.marginValue&&(c=parseFloat(e.marginValue)),(l+c)*n})(u,d.w,d.h,d.q,q,$))},[u,d,q,$]);let W=(e,t)=>{z(r=>r.map(r=>r.id===e?{...r,qty:Math.max(1,r.qty+t)}:r))},Q=(0,N.useCallback)((e,t)=>s(r=>r.map(r=>r.id===e?{...r,quantity:Math.max(1,r.quantity+t),price:r.unitPriceCalc*Math.max(1,r.quantity+t)}:r)),[]),J=(0,N.useCallback)(e=>s(t=>t.filter(t=>t.id!==e)),[]),Y=(0,N.useCallback)((e,t)=>{if(-1===t&&0===e||1===t&&e===n.length-1)return;let r=[...n];[r[e],r[e+t]]=[r[e+t],r[e]],s(r)},[n]),X=(0,N.useMemo)(()=>n.reduce((e,t)=>e+t.price,0),[n]),Z=X*(b.discountPercent/100),ee=X-Z,et=ee*(1+B/100),er=et-b.deposit,en=l.filter(e=>e.name.toLowerCase().includes(C.toLowerCase())||e.phone.includes(C));return"print"===D?(0,T.jsxs)("div",{className:"fixed inset-0 z-[100] bg-slate-100 flex flex-col h-safe-screen w-full fixed-print-view smooth-scroll overflow-auto",children:[(0,T.jsxs)("div",{className:"absolute top-4 left-4 z-50 bg-white shadow-xl rounded-lg p-1 flex border border-slate-200 doc-type-switch",children:[(0,T.jsx)("button",{onClick:()=>V("quote"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all ${"quote"===F?"bg-slate-900 text-white shadow-md":"text-slate-500 hover:bg-slate-50"}`,children:"PRESUPUESTO"}),(0,T.jsx)("button",{onClick:()=>V("invoice"),className:`px-4 py-2 text-xs font-bold rounded-md transition-all ${"invoice"===F?"bg-slate-900 text-white shadow-md":"text-slate-500 hover:bg-slate-50"}`,children:"FACTURA"})]}),(0,T.jsxs)("div",{className:"zoom-controls absolute top-4 right-4 z-50 bg-white shadow-xl rounded-full p-2 flex gap-4 items-center border border-slate-200",children:[(0,T.jsx)("button",{onClick:()=>L(Math.max(.3,M-.1)),className:"p-2 text-slate-600 hover:text-blue-600",children:(0,T.jsx)(gH,{size:20})}),(0,T.jsxs)("span",{className:"text-xs font-bold w-8 text-center",children:[Math.round(100*M),"%"]}),(0,T.jsx)("button",{onClick:()=>L(Math.min(1.5,M+.1)),className:"p-2 text-slate-600 hover:text-blue-600",children:(0,T.jsx)(gK,{size:20})})]}),(0,T.jsx)("div",{className:"flex-1 overflow-auto p-4 md:p-8 flex justify-center items-start print:p-0 print:block",children:(0,T.jsx)("div",{className:"print-scale-wrapper origin-top transition-transform duration-200",style:{transform:`scale(${M})`},children:(0,T.jsxs)("div",{className:"w-[210mm] min-w-[210mm] min-h-[297mm] bg-white print-container shadow-2xl p-[15mm] mx-auto text-sm relative",children:[(0,T.jsxs)("div",{className:"flex justify-between items-start border-b-2 pb-6 mb-8",style:{borderColor:r.color},children:[(0,T.jsxs)("div",{children:[r.logo?(0,T.jsx)("img",{src:r.logo,className:"h-16 mb-4 object-contain"}):(0,T.jsx)("h1",{className:"text-4xl font-black mb-2",style:{color:r.color},children:r.name}),(0,T.jsxs)("div",{className:"text-xs text-slate-500 space-y-1",children:[(0,T.jsx)("p",{children:r.address}),r.cif&&(0,T.jsxs)("p",{children:["CIF/NIF: ",r.cif]}),(0,T.jsxs)("p",{children:[r.phone,"  ",r.email]}),(0,T.jsx)("p",{children:r.website})]})]}),(0,T.jsxs)("div",{className:"text-right",children:[(0,T.jsx)("h2",{className:"text-4xl font-black tracking-tight text-slate-800 mb-2",children:"invoice"===F?"FACTURA":"PRESUPUESTO"}),(0,T.jsxs)("div",{className:"flex flex-col items-end my-2",children:[(0,T.jsxs)("span",{className:"text-lg font-bold text-slate-600",children:["#",v.number]}),(0,T.jsx)("span",{className:"text-sm text-slate-400",children:v.date})]}),(0,T.jsxs)("div",{className:"mt-4 text-left bg-slate-50 p-4 rounded-lg border border-slate-100 min-w-[250px]",children:[(0,T.jsx)("p",{className:"text-[10px] font-bold uppercase text-slate-400 tracking-wider mb-1",children:"Facturar a"}),(0,T.jsx)("p",{className:"font-bold text-slate-800 text-lg leading-none mb-1",children:g.name}),(0,T.jsx)("p",{className:"text-sm text-slate-600",children:g.phone}),(0,T.jsx)("p",{className:"text-sm text-slate-600",children:g.address})]})]})]}),(0,T.jsxs)("table",{className:"w-full mb-8",children:[(0,T.jsx)("thead",{children:(0,T.jsxs)("tr",{className:"border-b-2 text-xs uppercase text-slate-500 font-bold tracking-wider",children:[(0,T.jsx)("th",{className:"text-left py-3 pl-2",children:"Concepto"}),(0,T.jsx)("th",{className:"text-center py-3",children:"Medidas"}),(0,T.jsx)("th",{className:"text-center py-3",children:"Cant."}),(0,T.jsx)("th",{className:"text-right py-3 pr-2",children:"Total"})]})}),(0,T.jsx)("tbody",{children:n.map(e=>(0,T.jsxs)("tr",{className:"avoid-break border-b border-slate-100 last:border-0",children:[(0,T.jsx)("td",{className:"py-4 pl-2",children:(0,T.jsxs)("div",{className:"flex items-start gap-4",children:[e.product.image&&(0,T.jsx)("img",{src:e.product.image,className:"w-16 h-16 object-cover rounded-lg border border-slate-200 print-visible"}),(0,T.jsxs)("div",{children:[(0,T.jsx)("p",{className:"font-bold text-slate-800 text-base",children:e.product.name}),(0,T.jsxs)("p",{className:"text-xs text-slate-500 mt-1",children:[e.product.category," ",e.locationLabel&&(0,T.jsx)("span",{className:"px-1.5 py-0.5 bg-slate-100 rounded text-slate-600 ml-1",children:e.locationLabel})]}),e.selectedExtras?.length>0&&(0,T.jsx)("div",{className:"text-[10px] text-slate-500 mt-2 flex flex-wrap gap-1",children:e.selectedExtras.map(e=>(0,T.jsxs)("span",{className:"bg-slate-50 px-1 border border-slate-200 rounded",children:["+",e.qty>1?e.qty+"x ":"",e.name]}))})]})]})}),(0,T.jsxs)("td",{className:"text-center text-sm py-4 text-slate-600 font-medium",children:[e.width," x ",e.height]}),(0,T.jsx)("td",{className:"text-center font-bold text-slate-800 py-4",children:e.quantity}),(0,T.jsx)("td",{className:"text-right font-bold text-slate-800 py-4 pr-2",children:gZ(e.price)})]},e.id))})]}),(0,T.jsx)("div",{className:"flex justify-end avoid-break",children:(0,T.jsxs)("div",{className:"w-80 space-y-3",children:[(0,T.jsxs)("div",{className:"flex justify-between text-sm text-slate-600",children:[(0,T.jsx)("span",{children:"Subtotal"}),(0,T.jsx)("span",{children:gZ(X)})]}),b.discountPercent>0&&(0,T.jsxs)("div",{className:"flex justify-between text-sm font-bold text-emerald-600",children:[(0,T.jsxs)("span",{children:["Descuento (",b.discountPercent,"%)"]}),(0,T.jsxs)("span",{children:["-",gZ(Z)]})]}),(0,T.jsxs)("div",{className:"flex justify-between text-sm text-slate-600 pb-3 border-b",children:[(0,T.jsxs)("span",{children:["IVA (",B,"%)"]}),(0,T.jsx)("span",{children:gZ(B/100*ee)})]}),(0,T.jsxs)("div",{className:"flex justify-between text-3xl font-black bg-slate-50 p-2 rounded-lg -mx-2",style:{color:r.color},children:[(0,T.jsx)("span",{children:"TOTAL"}),(0,T.jsx)("span",{children:gZ(et)})]}),b.deposit>0&&(0,T.jsxs)("div",{className:"flex justify-between text-sm font-bold text-slate-500 pt-2",children:[(0,T.jsx)("span",{children:"Pagado a cuenta"}),(0,T.jsxs)("span",{children:["-",gZ(b.deposit)]})]}),b.deposit>0&&(0,T.jsxs)("div",{className:"flex justify-between font-black text-lg border-t pt-2",children:[(0,T.jsx)("span",{children:"PENDIENTE"}),(0,T.jsx)("span",{children:gZ(er)})]})]})}),(0,T.jsxs)("div",{className:"mt-12 pt-6 border-t-2 border-slate-100 text-[10px] text-slate-500 grid grid-cols-2 gap-12",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("b",{className:"block mb-2 text-slate-800 uppercase tracking-wider",children:"Mtodo de Pago"}),(0,T.jsx)("div",{className:"p-3 bg-slate-50 rounded border",children:r.bankAccount||"Consultar"})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("b",{className:"block mb-2 text-slate-800 uppercase tracking-wider",children:"Trminos y Condiciones"}),(0,T.jsx)("p",{style:{whiteSpace:"pre-line"},className:"leading-relaxed",children:r.legalText})]})]})]})})}),(0,T.jsxs)("div",{className:"shrink-0 bg-white/80 backdrop-blur-md border-t flex gap-4 justify-center no-print z-50 p-4 shadow-2xl",children:[(0,T.jsx)("button",{onClick:()=>R("edit"),className:"px-4 py-2 rounded-lg border bg-white shadow-sm hover:bg-slate-50 font-bold text-slate-600",children:"Seguir Editando"}),(0,T.jsxs)("button",{onClick:()=>window.print(),style:{backgroundColor:r.color},className:"px-8 py-2 rounded-lg text-white font-bold shadow-xl flex items-center gap-2",children:[(0,T.jsx)(gV,{size:18})," Imprimir PDF"]}),(0,T.jsxs)("button",{onClick:()=>{let e=`<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'><head><meta charset='utf-8'><title>Presupuesto</title></head><body style="font-family:Arial;font-size:12px"><h1 style="color:${r.color}">${r.name}</h1><p>Cliente: ${g.name}</p><table>${n.map(e=>`<tr><td>${e.product.name}</td><td>${e.width}x${e.height}</td><td>${e.quantity}</td><td>${gZ(e.price)}</td></tr>`).join("")}</table><h3>Total: ${gZ(et)}</h3></body></html>`,t=document.createElement("a");t.href=URL.createObjectURL(new Blob(["\uFEFF",e],{type:"application/msword"})),t.download=`Presupuesto_${g.name}.doc`,t.click()},className:"px-4 py-2 rounded-lg border bg-white shadow-sm hover:bg-slate-50 font-bold text-slate-600 flex items-center gap-2",children:[(0,T.jsx)(gU,{size:18})," Word"]})]})]}):(0,T.jsxs)("div",{className:`flex flex-col md:flex-row h-full overflow-hidden ${c} app-tab`,children:[(0,T.jsxs)("div",{className:"md:hidden flex bg-white border-b shadow-sm z-30 shrink-0",children:[(0,T.jsx)("button",{onClick:()=>O("products"),className:`flex-1 py-3 text-sm font-bold border-b-2 transition-colors ${"products"===P?"border-blue-600 text-blue-600":"border-transparent text-slate-500"}`,children:"Catlogo"}),(0,T.jsxs)("button",{onClick:()=>O("cart"),className:`flex-1 py-3 text-sm font-bold border-b-2 flex items-center justify-center gap-2 transition-colors ${"cart"===P?"border-blue-600 text-blue-600":"border-transparent text-slate-500"}`,children:["Presupuesto ",(0,T.jsx)("span",{className:"bg-blue-100 text-blue-800 text-[10px] px-2 py-0.5 rounded-full font-black",children:n.length})]})]}),(0,T.jsxs)("div",{className:`${"products"===P?"block":"hidden"} md:block w-full md:w-2/3 p-4 md:p-6 overflow-y-auto bg-slate-50/50`,children:[(0,T.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("h2",{className:"text-2xl font-black text-slate-800",children:"Confeccionar"}),(0,T.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,T.jsxs)("div",{className:"flex items-center gap-2 bg-white px-2 py-1 rounded border shadow-sm",children:[(0,T.jsx)("span",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"REF"}),(0,T.jsx)("input",{className:"bg-transparent text-sm font-bold w-20 outline-none",value:v.number,onChange:e=>w({...v,number:e.target.value})})]}),(0,T.jsxs)("div",{className:"flex items-center gap-2 bg-white px-2 py-1 rounded border shadow-sm",children:[(0,T.jsx)("span",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"FECHA"}),(0,T.jsx)("input",{className:"bg-transparent text-sm font-bold w-20 outline-none",value:v.date,onChange:e=>w({...v,date:e.target.value})})]})]})]}),(0,T.jsxs)("button",{onClick:a,className:"text-xs flex items-center gap-2 px-3 py-2 rounded-lg shadow-sm bg-white hover:bg-red-50 text-red-600 border border-red-100 font-bold",children:[(0,T.jsx)(gq,{size:14})," Limpiar Todo"]})]}),(0,T.jsxs)("div",{className:"bg-white rounded-xl border shadow-sm p-0 mb-6 overflow-visible relative z-20",children:[(0,T.jsxs)("div",{className:"bg-slate-50 p-3 border-b rounded-t-xl flex justify-between items-center",children:[(0,T.jsx)("span",{className:"text-xs font-bold uppercase text-slate-500 tracking-wider ml-2",children:"Datos del Cliente"}),(0,T.jsxs)("button",{onClick:()=>_(!I),className:"py-1 px-3 text-xs h-8 flex items-center gap-2 bg-white border rounded hover:bg-slate-50 text-slate-600",children:[(0,T.jsx)(gB,{size:14})," Buscar"]})]}),(0,T.jsxs)("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("label",{className:"absolute -top-2 left-2 bg-white px-1 text-[10px] font-bold text-blue-500",children:"Nombre"}),(0,T.jsx)("input",{className:"w-full p-2.5 border rounded-lg text-sm outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all",value:g.name,onChange:e=>y({...g,name:e.target.value})})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("label",{className:"absolute -top-2 left-2 bg-white px-1 text-[10px] font-bold text-slate-400",children:"Telfono"}),(0,T.jsx)("input",{className:"w-full p-2.5 border rounded-lg text-sm outline-none focus:border-blue-500 transition-all",value:g.phone,onChange:e=>y({...g,phone:e.target.value})})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("label",{className:"absolute -top-2 left-2 bg-white px-1 text-[10px] font-bold text-slate-400",children:"Email"}),(0,T.jsx)("input",{className:"w-full p-2.5 border rounded-lg text-sm outline-none focus:border-blue-500 transition-all",value:g.email,onChange:e=>y({...g,email:e.target.value})})]}),(0,T.jsxs)("div",{className:"relative group",children:[(0,T.jsx)("label",{className:"absolute -top-2 left-2 bg-white px-1 text-[10px] font-bold text-slate-400",children:"Origen"}),(0,T.jsxs)("select",{className:"w-full p-2.5 border rounded-lg text-sm outline-none focus:border-blue-500 transition-all bg-white",value:g.source,onChange:e=>y({...g,source:e.target.value}),children:[(0,T.jsx)("option",{value:"",children:"Cmo nos conoci?"}),(0,T.jsx)("option",{value:"Recomendacin",children:"Recomendacin"}),(0,T.jsx)("option",{value:"Web",children:"Web / Buscador"}),(0,T.jsx)("option",{value:"Google",children:"Google Maps"}),(0,T.jsx)("option",{value:"Publicidad",children:"Publicidad / Redes"}),(0,T.jsx)("option",{value:"Tienda",children:"Pasaba por tienda"}),(0,T.jsx)("option",{value:"Otro",children:"Otro"})]})]}),(0,T.jsxs)("div",{className:"relative group md:col-span-2",children:[(0,T.jsx)("label",{className:"absolute -top-2 left-2 bg-white px-1 text-[10px] font-bold text-slate-400",children:"Direccin"}),(0,T.jsx)("input",{className:"w-full p-2.5 border rounded-lg text-sm outline-none focus:border-blue-500 transition-all",value:g.address,onChange:e=>y({...g,address:e.target.value})})]})]}),I&&(0,T.jsxs)("div",{className:"absolute top-12 left-2 right-2 bg-white border shadow-2xl z-30 rounded-xl max-h-60 overflow-hidden flex flex-col animate-fade-in",children:[(0,T.jsx)("div",{className:"p-2 border-b bg-slate-50",children:(0,T.jsx)("input",{autoFocus:!0,placeholder:"Filtrar por nombre o telfono...",className:"w-full p-2 text-xs border rounded bg-white outline-none focus:border-blue-500",value:C,onChange:e=>k(e.target.value)})}),(0,T.jsxs)("div",{className:"overflow-y-auto",children:[0===en.length&&(0,T.jsx)("p",{className:"text-xs p-4 text-center text-slate-400",children:"No hay clientes recientes."}),en.map((e,t)=>(0,T.jsxs)("div",{onClick:()=>{y({...e}),_(!1),k("")},className:"p-3 hover:bg-blue-50 cursor-pointer border-b last:border-0 text-sm flex justify-between group",children:[(0,T.jsx)("span",{className:"font-bold group-hover:text-blue-700",children:e.name}),(0,T.jsx)("span",{className:"text-slate-500",children:e.phone})]},t))]})]})]}),u?(0,T.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-0 animate-slide-up overflow-hidden",children:[(0,T.jsxs)("div",{className:"bg-slate-50 p-4 border-b flex justify-between items-center",children:[(0,T.jsxs)("button",{onClick:()=>h(null),className:"text-xs font-bold text-slate-500 hover:text-blue-600 flex items-center transition-colors",children:[(0,T.jsx)(gG,{className:"mr-1",size:16})," VOLVER"]}),(0,T.jsx)("h3",{className:"font-bold text-lg",children:u.name}),(0,T.jsx)("div",{className:"w-20"})]}),(0,T.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,T.jsx)("div",{className:"w-full md:w-1/3 bg-slate-100 p-6 flex items-center justify-center border-b md:border-b-0 md:border-r border-slate-200",children:u.image?(0,T.jsx)("img",{src:u.image,className:"max-h-48 rounded-lg shadow-lg rotate-1 hover:rotate-0 transition-transform"}):(0,T.jsx)(gN,{size:64,className:"text-slate-300"})}),(0,T.jsxs)("div",{className:"flex-1 p-6 space-y-6",children:[(0,T.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[["matrix","simple_area","simple_linear"].includes(u.priceType)&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:"flex flex-col",children:[(0,T.jsx)("label",{className:"text-[10px] font-bold text-slate-500 mb-1",children:"ANCHO (mm)"}),(0,T.jsx)("input",{type:"number",className:"p-2.5 rounded-lg border bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-100 outline-none transition-all font-bold",value:d.w,onChange:e=>f({...d,w:parseInt(e.target.value)||0})})]}),(0,T.jsxs)("div",{className:"flex flex-col",children:[(0,T.jsx)("label",{className:"text-[10px] font-bold text-slate-500 mb-1",children:"ALTO (mm)"}),(0,T.jsx)("input",{type:"number",className:"p-2.5 rounded-lg border bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-100 outline-none transition-all font-bold",value:d.h,onChange:e=>f({...d,h:parseInt(e.target.value)||0})})]})]}),(0,T.jsxs)("div",{className:"flex flex-col",children:[(0,T.jsx)("label",{className:"text-[10px] font-bold text-slate-500 mb-1",children:"CANTIDAD"}),(0,T.jsx)("input",{type:"number",className:"p-2.5 rounded-lg border bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-100 outline-none transition-all font-bold",value:d.q,onChange:e=>f({...d,q:parseInt(e.target.value)||1})})]}),(0,T.jsxs)("div",{className:"col-span-2 md:col-span-3",children:[(0,T.jsx)("label",{className:"text-[10px] font-bold text-slate-500 mb-1",children:"UBICACIN"}),(0,T.jsx)("input",{placeholder:"Ej: Saln principal...",className:"w-full p-2.5 rounded-lg border bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-100 outline-none transition-all",value:p,onChange:e=>m(e.target.value)})]})]}),(0,T.jsxs)("div",{className:"space-y-3 pt-4 border-t",children:[(0,T.jsx)("h4",{className:"text-xs font-black uppercase text-slate-400",children:"Personalizacin"}),u.extras.map(e=>"selection"===e.type?(0,T.jsxs)("select",{className:"w-full p-3 border rounded-xl bg-white hover:border-blue-400 transition-colors cursor-pointer",onChange:t=>G({...$,[e.id]:t.target.value}),children:[(0,T.jsxs)("option",{children:["Seleccionar ",e.name]}),e.optionsList.map((e,t)=>(0,T.jsxs)("option",{value:t,children:[e.name," (+",e.value,"percent"===e.type?"%":"linear"===e.type?"/ml":"area"===e.type?"/m":"",")"]},t))]},e.id):(0,T.jsxs)("div",{onClick:()=>{q.find(t=>t.id===e.id)?z(q.filter(t=>t.id!==e.id)):z([...q,{...e,qty:1}])},className:`w-full p-3 border rounded-xl flex justify-between items-center cursor-pointer transition-all ${q.find(t=>t.id===e.id)?"bg-blue-50 border-blue-500 shadow-inner":"hover:bg-slate-50"}`,children:[(0,T.jsxs)("div",{className:"flex-1",children:[(0,T.jsx)("span",{className:`font-bold ${q.find(t=>t.id===e.id)?"text-blue-800":"text-slate-700"}`,children:e.name}),(0,T.jsxs)("span",{className:"text-xs ml-2 text-slate-500 bg-white px-1.5 py-0.5 rounded border",children:["+",e.value,"percent"===e.type?"%":"linear"===e.type?"/ml":"area"===e.type?"/m":""]})]}),q.find(t=>t.id===e.id)?(0,T.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"flex items-center gap-1 ml-2 bg-white rounded-lg border shadow-sm p-0.5",children:[(0,T.jsx)("button",{onClick:()=>W(e.id,-1),className:"px-2 hover:bg-slate-100 font-bold",children:"-"}),(0,T.jsx)("span",{className:"text-xs w-4 text-center font-bold",children:q.find(t=>t.id===e.id).qty}),(0,T.jsx)("button",{onClick:()=>W(e.id,1),className:"px-2 hover:bg-slate-100 font-bold",children:"+"})]}):(0,T.jsx)("div",{className:"w-5 h-5 rounded-full border-2 border-slate-300"})]},e.id))]}),(0,T.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t",children:[(0,T.jsxs)("div",{className:"flex flex-col",children:[(0,T.jsx)("span",{className:"text-xs text-slate-400 font-bold uppercase",children:"Precio Final"}),(0,T.jsx)("span",{className:"text-3xl font-black text-slate-800 tracking-tight",children:null!==K?gZ(K):"--"})]}),(0,T.jsxs)("button",{onClick:()=>{let e={id:Date.now(),product:u,width:d.w,height:d.h,quantity:d.q,locationLabel:p,selectedExtras:[...q],dropdownSelections:{...$},price:K,unitPriceCalc:K/d.q};s(t=>[...t,e]),h(null),m(""),z([]),G({}),U("Producto aadido","success")},disabled:!K,style:{backgroundColor:r.color},className:"px-8 py-3 text-lg shadow-xl shadow-blue-200 text-white rounded-lg font-bold flex items-center gap-2",children:[(0,T.jsx)(gL,{size:18})," AADIR"]})]})]})]})]}):(0,T.jsxs)("div",{className:"animate-fade-in",children:[(0,T.jsxs)("div",{className:"mb-6 flex flex-col md:flex-row gap-4",children:[(0,T.jsxs)("div",{className:"relative flex-1 group",children:[(0,T.jsx)(gB,{className:"absolute left-3 top-3 text-gray-400 group-focus-within:text-blue-500 transition-colors",size:18}),(0,T.jsx)("input",{className:"w-full pl-10 p-3 border rounded-xl shadow-sm outline-none focus:ring-2 focus:ring-blue-100 focus:border-blue-500 transition-all",placeholder:"Buscar producto...",value:E,onChange:e=>S(e.target.value)})]}),(0,T.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-1 no-scrollbar md:flex-wrap",children:["Todas",...t].map(e=>(0,T.jsx)("button",{onClick:()=>j(e),className:`px-4 py-2 rounded-lg whitespace-nowrap text-xs font-bold transition-all ${A===e?"bg-slate-800 text-white shadow-lg":"bg-white text-slate-600 border hover:bg-slate-50"}`,children:e},e))})]}),(0,T.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:e.filter(e=>("Todas"===A||e.category===A)&&e.name.toLowerCase().includes(E.toLowerCase())).map(e=>(0,T.jsxs)("div",{onClick:()=>h(e),className:"group bg-white rounded-2xl border border-slate-100 overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all cursor-pointer relative",children:[(0,T.jsxs)("div",{className:"aspect-square bg-slate-50 relative w-full overflow-hidden",children:[e.image?(0,T.jsx)("img",{src:e.image,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}):(0,T.jsx)("div",{className:"flex h-full items-center justify-center text-slate-300",children:(0,T.jsx)(gN,{size:40})}),(0,T.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end justify-center p-4",children:(0,T.jsx)("span",{className:"text-white font-bold text-sm bg-white/20 backdrop-blur px-3 py-1 rounded-full",children:"Seleccionar"})})]}),(0,T.jsxs)("div",{className:"p-4",children:[(0,T.jsx)("h3",{className:"font-bold text-sm text-slate-800 leading-tight mb-1",children:e.name}),(0,T.jsx)("p",{className:"text-[10px] text-slate-500 uppercase tracking-wide font-bold bg-slate-100 w-fit px-2 py-0.5 rounded",children:e.category})]})]},e.id))})]})]}),(0,T.jsxs)("div",{className:`${"cart"===P?"flex":"hidden"} md:flex w-full md:w-1/3 bg-white md:border-l shadow-2xl flex-col z-20 h-full`,children:[(0,T.jsxs)("div",{className:"p-5 border-b font-bold flex justify-between items-center bg-white shrink-0",children:[(0,T.jsx)("span",{className:"text-lg",children:"Tu Presupuesto"}),(0,T.jsx)("div",{className:"flex gap-2",children:(0,T.jsxs)("select",{value:v.status,onChange:e=>w({...v,status:e.target.value}),className:`text-xs font-bold uppercase rounded py-1 px-2 border outline-none bg-white cursor-pointer hover:border-blue-400 transition-colors ${"accepted"===v.status?"bg-emerald-100 text-emerald-700":"rejected"===v.status?"bg-red-50 text-red-600":"bg-slate-100 text-slate-600"}`,children:[(0,T.jsx)("option",{value:"pending",children:"Pendiente"}),(0,T.jsx)("option",{value:"accepted",children:"Aceptado"}),(0,T.jsx)("option",{value:"rejected",children:"Rechazado"})]})})]}),(0,T.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 bg-slate-50 space-y-2",children:[0===n.length&&(0,T.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-slate-300 opacity-50",children:[(0,T.jsx)(gM,{size:64,strokeWidth:1}),(0,T.jsx)("p",{className:"mt-4 font-medium",children:"Carrito vaco"})]}),n.map((e,t)=>(0,T.jsx)(g0,{item:e,idx:t,onRemove:J,onUpdateQty:Q,onMove:Y},e.id))]}),(0,T.jsxs)("div",{className:"bg-white border-t p-6 space-y-4 shrink-0 shadow-[0_-5px_20px_rgba(0,0,0,0.05)] z-30",children:[(0,T.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-slate-400 font-bold block mb-1",children:"Descuento %"}),(0,T.jsx)("input",{type:"number",className:"w-full bg-slate-50 border p-2 rounded-lg text-right font-bold focus:ring-1 focus:ring-blue-500 outline-none",value:b.discountPercent,onChange:e=>x({...b,discountPercent:parseFloat(e.target.value)||0})})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-slate-400 font-bold block mb-1",children:"Entrega "}),(0,T.jsx)("input",{type:"number",className:"w-full bg-slate-50 border p-2 rounded-lg text-right font-bold focus:ring-1 focus:ring-blue-500 outline-none",value:b.deposit,onChange:e=>x({...b,deposit:parseFloat(e.target.value)||0})})]})]}),(0,T.jsxs)("div",{className:"space-y-1 py-2 border-t border-dashed",children:[(0,T.jsxs)("div",{className:"flex justify-between text-sm text-slate-500",children:[(0,T.jsx)("span",{children:"Subtotal"}),(0,T.jsx)("span",{children:gZ(X)})]}),Z>0&&(0,T.jsxs)("div",{className:"flex justify-between text-sm text-emerald-600",children:[(0,T.jsx)("span",{children:"Ahorro"}),(0,T.jsxs)("span",{children:["-",gZ(Z)]})]}),(0,T.jsxs)("div",{className:"flex justify-between text-3xl font-black text-slate-800 tracking-tight",children:[(0,T.jsx)("span",{children:"TOTAL"}),(0,T.jsx)("span",{children:gZ(et)})]}),b.deposit>0&&(0,T.jsxs)("div",{className:"flex justify-between text-sm font-bold text-slate-400 pt-1",children:[(0,T.jsx)("span",{children:"Restante"}),(0,T.jsx)("span",{children:gZ(er)})]})]}),(0,T.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,T.jsxs)("button",{onClick:()=>g.name?0===n.length?U("Carrito vaco","error"):void(i({id:o?.id||Date.now(),number:v.number,date:v.date,status:v.status,client:g,financials:b,items:n,grandTotal:et}),U("Presupuesto guardado","success")):U("Falta nombre cliente","error"),className:"h-12 flex items-center justify-center gap-2 bg-white text-slate-700 border border-slate-200 hover:bg-slate-50 rounded-lg font-bold",children:[(0,T.jsx)(gF,{size:18})," Guardar"]}),(0,T.jsxs)("button",{onClick:()=>R("print"),style:{backgroundColor:r.color},className:"h-12 flex items-center justify-center gap-2 text-white shadow-lg rounded-lg font-bold",children:[(0,T.jsx)(gV,{size:18})," Finalizar"]})]})]})]})]})},g2=gd("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),g5=gd("percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),g6=({products:e,setProducts:t,categories:r,setCategories:n,className:s})=>{let[i,a]=(0,N.useState)(!1),[o,l]=(0,N.useState)(null),[c,u]=(0,N.useState)({name:"",type:"fixed",value:0}),[h,d]=(0,N.useState)({name:"",value:0,type:"fixed"}),[f,p]=(0,N.useState)([]),[m,g]=(0,N.useState)(null),[y,b]=(0,N.useState)("Todas"),[x,v]=(0,N.useState)(!1),[w,I]=(0,N.useState)(""),_=gx(),E=async e=>{try{let t,r=await (t=e.target.files[0],new Promise((e,r)=>{if(!t.type.match(/image.*/))return r(Error("No es un archivo de imagen"));let n=new FileReader;n.onload=t=>{let n=new Image;n.onload=()=>{let t=document.createElement("canvas"),r=n.width,s=n.height;r>s?r>800&&(s*=800/r,r=800):s>800&&(r*=800/s,s=800),t.width=r,t.height=s;let i=t.getContext("2d");i.fillStyle="#FFFFFF",i.fillRect(0,0,r,s),i.drawImage(n,0,0,r,s),e(t.toDataURL("image/jpeg",.75))},n.onerror=()=>r(Error("Error imagen")),n.src=t.target.result},n.readAsDataURL(t)}));l({...o,image:r})}catch(e){_(e.message,"error")}},S=(r,n)=>{if(-1===n&&0===r||1===n&&r===e.length-1)return;let s=[...e];[s[r],s[r+n]]=[s[r+n],s[r]],t(s)},C=(e,t)=>{if(-1===t&&0===e||1===t&&e===r.length-1)return;let s=[...r];[s[e],s[e+t]]=[s[e+t],s[e]],n(s)},k="Todas"===y?e:e.filter(e=>e.category===y);return i?(0,T.jsxs)("div",{className:`p-4 md:p-8 max-w-6xl mx-auto ${s} animate-fade-in app-tab overflow-y-auto h-full`,children:[(0,T.jsxs)("div",{className:"flex justify-between items-center mb-8 sticky top-0 bg-slate-50 z-20 py-2",children:[(0,T.jsx)("h2",{className:"text-3xl font-black text-slate-800",children:"Editor de Producto"}),(0,T.jsxs)("div",{className:"flex gap-3",children:[(0,T.jsx)("button",{onClick:()=>a(!1),className:"px-4 py-2 rounded-lg text-slate-500 hover:bg-slate-100 transition-colors",children:"Cancelar"}),(0,T.jsxs)("button",{onClick:()=>{if(!o.name)return _("Nombre obligatorio","error");t(e=>{let t=e.findIndex(e=>e.id===o.id);return t>=0?e.map((e,r)=>r===t?o:e):[...e,o]}),a(!1),_("Producto guardado","success")},className:"px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white shadow-lg flex items-center gap-2",children:[(0,T.jsx)(gF,{size:18})," Guardar Cambios"]})]})]}),(0,T.jsxs)("div",{className:"grid md:grid-cols-12 gap-6",children:[(0,T.jsxs)("div",{className:"md:col-span-4 space-y-6",children:[(0,T.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-5 space-y-4 shadow-sm",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-[10px] font-black uppercase text-slate-400 mb-1 block",children:"Nombre del Producto"}),(0,T.jsx)("input",{className:"w-full p-3 border rounded-xl font-bold text-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-100 outline-none",value:o.name,onChange:e=>l({...o,name:e.target.value})})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-[10px] font-black uppercase text-slate-400 mb-1 block",children:"Categora"}),(0,T.jsx)("select",{className:"w-full p-3 border rounded-xl bg-slate-50 outline-none",value:o.category,onChange:e=>l({...o,category:e.target.value}),children:r.map(e=>(0,T.jsx)("option",{value:e,children:e},e))})]}),(0,T.jsxs)("div",{className:"p-4 border-2 border-dashed rounded-xl bg-slate-50 hover:bg-white transition-colors text-center cursor-pointer relative group",children:[(0,T.jsx)("input",{type:"file",accept:"image/*",onChange:E,className:"absolute inset-0 opacity-0 cursor-pointer z-10"}),o.image?(0,T.jsx)("img",{src:o.image,className:"h-40 w-full object-contain rounded-lg"}):(0,T.jsxs)("div",{className:"py-8 text-slate-400",children:[(0,T.jsx)(gN,{size:32,className:"mx-auto mb-2"}),(0,T.jsx)("p",{className:"text-xs",children:"Arrastra o clica para subir imagen"})]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-[10px] font-black uppercase text-slate-400 mb-2 block",children:"Tipo de Precio"}),(0,T.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,T.jsx)("button",{onClick:()=>l({...o,priceType:"matrix"}),className:`py-2 text-xs font-bold rounded-lg border transition-all ${"matrix"===o.priceType?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 hover:bg-slate-50"}`,children:"Matriz (m)"}),(0,T.jsx)("button",{onClick:()=>l({...o,priceType:"unit"}),className:`py-2 text-xs font-bold rounded-lg border transition-all ${"unit"===o.priceType?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 hover:bg-slate-50"}`,children:"Unitario (Und)"}),(0,T.jsx)("button",{onClick:()=>l({...o,priceType:"simple_area"}),className:`py-2 text-xs font-bold rounded-lg border transition-all ${"simple_area"===o.priceType?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 hover:bg-slate-50"}`,children:"Metro (m)"}),(0,T.jsx)("button",{onClick:()=>l({...o,priceType:"simple_linear"}),className:`py-2 text-xs font-bold rounded-lg border transition-all ${"simple_linear"===o.priceType?"bg-slate-800 text-white border-slate-800":"bg-white text-slate-500 hover:bg-slate-50"}`,children:"Metro (ml)"})]})]}),(0,T.jsxs)("div",{className:"bg-blue-50 p-3 rounded-xl border border-blue-100",children:[(0,T.jsxs)("label",{className:"text-[10px] font-black uppercase text-blue-600 mb-2 block flex items-center gap-1",children:[(0,T.jsx)(g5,{size:12})," Margen Comercial (Beneficio)"]}),(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsxs)("div",{className:"flex rounded-lg bg-white border overflow-hidden shrink-0",children:[(0,T.jsx)("button",{onClick:()=>l({...o,marginType:"percent"}),className:`px-2 py-1 text-xs font-bold transition-colors ${"percent"===o.marginType?"bg-blue-600 text-white":"text-slate-500 hover:bg-slate-50"}`,children:"%"}),(0,T.jsx)("button",{onClick:()=>l({...o,marginType:"fixed"}),className:`px-2 py-1 text-xs font-bold transition-colors ${"fixed"===o.marginType?"bg-blue-600 text-white":"text-slate-500 hover:bg-slate-50"}`,children:""})]}),(0,T.jsx)("input",{type:"number",className:"w-full p-2 text-sm outline-none bg-white border rounded-lg",placeholder:"0",value:o.marginValue,onChange:e=>l({...o,marginValue:e.target.value})})]}),(0,T.jsx)("p",{className:"text-[10px] text-blue-400 mt-1 italic",children:"Se aade al coste base + extras"})]})]}),(0,T.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-5 shadow-sm",children:[(0,T.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,T.jsx)(gJ,{size:16,className:"text-purple-500"}),(0,T.jsx)("h3",{className:"font-bold text-sm",children:"Extras y Acabados"})]}),(0,T.jsx)("div",{className:"space-y-2 mb-4 max-h-40 overflow-y-auto pr-1 custom-scrollbar",children:o.extras.map(e=>(0,T.jsxs)("div",{className:"flex justify-between items-center p-2.5 bg-white border rounded-lg shadow-sm text-sm",children:[(0,T.jsx)("span",{className:"font-medium",children:e.name}),(0,T.jsxs)("div",{className:"flex gap-1",children:[(0,T.jsx)("button",{onClick:()=>{u({name:e.name,type:e.type,value:e.value}),p(e.optionsList||[]),g(e.id)},className:"text-slate-400 hover:text-blue-600 p-1",children:(0,T.jsx)(g2,{size:14})}),(0,T.jsx)("button",{onClick:()=>l({...o,extras:o.extras.filter(t=>t.id!==e.id)}),className:"text-slate-400 hover:text-red-600 p-1",children:(0,T.jsx)(gW,{size:14})})]})]},e.id))}),(0,T.jsx)("div",{className:"p-3 bg-white rounded-xl border border-blue-100 shadow-sm",children:(0,T.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,T.jsx)("input",{placeholder:"Nombre del extra",className:"w-full p-2 border rounded-lg text-sm bg-slate-50 focus:bg-white",value:c.name,onChange:e=>u({...c,name:e.target.value})}),(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsxs)("select",{className:"w-28 p-2 border rounded-lg text-xs bg-slate-50",value:c.type,onChange:e=>u({...c,type:e.target.value}),children:[(0,T.jsx)("option",{value:"fixed",children:"Precio (+)"}),(0,T.jsx)("option",{value:"percent",children:"Porcen. (+%)"}),(0,T.jsx)("option",{value:"linear",children:"Por Metro (ml)"}),(0,T.jsx)("option",{value:"area",children:"Por m"}),(0,T.jsx)("option",{value:"selection",children:"Lista Op."})]}),"selection"!==c.type&&(0,T.jsx)("input",{type:"number",placeholder:"0",className:"flex-1 p-2 border rounded-lg text-sm bg-slate-50",value:c.value,onChange:e=>u({...c,value:e.target.value})})]}),"selection"===c.type&&(0,T.jsxs)("div",{className:"bg-slate-50 p-2 rounded border",children:[(0,T.jsxs)("div",{className:"flex gap-1 mb-2",children:[(0,T.jsx)("input",{placeholder:"Opcin",className:"flex-1 p-1 text-xs border rounded",value:h.name,onChange:e=>d({...h,name:e.target.value})}),(0,T.jsx)("input",{type:"number",placeholder:"Val",className:"w-12 p-1 text-xs border rounded",value:h.value,onChange:e=>d({...h,value:e.target.value})}),(0,T.jsxs)("select",{className:"w-20 p-1 text-xs border rounded",value:h.type,onChange:e=>d({...h,type:e.target.value}),children:[(0,T.jsx)("option",{value:"fixed",children:""}),(0,T.jsx)("option",{value:"percent",children:"%"}),(0,T.jsx)("option",{value:"linear",children:"/ml"}),(0,T.jsx)("option",{value:"area",children:"/m"})]}),(0,T.jsx)("button",{onClick:()=>{h.name&&(p([...f,{...h}]),d({name:"",value:0,type:"fixed"}))},className:"bg-blue-600 text-white rounded px-2",children:"+"})]}),(0,T.jsx)("div",{className:"max-h-20 overflow-y-auto space-y-1",children:f.map((e,t)=>(0,T.jsxs)("div",{className:"text-[10px] bg-white p-1 border rounded flex justify-between",children:[(0,T.jsx)("span",{children:e.name}),(0,T.jsxs)("b",{children:["+",e.value,"percent"===e.type?"%":"linear"===e.type?"/ml":"area"===e.type?"/m":""]})]},t))})]}),(0,T.jsx)("button",{onClick:()=>{if(!c.name)return;let e={...c,id:m||Date.now(),optionsList:f};l({...o,extras:m?o.extras.map(t=>t.id===m?e:t):[...o.extras,e]}),g(null),u({name:"",type:"fixed",value:0}),p([])},className:`w-full mt-2 py-1.5 text-xs rounded-lg font-bold flex items-center justify-center gap-2 ${m?"bg-white border hover:bg-slate-50 text-slate-700":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:m?"Actualizar Extra":"Aadir Extra"})]})})]})]}),(0,T.jsx)("div",{className:"md:col-span-8 space-y-6",children:(0,T.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 shadow-sm p-4 h-full flex flex-col min-h-[500px]",children:[(0,T.jsxs)("h3",{className:"font-bold text-lg mb-4 flex items-center gap-2",children:[(0,T.jsx)("div",{className:"p-1 bg-blue-100 rounded text-blue-600",children:(0,T.jsx)(gJ,{size:16})})," Configuracin de Precios"]}),"unit"===o.priceType?(0,T.jsxs)("div",{className:"flex-1 flex items-center justify-center flex-col",children:[(0,T.jsx)("label",{className:"text-sm font-bold text-slate-400 mb-2",children:"PRECIO BASE UNITARIO"}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("span",{className:"text-4xl font-bold text-slate-300 mr-2",children:""}),(0,T.jsx)("input",{type:"number",className:"text-6xl font-black border-b-2 border-slate-200 w-60 outline-none text-center focus:border-blue-500 transition-colors",value:o.unitPrice,onChange:e=>l({...o,unitPrice:e.target.value})})]})]}):["simple_area","simple_linear"].includes(o.priceType)?(0,T.jsxs)("div",{className:"flex-1 flex items-center justify-center flex-col",children:[(0,T.jsxs)("label",{className:"text-sm font-bold text-slate-400 mb-2",children:["PRECIO BASE POR ","simple_area"===o.priceType?"METRO CUADRADO (m)":"METRO LINEAL (ml)"]}),(0,T.jsxs)("div",{className:"flex items-center",children:[(0,T.jsx)("span",{className:"text-4xl font-bold text-slate-300 mr-2",children:""}),(0,T.jsx)("input",{type:"number",className:"text-6xl font-black border-b-2 border-slate-200 w-60 outline-none text-center focus:border-blue-500 transition-colors",value:o.unitPrice,onChange:e=>l({...o,unitPrice:e.target.value})})]})]}):(0,T.jsx)(gX,{matrix:o.matrix,onChange:e=>l({...o,matrix:e})})]})})]})]}):(0,T.jsxs)("div",{className:`p-4 md:p-8 max-w-7xl mx-auto ${s} animate-fade-in app-tab overflow-y-auto h-full`,children:[(0,T.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("h2",{className:"text-3xl font-black text-slate-800",children:"Catlogo de Productos"}),(0,T.jsx)("p",{className:"text-slate-500 text-sm",children:"Gestiona tus precios y referencias"})]}),(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsxs)("button",{onClick:()=>v(!x),className:"px-4 py-2 bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 font-bold rounded-lg flex items-center gap-2",children:[(0,T.jsx)(gk,{size:18})," Categoras"]}),(0,T.jsxs)("button",{onClick:()=>{l({id:Date.now().toString(),name:"",category:r[0]||"General",image:null,priceType:"matrix",unitPrice:0,marginType:"percent",marginValue:0,matrix:{widths:[600,1e3,1400],heights:[600,1e3,1400],prices:[[100,150,200],[150,200,250],[200,250,300]]},extras:[]}),a(!0),g(null),u({name:"",type:"fixed",value:0}),p([])},className:"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 font-bold rounded-lg shadow-lg flex items-center gap-2",children:[(0,T.jsx)(gL,{size:18})," Nuevo Producto"]})]})]}),x&&(0,T.jsxs)("div",{className:"bg-white border p-4 rounded-xl shadow-xl mb-8 animate-slide-up max-w-md ml-auto",children:[(0,T.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,T.jsx)("input",{className:"border p-2 rounded flex-1",placeholder:"Nueva categora...",value:w,onChange:e=>I(e.target.value)}),(0,T.jsx)("button",{onClick:()=>{w&&!r.includes(w)&&(n([...r,w]),I(""))},className:"px-4 py-2 bg-blue-600 text-white rounded font-bold",children:"Aadir"})]}),(0,T.jsx)("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:r.map((e,t)=>(0,T.jsxs)("div",{className:"flex justify-between items-center bg-slate-50 p-2 rounded border border-slate-100",children:[(0,T.jsx)("span",{className:"font-bold text-sm",children:e}),(0,T.jsxs)("div",{className:"flex gap-1",children:[(0,T.jsx)("button",{onClick:()=>C(t,-1),className:"text-slate-400 hover:text-blue-600 px-1",children:""}),(0,T.jsx)("button",{onClick:()=>C(t,1),className:"text-slate-400 hover:text-blue-600 px-1",children:""}),(0,T.jsx)("button",{onClick:()=>confirm("Borrar?")&&n(r.filter(t=>t!==e)),className:"text-slate-400 hover:text-red-500",children:(0,T.jsx)(gW,{size:14})})]})]},e))})]}),(0,T.jsxs)("div",{className:"flex gap-2 overflow-x-auto pb-4 mb-2 no-scrollbar",children:[(0,T.jsx)("button",{onClick:()=>b("Todas"),className:`px-5 py-2 rounded-full whitespace-nowrap text-sm font-bold transition-all ${"Todas"===y?"bg-slate-800 text-white shadow-lg":"bg-white border text-slate-600 hover:bg-slate-50"}`,children:"Todas"}),r.map(e=>(0,T.jsx)("button",{onClick:()=>b(e),className:`px-5 py-2 rounded-full whitespace-nowrap text-sm font-bold transition-all ${y===e?"bg-slate-800 text-white shadow-lg":"bg-white border text-slate-600 hover:bg-slate-50"}`,children:e},e))]}),(0,T.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6",children:k.map((r,n)=>(0,T.jsxs)("div",{className:"group bg-white rounded-2xl border border-slate-200 overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all relative flex flex-col",children:[(0,T.jsxs)("div",{className:"aspect-square bg-slate-50 relative w-full border-b border-slate-100",children:[r.image?(0,T.jsx)("img",{src:r.image,className:"w-full h-full object-cover"}):(0,T.jsx)("div",{className:"flex h-full items-center justify-center text-slate-300",children:(0,T.jsx)(gN,{size:40})}),(0,T.jsxs)("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity bg-white/90 backdrop-blur p-1 rounded-lg shadow-sm",children:[(0,T.jsx)("button",{onClick:()=>{let e;!(e=JSON.parse(JSON.stringify(r))).extras&&(e.extras=[]),l(e),a(!0),g(null),u({name:"",type:"fixed",value:0}),p([])},className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded",children:(0,T.jsx)(g2,{size:16})}),(0,T.jsx)("button",{onClick:()=>{confirm("Borrar?")&&t(e.filter(e=>e.id!==r.id))},className:"p-1.5 text-red-500 hover:bg-red-50 rounded",children:(0,T.jsx)(gW,{size:16})})]})]}),(0,T.jsxs)("div",{className:"p-4 flex-1 flex flex-col",children:[(0,T.jsx)("h3",{className:"font-bold text-sm leading-tight mb-auto",children:r.name}),(0,T.jsxs)("div",{className:"mt-2 flex justify-between items-end",children:[(0,T.jsx)("span",{className:"text-[10px] font-bold uppercase text-slate-400 bg-slate-100 px-1.5 py-0.5 rounded",children:r.category}),(0,T.jsxs)("div",{className:"flex gap-1 opacity-20 group-hover:opacity-100",children:[(0,T.jsx)("button",{onClick:()=>S(n,-1),className:"text-xs font-bold hover:text-blue-600",children:""}),(0,T.jsx)("button",{onClick:()=>S(n,1),className:"text-xs font-bold hover:text-blue-600",children:""})]})]})]})]},r.id))})]})},g4=gd("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),g3=gd("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),g8=gd("undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),g7=e=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(e||0),g9=({quotesHistory:e,deletedHistory:t,onLoadQuote:r,onDeleteClient:n,onDeleteQuote:s,onRestoreItem:i,onNewQuoteForClient:a,onPermanentDelete:o,onUpdateStatus:l,onImportClient:c,className:u})=>{let[h,d]=(0,N.useState)(""),[f,p]=(0,N.useState)(null),[m,g]=(0,N.useState)(!1),y=gx(),b=(0,N.useMemo)(()=>{let t={};return e.forEach(e=>{let r=(e.client.name+e.client.phone).trim();t[r]||(t[r]={...e.client,key:r,quotes:[],total:0}),t[r].quotes.push(e),t[r].total+=e.grandTotal}),Object.values(t).sort((e,t)=>t.total-e.total)},[e]),x=(0,N.useMemo)(()=>b.find(e=>e.key===f),[b,f]),v=b.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())||e.phone.includes(h));return m?(0,T.jsxs)("div",{className:`p-6 md:p-10 h-full overflow-hidden flex flex-col ${u} animate-fade-in`,children:[(0,T.jsxs)("div",{className:"flex justify-between mb-6 items-center",children:[(0,T.jsxs)("h2",{className:"text-2xl font-black flex gap-2 text-slate-800",children:[(0,T.jsx)(gW,{className:"text-red-500"})," Papelera"]}),(0,T.jsx)("button",{onClick:()=>g(!1),className:"px-4 py-2 bg-white border rounded hover:bg-slate-50 font-bold text-slate-600",children:"Volver"})]}),(0,T.jsx)("div",{className:"bg-white border rounded-xl flex-1 overflow-y-auto shadow-sm",children:(0,T.jsxs)("table",{className:"w-full text-sm",children:[(0,T.jsx)("thead",{className:"bg-slate-50 text-left border-b sticky top-0",children:(0,T.jsxs)("tr",{children:[(0,T.jsx)("th",{className:"p-4 font-bold text-slate-500",children:"Elemento"}),(0,T.jsx)("th",{className:"p-4 text-right font-bold text-slate-500",children:"Acciones"})]})}),(0,T.jsx)("tbody",{children:t.map((e,t)=>(0,T.jsxs)("tr",{className:"border-b hover:bg-slate-50 transition-colors",children:[(0,T.jsxs)("td",{className:"p-4",children:[(0,T.jsx)("p",{className:"font-bold text-xs uppercase bg-slate-200 w-fit px-1 rounded mb-1",children:"client"===e.type?"Cliente":"Presupuesto"}),(0,T.jsx)("p",{className:"font-medium text-slate-800",children:"client"===e.type?e.data.name:`#${e.data.number} (${g7(e.data.grandTotal)})`}),(0,T.jsxs)("p",{className:"text-xs text-slate-400",children:["Borrado: ",new Date(e.deletedAt).toLocaleString()]})]}),(0,T.jsx)("td",{className:"p-4 text-right",children:(0,T.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,T.jsxs)("button",{onClick:()=>i(e),className:"py-1 px-3 text-xs bg-emerald-600 text-white rounded hover:bg-emerald-700 flex items-center gap-1",children:[(0,T.jsx)(g8,{size:14})," Recuperar"]}),(0,T.jsxs)("button",{onClick:()=>{confirm("Irreversible")&&o(e)},className:"py-1 px-3 text-xs bg-red-50 text-red-600 border border-red-100 rounded hover:bg-red-100 flex items-center gap-1",children:[(0,T.jsx)(gW,{size:14})," Eliminar"]})]})})]},t))})]})})]}):(0,T.jsxs)("div",{className:`flex h-full p-4 md:p-6 gap-6 ${u} app-tab`,children:[(0,T.jsxs)("div",{className:`${f?"hidden md:flex":"flex"} w-full md:w-1/3 bg-white border border-slate-200 rounded-2xl flex-col h-full shadow-lg overflow-hidden`,children:[(0,T.jsxs)("div",{className:"p-4 border-b bg-slate-50 flex gap-2 items-center",children:[(0,T.jsxs)("div",{className:"relative flex-1 group",children:[(0,T.jsx)(gB,{className:"absolute left-3 top-2.5 text-slate-400 group-focus-within:text-blue-500",size:16}),(0,T.jsx)("input",{className:"w-full pl-9 p-2 border rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-100 transition-all",placeholder:"Buscar clientes...",value:h,onChange:e=>d(e.target.value)})]}),(0,T.jsxs)("label",{className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg cursor-pointer transition-colors",title:"Importar Cliente",children:[(0,T.jsx)(g4,{size:20}),(0,T.jsx)("input",{type:"file",className:"hidden",onChange:e=>{let t=e.target.files[0];if(!t)return;let r=new FileReader;r.onload=e=>{try{let t=JSON.parse(e.target.result);("client_card"===t.type||"gova_client_card"===t.type)&&t.client?(c(t.client),y("Cliente importado correctamente","success")):y("Formato de archivo no vlido","error")}catch(e){y("Error al leer archivo","error")}},r.readAsText(t)}})]}),(0,T.jsx)("button",{onClick:()=>g(!0),className:"p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:(0,T.jsx)(gW,{size:20})})]}),(0,T.jsx)("div",{className:"flex-1 overflow-y-auto",children:v.map(e=>(0,T.jsxs)("div",{onClick:()=>p(e.key),className:`p-4 border-b cursor-pointer transition-all hover:bg-slate-50 ${f===e.key?"bg-blue-50 border-l-4 border-l-blue-600 shadow-inner":""}`,children:[(0,T.jsxs)("div",{className:"flex justify-between items-center",children:[(0,T.jsx)("h4",{className:"font-bold text-slate-800",children:e.name}),(0,T.jsxs)("span",{className:"text-[10px] font-bold bg-slate-100 px-1.5 rounded text-slate-500",children:[e.quotes.length," pres."]})]}),(0,T.jsxs)("div",{className:"flex justify-between text-xs mt-1 text-slate-500",children:[(0,T.jsx)("span",{children:e.phone}),(0,T.jsx)("span",{className:"font-bold text-emerald-600",children:g7(e.total)})]})]},e.key))})]}),(0,T.jsx)("div",{className:`${!f?"hidden md:flex":"flex"} w-full md:flex-1 bg-white border border-slate-200 rounded-2xl flex-col relative h-full shadow-lg overflow-hidden`,children:x?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:"p-6 border-b bg-slate-50",children:[(0,T.jsxs)("button",{onClick:()=>p(null),className:"md:hidden text-sm font-bold text-slate-500 mb-4 flex items-center",children:[(0,T.jsx)(gG,{className:"mr-1"})," LISTA"]}),(0,T.jsxs)("div",{className:"flex justify-between items-start",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("h2",{className:"text-3xl font-black text-slate-800",children:x.name}),(0,T.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-sm text-slate-600",children:[(0,T.jsx)("span",{className:"bg-white px-2 py-0.5 rounded border",children:x.phone}),(0,T.jsx)("span",{children:x.email})]}),(0,T.jsx)("p",{className:"text-xs text-slate-400 mt-2",children:x.address})]}),(0,T.jsxs)("div",{className:"text-right flex flex-col items-end",children:[(0,T.jsx)("div",{className:"text-3xl font-black text-blue-900 mb-2",children:g7(x.total)}),(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsxs)("button",{onClick:()=>{let e,t;return e=new Blob([JSON.stringify({version:"1.0",type:"client_card",exported_at:new Date().toISOString(),client:{name:x.name,phone:x.phone,email:x.email,address:x.address,city:x.city,source:x.source,measurements:x.measurements||[]}},null,2)],{type:"application/json"}),void((t=document.createElement("a")).href=URL.createObjectURL(e),t.download=`Cliente_${x.name.replace(/[^a-z0-9]/gi,"_")}.json`,t.click())},className:"py-1 px-3 text-xs bg-white border rounded hover:bg-slate-50 text-slate-600 flex items-center gap-1",children:[(0,T.jsx)(g3,{size:14})," Exportar Ficha"]}),(0,T.jsxs)("button",{onClick:()=>{confirm("Eliminar toda la ficha?")&&(n(x),p(null))},className:"py-1 px-3 text-xs bg-red-50 text-red-600 border border-red-100 rounded hover:bg-red-100 flex items-center gap-1",children:[(0,T.jsx)(gW,{size:14})," Eliminar"]})]})]})]}),(0,T.jsx)("div",{className:"mt-6",children:(0,T.jsxs)("button",{onClick:()=>a(x),className:"w-full py-3 shadow-lg bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl flex items-center justify-center gap-2",children:[(0,T.jsx)(gL,{size:18})," Crear Nuevo Presupuesto"]})})]}),(0,T.jsx)("div",{className:"flex-1 overflow-y-auto p-4 md:p-6 space-y-3 bg-slate-50/50",children:x.quotes.map(e=>(0,T.jsxs)("div",{className:"border border-slate-200 rounded-xl p-4 flex justify-between items-center hover:shadow-md bg-white transition-shadow group",children:[(0,T.jsxs)("div",{className:"flex items-center gap-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsxs)("span",{className:"font-black text-lg text-slate-700",children:["#",e.number]}),(0,T.jsx)("p",{className:"text-xs text-slate-400",children:e.date})]}),(0,T.jsxs)("select",{value:e.status,onChange:t=>l(e.id,t.target.value),className:`text-xs font-bold uppercase rounded py-1 px-2 border outline-none cursor-pointer ${"accepted"===e.status?"bg-emerald-100 text-emerald-700 border-emerald-200":"rejected"===e.status?"bg-red-50 text-red-600 border-red-200":"bg-slate-100 text-slate-600"}`,children:[(0,T.jsx)("option",{value:"pending",children:"Pendiente"}),(0,T.jsx)("option",{value:"accepted",children:"Aceptado"}),(0,T.jsx)("option",{value:"rejected",children:"Rechazado"})]})]}),(0,T.jsxs)("div",{className:"flex items-center gap-4",children:[(0,T.jsx)("span",{className:"font-bold text-slate-800",children:g7(e.grandTotal)}),(0,T.jsxs)("div",{className:"flex gap-1",children:[(0,T.jsx)("button",{onClick:()=>r(e),className:"text-slate-400 hover:text-blue-600 p-2",title:"Editar",children:(0,T.jsx)(g2,{size:16})}),(0,T.jsx)("button",{onClick:t=>{t.stopPropagation(),confirm("Borrar presupuesto?")&&s(e)},className:"text-slate-300 hover:text-red-600 p-2 rounded hover:bg-red-50 transition-colors",children:(0,T.jsx)(gW,{size:16})})]})]})]},e.id))})]}):(0,T.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-300 p-10 text-center",children:[(0,T.jsx)("div",{className:"bg-slate-50 p-6 rounded-full mb-4",children:(0,T.jsx)(gT,{size:48,className:"opacity-50"})}),(0,T.jsx)("p",{className:"font-medium",children:"Selecciona un cliente para ver su historial"})]})})]})},ye=({config:e,setConfig:t,className:r})=>{let n=gx(),s=async r=>{try{let n,s=await (n=r.target.files[0],new Promise((e,t)=>{if(!n.type.match(/image.*/))return t(Error("No es un archivo de imagen"));let r=new FileReader;r.onload=t=>{let r=new Image;r.onload=()=>{let t=document.createElement("canvas"),n=r.width,s=r.height;n>s?n>500&&(s*=500/n,n=500):s>500&&(n*=500/s,s=500),t.width=n,t.height=s,t.getContext("2d").drawImage(r,0,0,n,s),e(t.toDataURL("image/png"))},r.src=t.target.result},r.readAsDataURL(n)}));t({...e,logo:s})}catch(e){n(e.message,"error")}};return(0,T.jsxs)("div",{className:`p-4 md:p-8 max-w-4xl mx-auto h-full overflow-y-auto animate-fade-in ${r}`,children:[(0,T.jsx)("h2",{className:"text-3xl font-black text-slate-800 mb-6",children:"Configuracin de Negocio"}),(0,T.jsxs)("div",{className:"space-y-6",children:[(0,T.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[(0,T.jsx)("h3",{className:"font-bold text-lg mb-4 text-slate-700 border-b pb-2",children:"Identidad Corporativa"}),(0,T.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,T.jsxs)("div",{className:"space-y-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-[10px] font-bold uppercase text-slate-400 block mb-1",children:"Nombre Comercial"}),(0,T.jsx)("input",{className:"w-full p-3 border rounded-lg bg-slate-50 focus:bg-white focus:ring-2 focus:ring-blue-100 outline-none font-bold",value:e.name,onChange:r=>t({...e,name:r.target.value})})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-[10px] font-bold uppercase text-slate-400 block mb-1",children:"CIF / NIF"}),(0,T.jsx)("input",{className:"w-full p-3 border rounded-lg bg-slate-50 focus:bg-white outline-none",value:e.cif,onChange:r=>t({...e,cif:r.target.value})})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-[10px] font-bold uppercase text-slate-400 block mb-1",children:"Color de Marca"}),(0,T.jsxs)("div",{className:"flex gap-2",children:[(0,T.jsx)("input",{type:"color",className:"h-12 w-20 rounded cursor-pointer border-none",value:e.color,onChange:r=>t({...e,color:r.target.value})}),(0,T.jsx)("input",{className:"flex-1 p-3 border rounded-lg bg-slate-50",value:e.color,onChange:r=>t({...e,color:r.target.value})})]})]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-[10px] font-bold uppercase text-slate-400 block mb-1",children:"Logotipo (Fondo Blanco/Transparente)"}),(0,T.jsxs)("div",{className:"p-4 border-2 border-dashed rounded-xl bg-slate-50 hover:bg-white transition-colors text-center cursor-pointer relative group h-48 flex items-center justify-center",children:[(0,T.jsx)("input",{type:"file",accept:"image/*",onChange:s,className:"absolute inset-0 opacity-0 cursor-pointer z-10"}),e.logo?(0,T.jsx)("img",{src:e.logo,className:"max-h-full max-w-full object-contain"}):(0,T.jsxs)("div",{className:"text-slate-400",children:[(0,T.jsx)(gN,{size:32,className:"mx-auto mb-2"}),(0,T.jsx)("p",{className:"text-xs",children:"Subir Logo"})]})]})]})]})]}),(0,T.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[(0,T.jsx)("h3",{className:"font-bold text-lg mb-4 text-slate-700 border-b pb-2",children:"Contacto y Legal"}),(0,T.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-[10px] font-bold uppercase text-slate-400 block mb-1",children:"Telfono"}),(0,T.jsx)("input",{className:"w-full p-3 border rounded-lg bg-slate-50 outline-none",value:e.phone,onChange:r=>t({...e,phone:r.target.value})})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-[10px] font-bold uppercase text-slate-400 block mb-1",children:"Email"}),(0,T.jsx)("input",{className:"w-full p-3 border rounded-lg bg-slate-50 outline-none",value:e.email,onChange:r=>t({...e,email:r.target.value})})]}),(0,T.jsxs)("div",{className:"md:col-span-2",children:[(0,T.jsx)("label",{className:"text-[10px] font-bold uppercase text-slate-400 block mb-1",children:"Direccin Completa"}),(0,T.jsx)("input",{className:"w-full p-3 border rounded-lg bg-slate-50 outline-none",value:e.address,onChange:r=>t({...e,address:r.target.value})})]}),(0,T.jsxs)("div",{className:"md:col-span-2",children:[(0,T.jsx)("label",{className:"text-[10px] font-bold uppercase text-slate-400 block mb-1",children:"Web"}),(0,T.jsx)("input",{className:"w-full p-3 border rounded-lg bg-slate-50 outline-none",value:e.website,onChange:r=>t({...e,website:r.target.value})})]})]}),(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-[10px] font-bold uppercase text-slate-400 block mb-1",children:"Cuenta Bancaria (para Presupuestos)"}),(0,T.jsx)("textarea",{className:"w-full p-3 border rounded-lg bg-slate-50 outline-none h-20 text-sm",value:e.bankAccount,onChange:r=>t({...e,bankAccount:r.target.value})})]}),(0,T.jsxs)("div",{className:"mt-4",children:[(0,T.jsx)("label",{className:"text-[10px] font-bold uppercase text-slate-400 block mb-1",children:"Trminos Legales (Pie de pgina)"}),(0,T.jsx)("textarea",{className:"w-full p-3 border rounded-lg bg-slate-50 outline-none h-32 text-xs",value:e.legalText,onChange:r=>t({...e,legalText:r.target.value})})]})]}),(0,T.jsxs)("div",{className:"bg-white rounded-xl border border-slate-200 p-6 shadow-sm",children:[(0,T.jsx)("h3",{className:"font-bold text-lg mb-4 text-slate-700 border-b pb-2",children:"Fiscalidad"}),(0,T.jsx)("div",{className:"grid md:grid-cols-2 gap-6",children:(0,T.jsxs)("div",{children:[(0,T.jsx)("label",{className:"text-[10px] font-bold uppercase text-slate-400 block mb-1",children:"IVA Global (%)"}),(0,T.jsx)("input",{type:"number",className:"w-full p-3 border rounded-lg bg-slate-50 outline-none font-bold",value:void 0!==e.iva?e.iva:21,onChange:r=>t({...e,iva:r.target.value})}),(0,T.jsx)("p",{className:"text-[10px] text-slate-400 mt-1",children:"Por defecto: 21%"})]})})]}),(0,T.jsx)("div",{className:"flex justify-end pb-8",children:(0,T.jsxs)("button",{onClick:()=>n("Configuracin guardada","success"),className:"px-8 py-3 bg-slate-800 text-white font-bold rounded-xl shadow-lg flex items-center gap-2 hover:bg-slate-900 transition-colors",children:[(0,T.jsx)(gF,{size:18})," Guardar Configuracin"]})})]})]})},yt=({onLogout:e})=>{let[t,r]=(0,N.useState)("dashboard"),[n,s]=(0,N.useState)([]),[i,a]=(0,N.useState)(["General","Cocinas","Armarios"]),[o,l]=(0,N.useState)([]),[c,u]=(0,N.useState)([]),[h,d]=(0,N.useState)([]),[f,p]=(0,N.useState)({name:"tupresulisto.com",color:"#2563eb",logo:null,cif:"",phone:"",email:"",website:"",address:"",bankAccount:"",legalText:"Presupuesto vlido por 15 das.",iva:21}),[m,g]=(0,N.useState)(null),[y,b]=(0,N.useState)([]),x=gx();(0,N.useEffect)(()=>{(async()=>{let e=await gg.get("tpl_products")||[],t=await gg.get("tpl_categories")||["General","Cocinas","Armarios"],r=await gg.get("tpl_history")||[],n=await gg.get("tpl_deleted")||[],i=await gg.get("tpl_config")||{name:"tupresulisto.com",color:"#2563eb",iva:21};s(e.length?e:[]),t.length&&a(t),r.length&&l(r),n.length&&u(n),p(e=>({...e,...i}))})()},[]),(0,N.useEffect)(()=>{gg.set("tpl_products",n)},[n]),(0,N.useEffect)(()=>{gg.set("tpl_categories",i)},[i]),(0,N.useEffect)(()=>{gg.set("tpl_history",o)},[o]),(0,N.useEffect)(()=>{gg.set("tpl_deleted",c)},[c]),(0,N.useEffect)(()=>{gg.set("tpl_config",f)},[f]);let v=(e,t)=>{t?(r(t),"quote"===t&&(g(null),b([]))):e&&(g(e),b(e.items),r("quote"))},w=e=>{g({client:e,items:[],financials:{discountPercent:0,deposit:0},number:"",status:"pending",date:new Date().toLocaleDateString()}),b([]),r("quote")};return(0,T.jsxs)("div",{className:"flex h-screen w-full bg-slate-100 font-sans text-slate-800 overflow-hidden",children:[(0,T.jsxs)("aside",{className:"hidden md:flex flex-col w-20 lg:w-64 bg-slate-900 text-slate-300 transition-all z-50 shadow-2xl shrink-0",children:[(0,T.jsxs)("div",{className:"p-6 flex items-center justify-center lg:justify-start gap-3 border-b border-slate-800",children:[(0,T.jsx)("div",{className:"w-8 h-8 rounded bg-blue-600 shrink-0"}),(0,T.jsx)("span",{className:"font-black text-xl text-white hidden lg:block tracking-tight",children:"tupresulisto.com"})]}),(0,T.jsxs)("nav",{className:"flex-1 py-6 space-y-2 px-3",children:[(0,T.jsxs)("button",{onClick:()=>r("dashboard"),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${"dashboard"===t?"bg-blue-600 text-white shadow-lg shadow-blue-900/50":"hover:bg-slate-800 hover:text-white"}`,children:[(0,T.jsx)(gv,{size:20})," ",(0,T.jsx)("span",{className:"hidden lg:block font-bold text-sm",children:"Panel Control"})]}),(0,T.jsxs)("button",{onClick:()=>{g(null),b([]),r("quote")},className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${"quote"===t?"bg-blue-600 text-white shadow-lg shadow-blue-900/50":"hover:bg-slate-800 hover:text-white"}`,children:[(0,T.jsx)(gw,{size:20})," ",(0,T.jsx)("span",{className:"hidden lg:block font-bold text-sm",children:"Presupuestador"})]}),(0,T.jsxs)("button",{onClick:()=>r("prods"),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${"prods"===t?"bg-blue-600 text-white shadow-lg shadow-blue-900/50":"hover:bg-slate-800 hover:text-white"}`,children:[(0,T.jsx)(gI,{size:20})," ",(0,T.jsx)("span",{className:"hidden lg:block font-bold text-sm",children:"Productos"})]}),(0,T.jsxs)("button",{onClick:()=>r("clients"),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${"clients"===t?"bg-blue-600 text-white shadow-lg shadow-blue-900/50":"hover:bg-slate-800 hover:text-white"}`,children:[(0,T.jsx)(gT,{size:20})," ",(0,T.jsx)("span",{className:"hidden lg:block font-bold text-sm",children:"Clientes"})]})]}),(0,T.jsxs)("div",{className:"p-3 border-t border-slate-800 space-y-2",children:[(0,T.jsxs)("button",{onClick:()=>r("config"),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${"config"===t?"bg-slate-800 text-white":"hover:bg-slate-800 hover:text-white"}`,children:[(0,T.jsx)(g_,{size:20})," ",(0,T.jsx)("span",{className:"hidden lg:block font-bold text-sm",children:"Configuracin"})]}),(0,T.jsxs)("button",{onClick:e,className:"w-full flex items-center gap-3 p-3 rounded-xl hover:bg-red-900/30 hover:text-red-400 transition-all text-slate-400",children:[(0,T.jsx)(gE,{size:20})," ",(0,T.jsx)("span",{className:"hidden lg:block font-bold text-sm",children:"Cerrar Sesin"})]})]})]}),(0,T.jsxs)("div",{className:"md:hidden fixed bottom-0 left-0 right-0 bg-white border-t z-[60] flex justify-around p-2 pb-safe shadow-2xl",children:[(0,T.jsxs)("button",{onClick:()=>r("dashboard"),className:`p-2 rounded-lg flex flex-col items-center ${"dashboard"===t?"text-blue-600":"text-slate-400"}`,children:[(0,T.jsx)(gv,{size:20}),(0,T.jsx)("span",{className:"text-[10px] font-bold mt-1",children:"Panel"})]}),(0,T.jsxs)("button",{onClick:()=>{g(null),b([]),r("quote")},className:`p-2 rounded-lg flex flex-col items-center ${"quote"===t?"text-blue-600":"text-slate-400"}`,children:[(0,T.jsx)(gw,{size:20}),(0,T.jsx)("span",{className:"text-[10px] font-bold mt-1",children:"Nuevo"})]}),(0,T.jsxs)("button",{onClick:()=>r("clients"),className:`p-2 rounded-lg flex flex-col items-center ${"clients"===t?"text-blue-600":"text-slate-400"}`,children:[(0,T.jsx)(gT,{size:20}),(0,T.jsx)("span",{className:"text-[10px] font-bold mt-1",children:"Clientes"})]}),(0,T.jsxs)("button",{onClick:()=>r("prods"),className:`p-2 rounded-lg flex flex-col items-center ${"prods"===t?"text-blue-600":"text-slate-400"}`,children:[(0,T.jsx)(gI,{size:20}),(0,T.jsx)("span",{className:"text-[10px] font-bold mt-1",children:"Items"})]}),(0,T.jsxs)("button",{onClick:()=>r("config"),className:`p-2 rounded-lg flex flex-col items-center ${"config"===t?"text-blue-600":"text-slate-400"}`,children:[(0,T.jsx)(g_,{size:20}),(0,T.jsx)("span",{className:"text-[10px] font-bold mt-1",children:"Config"})]})]}),(0,T.jsxs)("main",{className:"flex-1 overflow-hidden relative flex flex-col h-full bg-slate-100",children:["dashboard"===t&&(0,T.jsx)(gO,{history:o,products:n,clients:h,onNavigate:v,config:f}),"quote"===t&&(0,T.jsx)(g1,{products:n,categories:i,config:f,cart:y,setCart:b,onSave:e=>{o.find(t=>t.id===e.id)?l(o.map(t=>t.id===e.id?e:t)):l([e,...o]),g(null),b([]),r("dashboard")},onReset:()=>{b([]),g(null)},initialData:m,clientsDb:h,className:"h-full"}),"prods"===t&&(0,T.jsx)(g6,{products:n,setProducts:s,categories:i,setCategories:a,className:"h-full"}),"clients"===t&&(0,T.jsx)(g9,{quotesHistory:o,deletedHistory:c,onLoadQuote:e=>v(e),onDeleteClient:e=>{let t=o.filter(t=>t.client.name+t.client.phone===e.name+e.phone);l(o.filter(t=>t.client.name+t.client.phone!==e.name+e.phone)),u([{type:"client",data:{...e,quotes:t},deletedAt:new Date().toISOString()},...c]),x("Cliente y sus pedidos movidos a papelera","info")},onDeleteQuote:e=>{l(o.filter(t=>t.id!==e.id)),u([{type:"quote",data:e,deletedAt:new Date().toISOString()},...c]),x("Presupuesto movido a papelera","info")},onRestoreItem:e=>{u(c.filter(t=>t.deletedAt!==e.deletedAt)),"quote"===e.type?l([e.data,...o]):"client"===e.type&&l([...e.data.quotes,...o]),x("Elemento restaurado","success")},onNewQuoteForClient:e=>{w(e)},onPermanentDelete:e=>u(t=>t.filter(t=>t.deletedAt!==e.deletedAt)),onUpdateStatus:(e,t)=>l(r=>r.map(r=>r.id===e?{...r,status:t}:r)),onImportClient:w,className:"h-full"}),"config"===t&&(0,T.jsx)(ye,{config:f,setConfig:p,className:"h-full"})]})]})};function yr({onLogout:e}){return(0,T.jsx)(gb,{children:(0,T.jsx)(yt,{onLogout:e})})}function yn(){let[e,t]=(0,N.useState)(null),[r,n]=(0,N.useState)(!0);(0,N.useEffect)(()=>{var e;let r=(e=e=>{e?t({...e,name:e.displayName||e.email.split("@")[0]}):t(null),n(!1)},ed(go).onAuthStateChanged(e,void 0,void 0));return()=>r()},[]);let s=async()=>{await ed(go).signOut()};return r?(0,T.jsx)("div",{className:"h-screen flex items-center justify-center bg-slate-50 text-slate-400 font-bold",children:"Cargando..."}):e?(0,T.jsx)(yr,{onLogout:s}):(0,T.jsx)(gp,{onLoginSuccess:e=>t(e)})}e.s(["default",()=>yn],74647)}]);